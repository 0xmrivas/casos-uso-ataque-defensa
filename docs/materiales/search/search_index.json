{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Inicio","text":""},{"location":"#analisis-forense","title":"An\u00e1lisis Forense","text":"<p>El objetivo de este m\u00f3dulo es muy sencillo:</p> <p>Ser capaz de IDENTIFICAR, ASEGURAR, ANALIZAR, EXTRAER y PRESENTAR pruebas generadas electr\u00f3nicamente y guardadas en medios electr\u00f3nicos, utilizando una serie de procedimientos t\u00e9cnicos con el objetivo de que sean aceptadas en un proceso legal, si fuese necesario.</p> <p>Los contenidos se han dividido en las siguientes unidades (pulsando en cada una de ellas acceder\u00e1s a enlaces de referencia sobre los mismos, se completar\u00e1n conforme avance el curso):</p> <ul> <li>Unidad 1: Evidence Acquisition and Preservation</li> <li>Unidad 2: Windows Forensics</li> <li>Unidad 3: Linux Forensics</li> <li>Unidad 4: Memory Forensics</li> <li>Unidad 5 Mobile Device Forensics</li> <li>Unidad 6: IoT Forensics</li> <li>Unidad 7: Cloud Forensics</li> <li>Unidad 8: Documentation and Reporting</li> </ul>"},{"location":"#bibliografia","title":"Bibliograf\u00eda","text":"<p>La ciberseguridad es un sector que se mueve muy r\u00e1pido. Cada d\u00eda se descubren nuevas vulnerabilidades y habitualmente es necesario actualizar los protocolos y acciones que se llevan a cabo en la defensa. Es por eso que la informaci\u00f3n que podemos encontrar en libros est\u00e1 normalmente desactualizada.</p> <p>Este es el motivo principal por el que la mayor parte de los apuntes proporcionados no son m\u00e1s que referencias web actuales a los temas que vamos a tratar.</p> <p>No obstante, para los amantes del, se pueden encontrar algunos recursos interesantes:</p> <p>*Completar*****</p>"},{"location":"#referencias-web-generales","title":"Referencias web generales","text":"<p>*Completar*****</p>"},{"location":"ud1/","title":"Evidence Acquisition and Preservation","text":""},{"location":"ud1/#conceptos-basicos","title":"Conceptos b\u00e1sicos","text":"<ul> <li>\u00bfQu\u00e9 es el an\u00e1lisis forense inform\u00e1tico?</li> <li>Objetivos del an\u00e1lisis forense inform\u00e1tico</li> <li>Principales retos</li> <li>Tipos de an\u00e1lisis forense inform\u00e1tico</li> <li>An\u00e1lisis Forense vs Respuesta a incidentes</li> </ul>"},{"location":"ud1/#normativas-y-estandares","title":"Normativas y est\u00e1ndares","text":"<ul> <li>Est\u00e1ndares nacionales e internacionales que se pueden seguir para realizar el an\u00e1lisis forense</li> <li>ISO/IEC 27037:2012 - Guidelines for identification, collection, acquisition and preservation of digital evidence</li> <li> <p>ISO/IEC 27042:2015 - Guidelines for the analysis and interpretation of digital evidence</p> </li> <li> <p>UNE 71505/2013 - Sistema de Gesti\u00f3n de Evidencias Electr\u00f3nicas</p> </li> <li>UNE 71506/2013 -  Metodolog\u00eda para el an\u00e1lisis forense de las evidencias electr\u00f3nicas</li> <li>RFC 3227 - Directrices para la recopilaci\u00f3n de evidencias y su almacenamiento</li> </ul>"},{"location":"ud1/#metodologia-y-fases","title":"Metodolog\u00eda y Fases","text":"<ul> <li>Fases fundamentales del an\u00e1lisis forense digital </li> </ul>"},{"location":"ud1/#tipos-de-fuentes-de-evidencia","title":"Tipos de fuentes de evidencia","text":"<ul> <li>Comprendiendo la evidencia digital y sus tipos</li> <li>Los principios de la recopilaci\u00f3n de pruebas digitales </li> <li>SSD, TRIM y Recolecci\u00f3n de basura</li> <li>Discos duros h\u00edbridos SSHD</li> <li>Apple Fusion Drive</li> </ul>"},{"location":"ud1/#el-laboratorio-forense","title":"El laboratorio forense","text":"<ul> <li>\u00bfC\u00f3mo configurar un laboratorio forense digital?</li> </ul>"},{"location":"ud1/#preparacion-del-entorno-de-trabajo","title":"Preparaci\u00f3n del entorno de trabajo","text":"<ul> <li>Borra tus datos o discos duros de forma segura e irrecuperable</li> <li>Taking Snapshots in VMWare</li> <li>Restoring Snapshots in VMWare</li> <li>Snapshots in VirtualBox</li> </ul>"},{"location":"ud1/#adquisicion-de-evidencias","title":"Adquisici\u00f3n de evidencias.","text":"<ul> <li>RFC 3227 - Directrices para la recopilaci\u00f3n de evidencias y su almacenamiento</li> </ul>"},{"location":"ud1/#adquisicion-en-vivo","title":"Adquisici\u00f3n en vivo.","text":""},{"location":"ud1/#adquisicion-en-vivo-memoria-ram","title":"Adquisici\u00f3n en vivo. Memoria RAM","text":"<ul> <li>Impacto de las Herramientas en la Adquisici\u00f3n de la Memoria RAM</li> <li>Memory Imaging Tools (forensicswiki)</li> <li> <p>C\u00f3mo forzar un bloqueo del sistema para generar un volcado de memoria</p> <ul> <li>NotMyFault (info)</li> <li>Download: NotMyFault</li> <li>C\u00f3mo utilizar Dumpchk.exe para comprobar un archivo de volcado de memoria</li> </ul> </li> <li> <p>One-Click Windows Memory Acquisition with DumpIt</p> <ul> <li>Comae | Magnet Idea Lab</li> <li>Download: DumpIT</li> <li>Download: DumpIT (drive)</li> </ul> </li> <li>Adquirir memoria con MAGNET RAM Capture<ul> <li>Download: Magnet RAM Capture</li> <li>Download: Magnet RAM Capture (drive)</li> </ul> </li> <li>Get-FileHash | Obtener el HASH de la captura de RAM</li> <li>Live Memory Acquisition on Linux Systems<ul> <li>Download: LiME ~ Linux Memory Extractor</li> </ul> </li> </ul>"},{"location":"ud1/#adquisicion-en-vivo-comunicaciones-de-red","title":"Adquisici\u00f3n en vivo. Comunicaciones de red","text":"<ul> <li>Apr#ende a usar Wireshark para capturar y analizar el tr\u00e1fico de red</li> <li>tcpdump for Network Analysis</li> <li>Web para practicar la captura de tr\u00e1fico (Login http)</li> </ul>"},{"location":"ud1/#adquisicion-en-vivo-triaje","title":"Adquisici\u00f3n en vivo. Triaje","text":"<ul> <li>An\u00e1lisis Forense Digital con KAPE: Consideraciones t\u00e9cnicas y legales<ul> <li>Download: KAPE (Kroll Artefact Parser &amp; Extractor)</li> </ul> </li> <li>WINTRIAGE. Herramienta de triage para windows<ul> <li>Download: WINTRIAGE</li> </ul> </li> </ul>"},{"location":"ud1/#adquisicion-post-mortem","title":"Adquisici\u00f3n post-mortem","text":""},{"location":"ud1/#adquisicion-post-mortem-memoria-no-volatil","title":"Adquisici\u00f3n post-mortem. Memoria no volatil","text":"<ul> <li>C\u00f3mo bloquear contra escritura cualquier dispositivo USB en Windows 10</li> <li>FTK Imager<ul> <li>Como ejecutar FTK IMAGER desde una unidad Flash (IMAGER LITE)</li> </ul> </li> <li>OSFClone<ul> <li>Como ejecutar OSFClone en un UFD</li> </ul> </li> <li>Guyimager<ul> <li>Guymager in Kali</li> </ul> </li> <li>\"Receta\" para la adquisici\u00f3n f\u00edsica con DD</li> </ul>"},{"location":"ud1/#adquisicion-post-mortem-memoria-volatil","title":"Adquisici\u00f3n post-mortem. Memoria volatil","text":"<ul> <li>C\u00f3mo congelarte el dedo (o cold boot attack)</li> <li>Investigadores logran recuperar datos utilizando la t\u00e9cnica del \u201ctel\u00e9fono congelado\u201d</li> </ul>"},{"location":"ud1/#asegurando-la-evidencia-digital-cadena-de-custodia","title":"Asegurando la evidencia digital. Cadena de custodia","text":"<ul> <li>Securing the Evidence</li> <li>Chain of Custody \u2013 Digital Forensics</li> <li>Collisions for Hash Functions MD4, MD5, HAVAL-128 and RIPEMD</li> <li>Announcing the first SHA1 collision</li> </ul>"},{"location":"ud1/#muy-importante","title":"\u00a1Muy importante!","text":"<p>Necesitamos automatizar nuestro proceso de adquisici\u00f3n y cadena de custodia. Para ello, revisar las normas UNE/ISO/RFC comentadas en clase, elegir la que gust\u00e9is, tenerla bien a mano y revisarla de vez en cuando para aseguraros que estamos siguiendo el proceso adecuado en nuestras adquisiciones y manteniendo adecuadamente la cadena de custodia. </p> <p>Si lo hac\u00e9is, dif\u00edcilmente un tribunal declarar\u00e1 inadmisible las evidencias que present\u00e9is.</p>"},{"location":"ud2/","title":"Windows Forensic Analysis","text":""},{"location":"ud2/#introduccion","title":"Introducci\u00f3n","text":"<p>En esta fase llevaremos a cabo un estudio pormenorizado de los hallazgos de la etapa  anterior. Es  durante el an\u00e1lisis que el responsable del caso identificar\u00e1 aquellos comportamientos, conexiones, ficheros y dem\u00e1s aspectos que puedan ser susceptibles de un uso malintencionado. </p> <p>Para esto, el analista puede hacer uso de las herramientas que crea conveniente, as\u00ed como de referencias externas, siempre y cuando no se altere el estado inicial de las pruebas.</p> <p>Toda la informaci\u00f3n relevante debe ser recogida y categorizada de tal forma que se pueda a\u00f1adir posteriormente al informe de manera comprensible y clara. </p>"},{"location":"ud2/#objetivos","title":"Objetivos","text":"<ul> <li> <p>Analizar las evidencias de manera manual y autom\u00e1tica. </p> </li> <li> <p>Identificar los principales artefactos de los sistemas operativos windows. </p> </li> <li> <p>Documentar el proceso realizado. </p> </li> <li> <p>Establecer la l\u00ednea temporal. </p> </li> <li> <p>Mantener la cadena de custodia. </p> </li> </ul>"},{"location":"ud2/#artifacts","title":"Artifacts","text":"<p>Los artifacts en el contexto del an\u00e1lisis forense digital son datos generados por el sistema operativo y las aplicaciones, que registran las actividades del usuario y del sistema. Sirven para reconstruir eventos, identificar acciones y establecer l\u00edneas de tiempo, siendo cruciales para entender el comportamiento en el sistema investigado.</p>"},{"location":"ud2/#tipos-de-artifacts","title":"Tipos de Artifacts","text":"<ul> <li> <p>Artifacts del Sistema: Incluyen registros de eventos, archivos de configuraci\u00f3n, y archivos de sistema que almacenan datos operativos.</p> </li> <li> <p>Artifacts de Usuario: Documentos, im\u00e1genes, videos y cualquier otro archivo creado por el usuario.</p> </li> <li> <p>Artifacts de Aplicaciones: Historiales de navegaci\u00f3n, logs de aplicaciones, y registros de uso de software.</p> </li> </ul>"},{"location":"ud2/#principales-artifacts-en-sistemas-windows","title":"Principales Artifacts en Sistemas Windows","text":"<ul> <li> <p>Registro de Windows: Incluye informaci\u00f3n de configuraci\u00f3n del sistema, instalaci\u00f3n de software, y perfiles de usuario.</p> </li> <li> <p>Archivos Prefetch: Utilizados para la optimizaci\u00f3n del arranque de aplicaciones, contienen datos sobre programas ejecutados.</p> </li> <li> <p>Event Logs (Registros de Eventos): Registros detallados de actividades del sistema, errores, y acciones de seguridad.</p> </li> <li> <p>Archivos LNK (Accesos Directos): Contienen informaci\u00f3n sobre los archivos y aplicaciones a los que el usuario ha accedido.</p> </li> <li> <p>Thumbcache (Miniaturas): Almacena miniaturas de im\u00e1genes y videos visualizados.</p> </li> <li> <p>Web Browser Artifacts: Historiales, cookies, y cach\u00e9s de navegadores como Edge o Internet Explorer.</p> </li> <li> <p>$MFT (Master File Table): Registro de todos los archivos y carpetas en una partici\u00f3n NTFS.</p> </li> <li> <p>Jump Lists: Listas de archivos y aplicaciones recientemente abiertos.</p> </li> </ul>"},{"location":"ud2/#registro-de-windows","title":"Registro de Windows","text":"<p>El Registro de Windows es una base de datos jerarquica que almacena configuraciones, opciones y configuraciones del sistema operativo y aplicaciones. Es una fuente rica en informaci\u00f3n forense que puede proporcionar detalles sobre las actividades del usuario y del sistema.</p>"},{"location":"ud2/#estructura-del-registro-de-windows","title":"Estructura del Registro de Windows","text":"<p>El Registro de Windows se organiza en una jerarqu\u00eda de colmenas, keys (claves) y valores:</p> <p> </p> <p>Veamos cada uno de los elementos:</p> <p>1. Colmenas (Hives). Son archivos que contienen el conjunto de keys, subkeys y valores. Las principales colmenas son:</p> <ul> <li>HKEY_CURRENT_USER (HKCU): Contiene configuraciones espec\u00edficas del usuario actual.</li> <li>HKEY_USERS (HKU): Incluye informaci\u00f3n de todos los usuarios del sistema.</li> <li>HKEY_LOCAL_MACHINE (HKLM): Almacena configuraciones del sistema y software instalado.</li> <li>HKEY_CLASSES_ROOT (HKCR): Asocia tipos de archivos con programas.</li> <li>HKEY_CURRENT_CONFIG (HKCC): Informaci\u00f3n de configuraci\u00f3n del hardware en uso.</li> </ul> <p> </p> <p>Una colmena en el Registro de Windows es el nombre dado a una secci\u00f3n principal del registro que contiene claves, subclaves y valores del registro. </p> <p>Todas las claves que se consideran colmenas comienzan con \u00abHKEY\u00bb y se encuentran en la ra\u00edz, o en la parte superior de la jerarqu\u00eda del registro, por lo que tambi\u00e9n se denominan a veces claves ra\u00edz o colmenas del sistema central.</p> <p>2. Keys y Subkeys. Funcionan como \"carpetas\" o \"directorios\" dentro del Registro, organizan la informaci\u00f3n en una estructura jer\u00e1rquica. </p> <p>Por ejemplo: </p> <p>HKEY_LOCAL_MACHINE\\System es una key que contiene varias subkeys relacionadas con la configuraci\u00f3n del sistema.</p> <p>3. Valores. Son los datos almacenados dentro de las keys y subkeys. Tienen un nombre y un tipo de dato asociado (como REG_SZ para cadenas de texto, REG_DWORD para n\u00fameros, etc.).</p> <p>Por ejemplo: </p> <p>Dentro de HKEY_CURRENT_USER\\Control Panel\\Desktop, el valor Wallpaper indica la ruta del fondo de escritorio actual.</p>"},{"location":"ud2/#registros-asociados-al-usuario","title":"Registros asociados al usuario","text":"<p>NTUSER.DAT y USRCLASS.DAT son dos archivos que forman parte de las colmenas del Registro de Windows y almacenan diferentes tipos de informaci\u00f3n relacionada con las configuraciones y preferencias del usuario. </p> <p>1. NTUSER.DAT </p> <p>Este archivo almacena la configuraci\u00f3n y preferencias del usuario espec\u00edfico. Incluye informaci\u00f3n como la configuraci\u00f3n del escritorio, historial de navegaci\u00f3n web, rutas de archivos recientes, preferencias de software, etc.</p> <p>Localizaci\u00f3n:</p> <ul> <li> <p>C:\\Users{username}\\NTUSER.DAT -&gt; A partir de WinVista-Win10 </p> </li> <li> <p>C:\\Documents and Settings{username}\\NTUSER.dat -&gt; Hasta XP. </p> </li> </ul> <p>2. USRCLASS.DAT </p> <p>Este archivo est\u00e1 m\u00e1s enfocado en la configuraci\u00f3n y datos relacionados con las aplicaciones espec\u00edficas utilizadas por el usuario, en particular aquellas asociadas con la interfaz de usuario y la experiencia de usuario de Windows.</p> <p>Localizaci\u00f3n:</p> <ul> <li>C:\\Users{username}\\AppData\\Local\\Microsoft\\Windows\\USRCLASS.DAT -&gt; Solo disponible a partir de Win7/Win8/Win10 </li> </ul> <p>USRCLASS.DAT es muy importante porque contiene informaci\u00f3n en cuanto la ejecuci\u00f3n de programas indicando que directorios y han sido abiertos o cerrados. </p> <p>Estos registros de usuario son \u00fanicos para el usuario del sistema, por lo que siempre habr\u00e1 uno para cada usuario.</p>"},{"location":"ud2/#persistencia-del-registro","title":"Persistencia del registro","text":"<p>Los archivos auxiliares de todos los sub\u00e1rboles excepto HKEY_CURRENT_USER se encuentran en la carpeta %SystemRoot%\\System32\\Config</p> <p>Los archivos auxiliares de HKEY_CURRENT_USER est\u00e1n en la carpeta %SystemRoot%\\Profiles\\Username. </p> <p> </p> <p>Si abrimos nuestro Sistema y ejecutamos regedit.exe, veremos que la ra\u00edz del registro es la siguiente: </p> <p> </p>"},{"location":"ud2/#backups-del-registro","title":"Backups del registro","text":"<p>Los sistemas Windows disponen de un backup del registro localizado en %Windir%\\System32\\Config\\RegBack.</p> <p>Esta copia de seguridad se realiza automativamenteb cada 10 d\u00edas, y solo est\u00e1 disponible de Windows Vista en adelante y de Windows 2008 Server en adelante. Otro lugar donde pod\u00edamos encontrar una copia del registro ser\u00eda en las Shadow Copies. </p> <p>Nota: Ya no se realiza una copia de seguridad del registro del sistema en la carpeta RegBack a partir de la versi\u00f3n 1803 de Windows 10.</p>"},{"location":"ud2/#borrado-del-registro","title":"Borrado del registro","text":"<p>Los Hives del registro de Windows tiene espacio libre similar al sistema de archivos, por lo que se podr\u00e1n recuperar keys borradas. Una clave borrada es marcada, pero no es deslocalizada, por lo que permite la recuperaci\u00f3n de: </p> <ul> <li>Keys, Values y TimeStamps </li> </ul> <p>A d\u00eda de hoy no hay herramientas anti forenses que limpien completamente el espacio libre del registro. </p> <p> </p> <p>En la imagen anterior vemos la herramienta Registry Explorer donde aparece en rojo las claves-valor que han sido borradas. M\u00e1s adelante veremos c\u00f3mo funciona esta herramienta. </p>"},{"location":"ud2/#last-write-time","title":"Last Write Time","text":"<p>Dentro del registro tambi\u00e9n hay timestamps y se le llama \u201cLast Write Time\u201d. Como bien dice su nombre, es la \u00faltima vez que se modifica la key-value del registro. Para poder interpretar este campo como una fecha real, es necesario realizar pruebas con la aplicaci\u00f3n que escriba en el registro y poder contextualizar la informaci\u00f3n. </p> <p>Otro elemento que indica un orden temporal es el MRU, que es el acr\u00f3nimo de Most Recenty Used. </p> <ul> <li>Existen varios MRU que son responsables del drop-down sobre un men\u00fa que aparece o cuando tecleas algo en Internet Explorer. </li> <li>En el registro, los MRULists son una Key-Value que son responsables de mantener registrado las adiciones al registro. Por lo tanto, se puede determinar en qu\u00e9 orden se a\u00f1adi\u00f3. </li> <li>La MRUList puede variar en funci\u00f3n del sistema operativo. </li> <li>El Last write de la key ser\u00e1 la fecha del primer MRULIst que ocurri\u00f3 </li> </ul>"},{"location":"ud2/#herramientas-de-analisis","title":"Herramientas de an\u00e1lisis","text":"<p>Windows Registry Recovery</p> <p>Es otro software que permite analizar el registro de Windows, de manera visual. Es muy \u00fatil para obtener qu\u00e9 aplicaciones han sido instaladas, como podemos apreciar en la imagen inferior. </p> <p>En funci\u00f3n del Hive que estemos examinando, la opci\u00f3n que seleccionemos de la izquierda dispondr\u00e1 o no de informaci\u00f3n. </p> <p> </p> <p>** Ver Video:09-WRR </p> <p>RegRipper</p> <p>Es una herramienta escrita en Perl que se encarga de analizar los hives del registro. El an\u00e1lisis no es tan user friendly como lo que presenta Registry Explorer, pero tambi\u00e9n dispone de unos bookmarks o plugins de localizaciones de key-value del Registro con informaci\u00f3n relevante: </p> <p>https://github.com/keydet89/RegRipper2.8/tree/master/plugins </p> <p>En RegRipper tenemos que indicar mediante el campo de Profile cual es el tipo de hive que va analizar. De esta manera cargar\u00e1 los plugins acordemente. </p> <p> </p> <p>El reporte de RegRipper es un fichero de texto que puede ser abierto con cualquier editor. ** Ver video: 002-RegRipper </p>"},{"location":"ud2/#sam","title":"SAM","text":"<p>El fichero SAM o hive SAM, contiene todos los usuarios y grupos que hay a nivel local en el sistema Windows. Tambi\u00e9n dispone de los hashes pertinentes que son validados cuando un usuario hace logon. </p>"},{"location":"ud2/#identificando-usuarios-y-grupos","title":"Identificando Usuarios y Grupos","text":"<p>Del fichero SAM podemos obtener a qu\u00e9 grupo est\u00e1 asignado el usuario, como por ejemplo: </p> <ul> <li>Administradores </li> <li>Usuarios </li> <li>Usuarios del escritorio Remoto </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener del registro SAM del usuario? </p> <p>La informaci\u00f3n se encuentra en SAM\\Domains\\Account\\Users y contiene: </p> <ul> <li>El usuario y el RID asociado a \u00e9l. </li> <li>Variedad de informaci\u00f3n asociado al usuario </li> <li>\u00daltimo login (vac\u00edo si se utiliza una cuenta Microsoft para hacer login) </li> <li>\u00daltimo login fallido </li> <li>Contador de login </li> <li>Pol\u00edtica de passwords </li> <li>Cuando se cre\u00f3 la cuenta. </li> </ul> <p> </p> <p>En la imagen anterior se ve el detalle que el usuario \u201cismis\u201d utiliza una cuenta Microsoft para hacer login, debido a que el campo \u201cLast Logon Time\u201d est\u00e1 vac\u00edo. </p> <p>Con la herramienta WRR se puede identificar correctamente: </p> <p> </p>"},{"location":"ud2/#passwords-en-blanco","title":"Passwords en blanco","text":"<p>Windows 10 implementa un cifrado de hashes, que puede inducir a error, si no es analizado correctamente. Si la herramienta no es capaz de interpretar este nuevo cifrado aparecer\u00e1 que el NTLM-HASH es un blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p> <p>Para poder ver los hashes es necesario tener el SAM y el SYSTEM del sistema. Gracias a la herramienta Windows Password Recovery de Passcape podr\u00edamos verificar su hash: </p> <p> </p> <p>Windows Password Recovery si puede leer el nuevo cifrado AES 128 de Windows, mimikatz tambi\u00e9n. </p> <p> </p> <p>Si no lo leyese bien, aparecer\u00eda un hash blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p>"},{"location":"ud2/#analisis-del-registro-de-windows","title":"An\u00e1lisis del registro de Windows","text":"<p>A continuaci\u00f3n, vamos a identificar las principales claves-valor del registro que pueden ser susceptibles de ser usadas en caso de realizar una investigaci\u00f3n. </p>"},{"location":"ud2/#identificar-la-version-del-sistema","title":"Identificar la versi\u00f3n del sistema","text":"<p>Este artefacto forense, como bien el t\u00edtulo, nos va permitir identificar en el registro la versi\u00f3n del sistema. </p> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion determina: </p> <ul> <li>La versi\u00f3n de Windows </li> <li>Service Pack instalador </li> <li>Fecha de instalaci\u00f3n en formato Epoch Time (n\u00famero de segundos desde el 1/1/1970) </li> <li>En Windows tiene el campo Install Time que sigue el formato de Windows 64 bit, respecto al tiempo </li> </ul> <p> </p> <p>En el registro encontraremos la fecha (Install Time) en decimal, la convertimos a hexadecimal y la pasamos por la herramienta Dcode. </p> <p> </p> <p>DCode: https://www.digital-detective.net/dcode/ </p>"},{"location":"ud2/#nombre-de-la-maquina","title":"Nombre de la m\u00e1quina","text":"<p>Es \u00fatil ya que el nombre de la m\u00e1quina aparece en otras localizaciones pero generalmente se usa para asegurar que estamos trabajando con el equipo correcto. </p> <p>Ruta: System\\ControlSet001\\Control\\ComputerName\\ComputerName </p> <p> </p>"},{"location":"ud2/#zona-horaria","title":"Zona horaria","text":"<p>Es \u00fatil para correlacionar correctamente la actividad en la evidencia: Logs internos del sistema y timestamps estar\u00e1n basadas en esta informaci\u00f3n Antes hab\u00edamos visto los timestamps del registro est\u00e1n en UTC. </p> <p>FAT est\u00e1 asociado a la hora local del sistema y por lo tanto a este par\u00e1metro. NTFS est\u00e1 en UTC. </p> <p>Ruta: System\\ControlSet001\\Control\\TimeZoneInformation </p> <p> </p> <p>Romance Standard Time = Central European TIME: </p> <p>https://en.wikipedia.org/wiki/Central_European_Time** </p>"},{"location":"ud2/#fecha-de-ultimo-acceso","title":"Fecha de \u00faltimo acceso","text":"<p>Por defecto Windows no actualiza la fecha de \u00faltimo acceso. Es una propiedad que se encuentra en el registro: </p> <p>Ruta: System\\ControlSet001\\Control \\Filesystem </p> <ul> <li>Hay que verificar si est\u00e1 activado buscando NtfsDisableLastAccessUpdate = 0 </li> <li>Por defecto viene activada esta opci\u00f3n lo que impide saber cu\u00e1ndo se accedi\u00f3 (Win7-Win10) </li> </ul> <p> </p> <p>Comando para activarlo: fsutil behavior set disablelastaccess 0 </p>"},{"location":"ud2/#interfaces-de-red","title":"Interfaces de Red","text":"<p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Determinar los interfaces de red de la m\u00e1quina </li> <li>Determinar si el sistema tuvo una IP Est\u00e1tica o por DHCP Obtener GUID del interface para hacer correlaciones </li> </ul> <p>Ruta: System\\ControlSet001\\Services\\Tcpip\\Parameters\\Interfaces{GUID_INTERFACE} </p> <p> </p> <p>Esta informaci\u00f3n aparece mucho mejor representada en el WRR: </p> <p> </p>"},{"location":"ud2/#historico-de-redes","title":"Hist\u00f3rico de Redes","text":"<p>\u00bfQu\u00e9 podemos encontrar? </p> <ul> <li>Identificar redes a la que el equipo se conect\u00f3 </li> <li>Identificar si las redes eran cableadas o inal\u00e1mbricas </li> <li>Identificar el nombre dominio </li> <li>Identificar el SSID </li> <li>Identificar la MAC Address del gateway </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Unmanaged </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Managed </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Nla\\Cache </li> </ul> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Primera y \u00faltima vez que se produjo la conexi\u00f3n a la red </li> <li>Listar conexiones que han sido conectadas a trav\u00e9s de VPN </li> </ul> <p> </p>"},{"location":"ud2/#cuando-se-conecto-a-una-red","title":"Cuando se conect\u00f3 a una Red","text":"<p>Prop\u00f3sito: </p> <ul> <li>Identificar el tipo de red a la que se conect\u00f3 </li> <li>Identificar el SSID de la red inal\u00e1mbrica </li> <li>El timestamp de este artefacto est\u00e1 en local time. </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\WZCSVC\\Parameters\\Interfaces{GUID} -&gt; XP </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles -&gt; Win7-Win10 </li> </ul> <p>Si la maquina es Win7-Win10 el tipo de red (NameType) viene definido de la siguiente manera: </p> <ul> <li>0x47 -&gt; Wireless </li> <li>0x06 -&gt; Cableada </li> <li>0x17 -&gt; 3G </li> </ul> <p>Categor\u00eda: </p> <ul> <li>Public -&gt; 0 </li> <li>Private / Home -&gt; 1 </li> <li>Domain /Work 2 </li> </ul> <p> </p> <p>Podemos identificar tambi\u00e9n DateCreated y DateLastConnected. Usando Windows 128 bit time y est\u00e1 almacenado en local time. </p> <p> </p> <p>Con el ProfileGUID {54ADAF4F-0492-458F-96EA-652ED5ABD35C} podemos mapear informaci\u00f3n hist\u00f3rica. </p>"},{"location":"ud2/#carpetas-compartidas","title":"Carpetas Compartidas","text":"<p>\u00bfQu\u00e9 podemos identificar? </p> <ul> <li>Carpetas compartidas a nivel local </li> <li>Configuraci\u00f3n de dichas carpetas compartidas </li> </ul> <p>Ruta: *System\\ControlSet001\\Services\\lanmanserver\\Shares* Flags: </p> <ul> <li>CSCFlags: Caching Setting </li> <li>MaxUses: Usuarios m\u00e1ximos </li> <li>Permissions: Permisos de la carpeta </li> <li>Remark: Comentarios del usuario a\u00f1adidos </li> <li>Type: Tipo de compartici\u00f3n </li> </ul> <p> </p> <p>Client Side Caching </p> <p>Esta opci\u00f3n aparece dentro del CSCFLAGS: Si se comparte la carpeta con el Client Side Caching, si el cliente est\u00e1 desconectado de la red, dispondr\u00e1 de una copia del fichero en su sistema. </p> <p> </p> <p>La copia de estos ficheros se guardan tanto en el cliente como en el servidor en la ruta C:\\Windows\\CSC: </p> <ul> <li>CSCFlag=0 -&gt; Opci\u00f3n por defecto, donde el usuario debe indicar que ficheros quiere cachear </li> <li>CSCFlag=16 -&gt; Cacheo de documentos autom\u00e1ticos. \u201cAll files and programs that users open from the shared folder are automatically available offline\u201d with the \u201coptimize for perforance. </li> <li>CSCFlag=32 Igual que la opci\u00f3n anterior pero con la opci\u00f3n de \u201cOptimizado para rendimiento\u201d </li> <li>CSCFlag=48 Cach\u00e9 deshabilitada. </li> <li>CSCFlag=2048: Opci\u00f3n por defecto en Win7-Win10 hasta que el usuario deshabilita \u201cSimple File Sharing\u201d o utiliza las opciones avanzadas de compartici\u00f3n. Por defecto tambi\u00e9n el \u201cHomegroup\u201d </li> </ul> <p>Maxuses: n\u00famero total de conexiones a una compartici\u00f3n simple. Es un dato para limitar las conexiones. Por defecto 4294967295 para 32 bits. </p> <p>Path: directorio local. </p> <p>Permissions: aparentemente, este valor puede ayudar a determinar c\u00f3mo se comparti\u00f3 una carpeta. 0 es para cuando el valor ha sido creado mediante GUI o Powershell. </p> <ul> <li>Para Windows 7-Windows10, el valor es 9 si fue creado con el advanced file sharing y 63 si fue mediante l\u00ednea de comandos. </li> </ul> <p>Type: tipo de dispositivo o recurso accedido </p> <ul> <li>0 = Disk Drive/ Folder </li> <li>1 = Impresora </li> <li>3 = IPC </li> <li>2147483 = Admin (Disk,Printer, Device o IPC) </li> </ul>"},{"location":"ud2/#autostart-programs","title":"AutoStart Programs","text":"<p>\u00bfQu\u00e9 obtenemos? </p> <ul> <li>Determinar qu\u00e9 programas se ejecutan autom\u00e1ticamente </li> <li>\u00datil para localizar malware </li> <li>Determinar la \u00faltima fecha de cu\u00e1ndo se actualiz\u00f3 (generalmente \u00faltimo arranque del sistema) </li> </ul> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Runonce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> </ul> <p> </p>"},{"location":"ud2/#informacion-de-apagado","title":"Informaci\u00f3n de Apagado","text":"<p>Ruta: </p> <ul> <li>System\\ControlSet001\\Control\\Windows (Hora de apagado) </li> <li>System\\ControlSet001\\Control\\Watchdog\\Display (Shutdown count) \u2013 solo XP </li> </ul> <p>Las fechas est\u00e1n en HEX en formato Windows 64 Little Endian </p> <p> </p> <p> </p>"},{"location":"ud2/#busqueda-en-win7","title":"B\u00fasqueda en Win7","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordwheelQuery </p> <p>Aunque Windows vista no tiene almacenados los valores de b\u00fasqueda en el registro, Windows 7/8/10 s\u00ed. </p> <p> </p>"},{"location":"ud2/#busqueda-en-win-8-10","title":"B\u00fasqueda en Win 8 /10","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery </p> <ul> <li>Como Windows 8/10 pierde el bot\u00f3n de Inicio, las b\u00fasquedas quedan limitadas a la barra de b\u00fasqueda del Explorer. </li> <li>Las b\u00fasquedas son almacenadas en orden temporal. </li> <li>MRU = 0 es la \u00faltima b\u00fasqueda </li> </ul> <p> </p>"},{"location":"ud2/#typed-paths-windows-10","title":"Typed Paths Windows 10","text":"<p>Muestra como se ha escrito una ruta en el men\u00fa de inicio o en la barra del Explorer. Es \u00fatil para demostrar que el usuario conoc\u00eda con antelaci\u00f3n la ruta exacta. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths </p> <p> </p>"},{"location":"ud2/#recent-docs","title":"Recent Docs","text":"<p>Documentos recientes que han sido abiertos por el usuario desde Windows XP a </p> <p>Win10. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs </p> <p> </p> <p>MRU = 0 ser\u00eda el m\u00e1s actual </p>"},{"location":"ud2/#office-recent-docs","title":"Office Recent Docs","text":"<p>Este artefacto forense muestra los documentos ofim\u00e1ticos recientes, abiertos por el usuario: Ruta: NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\FileMRU </p> <ul> <li>14.0 Office 2010 </li> <li>12.0 Office 2007 </li> </ul> <p>NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\ UserMRU\\LiveID_###\\FileMRU -&gt; Office 365 </p> <ul> <li>15.0 office 2013 </li> <li>16.0 Office 2016 </li> </ul> <p>La clave FileMRU tendr\u00e1 una lista de los ficheros m\u00e1s recientes de office ordenados del 1-50. </p> <p> </p> <p>Dentro de este artefacto lo interesante es que viene la ruta completa si es comparada con el directorio \u201cRecent Docs\u201d que veremos m\u00e1s adelante. </p> <p>En la misma localizaci\u00f3n dentro de los Office 365 aparece una key llamada PlaceMRU, el cual muestra la localizaci\u00f3n del path previamente abierto en ese directorio. </p> <p>Los 8 bytes que hay a continuaci\u00f3n de la letra T es un timestamp en formato Windows 64 Big Endian. </p> <p> </p>"},{"location":"ud2/#auroguardado-de-ficheros-office","title":"Auroguardado de Ficheros Office","text":"<p>Los ficheros de autoguardado est\u00e1n en la carpeta: </p> <p>Ruta: *C:\\Usuarios\\\\AppData\\Roaming\\Microsoft{Excel|Word|Powerpoint}* <ul> <li>Ficheros con extensi\u00f3n .asd </li> </ul> <p> </p> <p>El fichero se renombra y ya podr\u00eda ser abierto. </p>"},{"location":"ud2/#eventos-de-windows","title":"Eventos de Windows","text":"<p>Los eventos de Windows son registros detallados de actividades y operaciones del sistema, proporcionando informaci\u00f3n valiosa sobre el comportamiento del sistema, seguridad, y actividades de los usuarios. Son fundamentales para la detecci\u00f3n de problemas y an\u00e1lisis forense.</p> <p>Los eventos son recolectados y almacenados por el Servicio de Registro de Eventos.</p> <p> </p>"},{"location":"ud2/#tipos-de-eventos","title":"Tipos de Eventos","text":"<ul> <li> <p>Eventos de Aplicaciones: Registra actividades relacionadas con aplicaciones instaladas, como errores de ejecuci\u00f3n y conflictos.</p> </li> <li> <p>Eventos de Seguridad: Contiene registros de acceso, cambios de permisos, y acciones relacionadas con la seguridad del sistema.</p> </li> <li> <p>Eventos del Sistema: Incluye informaci\u00f3n sobre operaciones del sistema operativo, como arranques y apagados del sistema, y errores del sistema.</p> </li> </ul>"},{"location":"ud2/#ubicacion-de-los-archivos-de-eventos","title":"Ubicaci\u00f3n de los Archivos de Eventos","text":"<p>Los podemos encontrar en las siguientes rutas. </p> <p> </p> <p>Nos podemos encontrar dos tipos de eventos: </p> <ul> <li> <p>Event log en formato Binario (antes de Windows Vista)</p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extensi\u00f3n en (.evt) </li> </ul> </li> <li> <p>Event log en formato XML (de Windows Vista en adelante) </p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extension (.evtx) </li> <li>200 tipos de ficheros m\u00e1s que el formato antiguo </li> <li>Ahora incluyen direcciones IP </li> </ul> </li> </ul> <p>Las localizaciones de los ficheros de eventos las podemos localizar en el registro SYSTEM en la siguiente ruta: </p> <p>HKLM\\SYSTEM\\CurrentControlSet\\Services\\EventLog{Application|System|Security} </p> <p> </p> <p>Existen tambi\u00e9n otros tipos de eventos que no son del sistema operativo Windows, como aplicaciones de terceros, Exchange, Sysmon, SQL Server. </p>"},{"location":"ud2/#que-podemos-obtener-de-los-eventos-de-windows","title":"\u00bfQu\u00e9 podemos obtener de los eventos de Windows?","text":"<ul> <li>\u00bfQu\u00e9 ocurri\u00f3? (Identificador del Evento, Categor\u00edas del Evento, Descripci\u00f3n) </li> </ul> <p>Los registros de eventos est\u00e1n dise\u00f1ados para proporcionar informaci\u00f3n muy espec\u00edfica sobre las actividades ocurridas en el sistema. </p> <ul> <li>\u00bfCu\u00e1l fue el d\u00eda y la hora? (Marcas de Tiempo) </li> </ul> <p>Las marcas de tiempo son una parte clave de los registros de eventos, pues proporcionan un contexto temporal. Con sistemas registrando miles de eventos, las marcas de tiempo pueden tambi\u00e9n ayudar al investigador a acercar su enfoque. </p> <ul> <li>\u00bfQui\u00e9nes son los usuarios involucrados? (Cuenta de Usuario, Descripci\u00f3n) </li> </ul> <p>Cualquier cosa hecha dentro de Windows es realizada dentro del contexto de una cuenta. Se puede identificar referencias hacia usuarios espec\u00edficos, como tambi\u00e9n informaci\u00f3n sobre las actividades del sistema operativo Windows realizadas mediante una cuenta especial como System o NetworkService. </p> <ul> <li>\u00bfCu\u00e1les son los sistemas involucrados? (Nombre del Host, Direcci\u00f3n IP) </li> </ul> <p>En un entorno de red, es muy com\u00fan encontrar referencias hacia otros sistemas aparte del host, como recursos siendo accedidos remotamente. Originalmente s\u00f3lo el nombre Netbios era registrado, haciendo el rastreo y la atribuci\u00f3n mucho m\u00e1s dif\u00edcil. En sistemas m\u00e1s recientes, la direcci\u00f3n IP es registrada dentro del registro de eventos (Cuando aplica). </p> <ul> <li>\u00bfCu\u00e1les recursos se accedieron? (Archivos, Carpetas, Impresoras, Servicios) </li> </ul> <p>El Servicio de Registro de Eventos puede ser configurado para almacenar informaci\u00f3n muy granular relacionada a la utilizaci\u00f3n de varios objetos del sistema. Con casi todos los recursos considerados como un objeto, esto proporciona una muy poderosa auditor\u00eda. Como un ejemplo; puede ayudar a identificar intentos de acceso no autorizado hacia los archivos del sistema. </p>"},{"location":"ud2/#eventos-de-seguridad","title":"Eventos de Seguridad","text":"<p>Los eventos de seguridad son solo actualizados por el proceso LSASS (Local Security Authority Subsystem Service). Se encuentran en C:\\Windows\\System32\\winevt\\Security.evtx </p> <p>Solo con permisos de administrador se pueden ver, exportar o eliminar. Tienen un tama\u00f1o m\u00e1ximo, pero es configurable como vemos a continuaci\u00f3n: </p> <p> </p> <p>Normalmente, el escenario es que veremos, es que, una vez alcanzado el tama\u00f1o asignado, se sobrescribir\u00e1 los eventos m\u00e1s viejos, es decir un fichero circular. </p> <p>\u00bfQu\u00e9 podemos identificar en los eventos de seguridad? </p> <ul> <li>Login logoff </li> <li>Conducta y acciones del usuario </li> <li>Acceso a Archivos, Directorios y recursos compartidos </li> <li>Modificaciones de la configuraci\u00f3n de seguridad </li> </ul> <p>Los eventos est\u00e1n identificados por ID, y en funci\u00f3n de ese identificador podremos identificar que ha ocurrido. En la siguiente web podemos encontrar una descripci\u00f3n exhaustiva de todos los identificadores: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2/#eventos-relacionados-con-la-autenticacion-del-usuario","title":"Eventos relacionados con la autenticaci\u00f3n del usuario","text":"<p>Eventos de relacionados con la autenticaci\u00f3n del usuario del sistema Windows: </p> EventID Descripci\u00f3n 4624 Evento de autenticaci\u00f3n satisfactorio 4625 Evento de fallido de autenticaci\u00f3n 4634/4647 Log off 4672 Logon con permisos de administrador Ejemplo de evento 4625 <p> </p> <p>Ejemplo de evento 4634 Log OFF </p> <p> </p> <p>Ejemplo de evento 4672 logon especial </p> <p> </p> <p>Dentro del Evento 4624/4625 encontramos los siguientes subtipos:</p> <ul> <li>2 -&gt; Interactive: este tipo de autenticaci\u00f3n involucra la utilizaci\u00f3n del teclado y pantalla del sistema, o la utilizaci\u00f3n de terceras herramientas remotas como VNC o PSexec -U- </li> <li>3 -&gt; Network: conexi\u00f3n a una carpeta compartida del propio equipo . </li> <li>4 -&gt; Batch: tambi\u00e9n v\u00e1lido para las tareas programadas, donde los procesos son ejecutados en nombre de otro. </li> <li>5 -&gt; Service: servicios arrancados por el Service Control Manager </li> <li>7 -&gt; Desbloqueo de pantalla con password </li> <li>8 -&gt; Network Cleartext: el usuario se ha autenticado en la m\u00e1quina desde la red pero sus credenciales no han sido hasheadas. Este tipo de evento suele provenir de la autenticaci\u00f3n realizada mediante Internet Information Services (IIS), servidor Web de Microsoft. </li> <li>9 -&gt; NewCredentials: es generado cuando se ejecuta un comando con RunAs desde la CMD o se conecta con una unidad de red, con credenciales distintas a las de la propia sesion. </li> <li>10 -&gt; Remote Interactive: este tipo de autenticaci\u00f3n se produce cuando una autenticaci\u00f3n se realiza mediante Terminales Services o Remote Desktop Protocol. </li> <li>11 -&gt; CachedInteractive: se autentica con las credenciales \u00faltimas cacheadas ya que no ha sido posible contactar con el controlador de dominio. </li> </ul> <p>Ejemplo de evento 4624 tipo 2: </p> <p> </p> <p>Dentro del evento 4625 se puede indicar el tipo de error al autenticarse mediante los estados y subestados: </p> <p> </p> <p>Ejemplo de evento 4625 con subestados: </p> <p> </p>"},{"location":"ud2/#herramientas-para-analisis","title":"Herramientas para An\u00e1lisis","text":"<p>Los eventos del sistema los podemos visualizar desde la propia gesti\u00f3n de eventos o Event Viewer de Windows (eventvwr.msc) o podemos utilizar una herramienta que nos permita trabajar tanto de manera live como de manera post-mortem. </p> <p>WinLogOnView - Herramienta para mostrar informes de inicios/cierres de sesi\u00f3n en Windows, incluyendo detalles como hora, usuario y duraci\u00f3n.\u00datil para rastrear accesos inusuales o sospechosos al sistema.</p> <p>EventLogExplorer - Herramienta avanzada para visualizar, analizar y monitorear eventos en los registros de Windows, con interfaz intuitiva y opciones de filtrado. Permite buscar eventos espec\u00edficos y patrones de comportamiento en grandes vol\u00famenes de datos de registro.</p> <p>**FullEventLogView ** - Permite ver y exportar los detalles de todos los eventos en los registros de Windows. Ligera y no requiere instalaci\u00f3n. Ideal para extracciones r\u00e1pidas y revisiones generales de los registros de eventos.</p> <p>La herramienta que nos va permitir realizar carving de este tipo de ficheros es Bulk_extractor, bastar\u00eda con proporcionarle una imagen f\u00edsica o l\u00f3gica y marcar el esc\u00e1ner como se muestra en la imagen de a continuaci\u00f3n: </p> <p> </p> <p>Esta herramienta la veremos en la parte de carving.</p>"},{"location":"ud2/#analisis-de-casuisticas-mas-comunes-en-cuanto-a-seguridad","title":"An\u00e1lisis de casu\u00edsticas m\u00e1s comunes en cuanto a seguridad.","text":"<p>Algunas situaciones que podremos identificar mediante eventos del sistema. </p> <p>1. BruteForce Attack </p> <p>Un ataque de fuerza bruta se podr\u00e1 realizar mediante el intento de autenticaci\u00f3n del usuario hasta que consiga acceso al sistema. Veremos muchos eventos 4625 y a continuaci\u00f3n un 4624 </p> <p> </p> <p>2. Remote Desktop Protocol </p> <p>El remote Desktop Protocol, es el protocol de Windows para poder conectarse a otra m\u00e1quina, mediante credenciales, es decir, un escritorio remoto. </p> <p>En el Security Event Log: </p> <ul> <li>Sesi\u00f3n conectada: Event ID 4778 (incluye direcci\u00f3n IP y Hostname) </li> <li>Sesi\u00f3n desconectada: Event ID 4779 (incluye direcci\u00f3n IP y Hostname) </li> <li>Autenticaci\u00f3n Satisfactoria Event ID 4624 Tipo ( 10 y 7 para reconexi\u00f3n) </li> </ul> <p>Logs auxiliares: </p> <ul> <li>Remote Desktop Services \u2013 RDPCoreTS (Event ID 131) </li> <li>TerminalServices-RemoteConnectionManager%40Operational) (Event ID 1149) </li> <li>Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx (Event ID 21 y 22) </li> </ul> <p>Conexi\u00f3n Satisfactoria</p> <p>Conexi\u00f3n satisfactoria mediante escritorio remoto </p> <p> </p> <p>Ejemplo de evento 1149 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 4624 tipo 7: </p> <p> </p> <p>Ejemplo de evento 21 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 22 con IP Origen: </p> <p> </p> <p>Conexi\u00f3n no satisfactoria </p> <p>La autenticaci\u00f3n no satisfactoria mediante RDP </p> <p> </p> <p>Evento 4625 tipo 2: </p> <p> </p> <p>Conexi\u00f3n LogOFF </p> <p>Desconexi\u00f3n de la consola de escritorio remoto mediante log off solicitado por el usuario. </p> <p> </p> <p>Reconexi\u00f3n </p> <p>Conexi\u00f3n de nuevo con la consola de escritorio remoto </p> <p> </p> <p>Sesi\u00f3n desconectada </p> <p>Sesi\u00f3n desconectada, cerrando la ventana de escritorio remoto </p> <p> </p> <p>3. Cambio de Hora </p> <p>El cambio de hora de un sistema, es una de las peores situaciones que se puede dar para un investigador ya que todos los timestamps quedan modificados: </p> <p>Al hacer un cambio de hora se produce el Evento 4616 dentro de Security.evtx </p> <p> </p> <p>4. Dispositivos USB </p> <p>A parte de todos los artefactos que hemos visto anteriormente para la identificaci\u00f3n de USBs, tambi\u00e9n podemos utilizar los eventos de System: </p> <ul> <li>20001 /20003 contiene cuando se insert\u00f3 por primera vez. </li> <li>10000 contiene cuando se insert\u00f3 por primera vez </li> <li>10100 contiene el log de cuando se actualiz\u00f3 el driver. </li> </ul> <p>Ejemplo de evento 20001 </p> <p> </p> <p>Tambi\u00e9n se puede localizar el n\u00famero de serie en la anterior captura junto con la marca y modelo, en el evento 20003 </p> <p> </p> <p>Eventos de Microsoft-Windows-DeviceSetupManager%4Admin.evtx </p> <ul> <li>Event ID 112: contiene el timestamp de cada dispositivo USB insertado en el sistema. Para correlar, es necesario conocer el ContainderID del USBSTOR key del registro que vimos previamente. </li> </ul> <p> </p> <p>El Container ID concuerda con lo que se vio en la parte de Registro: </p> <p> </p> <p>5. Apagado/arranque del Sistema </p> <p>Identificaci\u00f3n del arranque del Sistema mediante el arranque del servicio \u201cEvent Log\u201d en el evento 6005 </p> <p> </p> <p>Identificaci\u00f3n del apagado del sistema mediante la parada del servicio \u201cEvent Log\u201d mediante el evento 6006 </p> <p> </p> <p>Identificaci\u00f3n de un apagado inesperado mediante el evento 6008: </p> <p> </p> <p>Identificaci\u00f3n del tiempo que lleva encendido del sistema: </p> <p> </p> <p>Apagado del servicio \u201cEvent Log\u201d mediante el evento id 1100 en Security </p> <p> </p> <p>6. Vaciado de Logs </p> <p>Vaciado del fichero Security.evtx, identificado mediante el evento id 1102 </p> <p> </p> <p>Para m\u00e1s informaci\u00f3n de eventos de Windows se puede utilizar la siguiente p\u00e1gina: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2/#dispositivos-usb","title":"Dispositivos USB","text":"<p>Los dispositivos de almacenamiento USB son muchas veces objetos de investigaci\u00f3n, debido a que son utilizados para copiar ficheros/carpetas. \u00bfQu\u00e9 informaci\u00f3n podemos obtener siempre de un dispositivo USB? </p> <ul> <li>Vendor/Make/Versi\u00f3n </li> <li>N\u00famero de serie \u00fanico </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener relacionada con un dispositivo de almacenamiento USB? </p> <ul> <li>Determinar la unidad asignada y el nombre del volumen </li> <li>Encontrar el usuario que utiliz\u00f3 ese dispositivo USB </li> <li>Descubrir la primera vez que el dispositivo USB fue conectado </li> <li>Determinar la \u00faltima vez que el dispositivo USB fue conectado </li> <li>Determinar cuando el dispositivo fue quitado del sistema </li> </ul> <p>\u00bfCu\u00e1les son los artefactos forenses que podemos utilizar para identificar la copia de un fichero a un dispositivo de almacenamiento USB? </p> <ol> <li>Windows Registry Hives: </li> <li>System </li> <li>Software </li> <li>Ntuser.dat </li> <li>Setupapi.dev.log </li> <li>Shell Items </li> <li>Jumplists </li> <li>LNK Files </li> <li>ShellBags </li> </ol>"},{"location":"ud2/#mass-storage-device","title":"Mass Storage Device","text":"<p>Tambi\u00e9n conocidos como dispositivos de almacenamiento (USB Mass Storage). En Windows son montados autom\u00e1ticamente siempre que el sistema de archivos sea compatible con Windows. </p> <p> </p>"},{"location":"ud2/#picture-transfer-protocol","title":"Picture Transfer Protocol","text":"<p>Desarrollado por el International Imaging Industry Association. Un dispositivo PTP en </p> <p>Windows: </p> <ul> <li>No tiene acceso al sistema de archivos </li> <li>Solo tiene acceso a im\u00e1genes y archivos de video </li> <li>Dispone Exploraci\u00f3n limitada y l\u00f3gica del contenido </li> </ul> <p> </p>"},{"location":"ud2/#media-transfer-protocol","title":"Media Transfer Protocol","text":"<p>\u00bfQu\u00e9 caracter\u00edsticas tiene el MTP? </p> <ul> <li>Mejora y extensi\u00f3n del PTP. </li> <li>No tiene acceso al sistema de archivos. </li> <li>Acceso a la tarjeta interna y SD. </li> <li>Dentro de Windows es montado como un dispositivo portable </li> </ul> <p> </p>"},{"location":"ud2/#identificar-evidencias-de-uso-dispositivos-usb","title":"Identificar evidencias de uso dispositivos USB","text":"<p>MSC USB </p> <p>Creaci\u00f3n de ficheros LNK para todos los ficheros que hayan sido abiertos </p> <ul> <li>Windows Recent Folder </li> <li>Microsoft Office Recent Folder </li> <li>Jumplist: Automatic Destinations </li> </ul> <p>MTP USB </p> <p>Windows puede o no puede crear ficheros LNK. Depende de la aplicaci\u00f3n y del tipo de archivo. Algunos MTP LNK no apuntan a la fuente MTP pero apunta al WPDNSE folder: C:\\users\\\\Appdata\\Local\\Temp\\WPDNSE{GUID} <p> </p> <p>Los ficheros DOC no apuntan a la fuente original sino a un directorio temporal. Solo ocurre con los documentos office. </p> <ul> <li>Los ficheros JPG si dejan un LNK verdadero a la fuente original. </li> <li>Los ficheros PDF, TXT y XLS no producen ning\u00fan fichero LNK. </li> </ul> <p>\u00bfQu\u00e9 contiene el directorio temporal WPDNSE? </p> <ul> <li>Mantiene una copia del fichero </li> <li>El directorio es temporal y no sobrevive a un reinicio </li> <li>El GUID se saca de una Shellbag</li> </ul>"},{"location":"ud2/#usbstor","title":"USBStor","text":"<p>El registro USBstor, se encarga de monitorizar cualquier dispositivo USB que haya sido conectado a la m\u00e1quina: </p> <p>Ruta: SYSTEM\\ControlSet001\\Enum\\USBSTOR </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Se puede identificar al fabricante, el producto y la versi\u00f3n de un dispositivo MSC que est\u00e1 conectado a la m\u00e1quina. </li> <li>Identificar un \u00fanico dispositivo USB que ha sido conectado a la m\u00e1quina. </li> <li>Determinar el tiempo por el cual el dispositivo estaba conectado a la m\u00e1quina </li> <li>Identificar el n\u00famero de serie f\u00edsico del dispositivo USB. </li> </ul> <p> </p> <p>En rojo el n\u00famero de serie del dispositivo. En azul el Device Class ID. </p>"},{"location":"ud2/#identificacion-de-vidpid","title":"Identificaci\u00f3n de VID/PID","text":"<p>Para localizar estos valores debemos de recurrir a SYSTEM\\ ControlSet001\\Enum\\USB: </p> <ul> <li>VID: Vendor ID </li> <li>PID: Product ID </li> </ul> <p> </p> <p>VID:0930 y PID:6544 </p> <p> </p>"},{"location":"ud2/#obtener-el-nombre-del-volumen","title":"Obtener el nombre del volumen","text":"<p>Ruta: SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices Aplica para MSC, </p> <p>MTP y PTP. </p> <ul> <li>Se relaciona el dispositivo USB F\u00edsico, que dispone de un n\u00famero de serie con un nombre de Volumen. </li> <li>El nombre del volumen puede ser mapeado a una unidad mediante los ficheros LNK </li> </ul> <p> </p> <p> </p> <p>Para las capturas de imagen anteriores, el nombre del volumen es DATA. </p>"},{"location":"ud2/#obtener-la-ultima-unidad-asignada","title":"Obtener la \u00faltima unidad asignada","text":"<p>Solo MSC que sean discos de almacenamiento externos aplica la siguiente casu\u00edstica para la ruta del registro: System\\MoutedDevices. </p> <p>Los dispositivos particionados con MBR dejan una firma de 4 bytes, en el registro, la clave MoutedDevices. Para el particionado en GPT deja el GUID del tipo de partici\u00f3n. 89 </p> <p>La firma del MBR se encuentra el primer sector en el offset 0X1B8 o 440 del disco </p> <p> </p> <p> </p> <p>Tambi\u00e9n podemos obtener la \u00faltima unidad asignada analizando la clave de registro System\\MoutedDevices: </p> <p> </p>"},{"location":"ud2/#localizar-el-usuario-que-ha-utilizado-el-usb","title":"Localizar el usuario que ha utilizado el USB","text":"<ol> <li>El primer paso es localizar el GUID del Volumen en SYSTEM\\mountedDevices. Localizando el n\u00famero de serie dentro del mismo. </li> </ol> <p>\\??\\Volume{2e1ce865-c747-11e8-add4-34238779763e} </p> <ol> <li>Y luego este GUID asociarlo al NTUSER.DAT del usuario: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Mountpoin </li> </ol> <p>ts2 </p> <p> </p> <p>Ha sido encontrado dentro del NTUSER.DAT del usuario ismis. </p>"},{"location":"ud2/#volume-serial-number","title":"Volume Serial Number","text":"<p>El volumen serial number, es el n\u00famero de serie del volumen l\u00f3gico del sistema de archivos: </p> <ul> <li>No confundir con el n\u00famero de serie f\u00edsico del dispositivo. </li> <li>Solo dispositivos MSC </li> </ul> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion\\EMDMgmt </p> <p> </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <p>Sabiendo el nombre del volumen y el serial number del volumen pueden correlacionar la informaci\u00f3n con los ficheros LNK y la clave de registro RecentDocs </p> <p>Este artefacto depender\u00e1 de si el servicio ReadyBoost est\u00e1 habilitado o no. \u00bfQu\u00e9 informaci\u00f3n hay en EMDMgmt Key? </p> <ul> <li>Fabricante, ID y Serial number </li> <li>Volume Name del sistema de archivos, muy \u00fatil para relacionar con los LNK. </li> </ul> <p>\u00bfQu\u00e9 pasar\u00eda si el dispositivo USB es reformateado? Un formateo solo escribe los datos necesarios para tener de nuevo un sistema de archivos \u201climpio\u201d. No realiza ning\u00fan borrado. </p> <ul> <li>Tendr\u00edamos un nombre de volumen nuevo </li> <li>Tendr\u00edamos un nuevo volumen serial number </li> <li>Pero se mantiene el serial number f\u00edsico del dispositivo. </li> </ul>"},{"location":"ud2/#timestamps","title":"Timestamps","text":"<p>Primera y \u00faltima vez que se conect\u00f3 al dispositivo Ruta: </p> <p>*System\\ControlSet001\\Enum\\USBSTOR{VEN_PROD_VERSION}{USB serial}\\Properties{83da6326-97\u00aa6-4088-9453-a1923f573b29}* </p> <ul> <li>Win7 y Win8 -&gt; Primera conexi\u00f3n -&gt; 0064 </li> <li>Win8 en adelante -&gt; Ultima conexi\u00f3n -&gt; 0066 </li> <li>Win8 en adelante -&gt; Fecha de desconexi\u00f3n con independencia de si es quitado con seguridad o sin ella. -&gt; 0067 </li> </ul> <p> </p> <p>Timestamps 64 bits Hex Windows Time Little Endian pero Registry Explorer los interpreta: </p> <ul> <li>0064: 10/3/2018 8:06:48 PM +00:00 </li> <li>0066: 10/3/2018 8:24:46 PM +00:00 </li> <li>0067: 10/3/2015 9:17:12 PM +00:00 </li> </ul> <p>Tambi\u00e9n podemos analizar el fichero SetupApi.dev.log para obtener timestamps de cuando se produjo la conexi\u00f3n USB: </p> <p>Ruta: </p> <ul> <li>XP -&gt; C:\\Windows\\setupapi.log </li> <li>Win7-Win10 -&gt; C:\\Windows\\inf\\setupapi.dev.log </li> </ul> <p>Los timestamps est\u00e1n local time. </p> <p> </p> <p>Tambi\u00e9n podemos utilizar los eventos del sistema para localizar los timestamps, a partir de Windows 7 / 8 / 10. Lo veremos m\u00e1s adelante. </p> <p>Herramientas para realizar todos estos pasos de manera autom\u00e1tica: USB Detective </p> <p> </p> <p>** Ver Video:14-USB Detective </p> <p>Los datos concuerdan con lo que hemos analizado anteriormente. Incluso el VSN o volumen serial number no ha sido capaz de encontrarlo como nosotros.</p>"},{"location":"ud2/#identificacion-y-analisis-de-artefactos-forenses-propios-del-sistema-de-archivos","title":"Identificaci\u00f3n y an\u00e1lisis de artefactos forenses propios del sistema de archivos","text":""},{"location":"ud2/#index-records","title":"$INDEX Records","text":"<p>NTFS indexa la informaci\u00f3n de cada directorio en un B+ Tree: </p> <p> </p> <p>FTK analiza el sistema de archivos y lo representa como un fichero m\u00e1s ($I30), seg\u00fan vemos en la imagen superior. </p> <p>Este atributo contiene informaci\u00f3n sobre los nombres de archivo y directorios que hay almacenados y que hubo dentro de \u00e9l. Este atributo es tambi\u00e9n conocido como $INDX y contiene: </p> <ul> <li>$INDEX_ROOT = 0x90 </li> <li>$INDEX_ALLOCATION = 0xA0 </li> <li>$BITMAP = 0XB0 </li> </ul> <p>Cuando borras un fichero de un directorio, el atributo $I30 queda de manera de slack space y se puede encontrar evidencias de que existi\u00f3. Es decir, dentro del propio fichero $I30 tenemos slack space. </p> <p> </p> <p>En la captura se identifica el fichero Uforia.pdf como $I30 INDX Entry. Es decir, esta entrada est\u00e1 dentro del $I30. \u00bfQu\u00e9 herramienta podemos utilizar para analizar el fichero $I30? </p> <p>IndexCSV </p> <p> </p> <p>Muy importante marcar la opci\u00f3n de Slack para que pueda obtener dentro del slack space del fichero I30 los registros que hubo. </p> <p>** Ver video: 01 - An\u00e1lisis de INDX </p> <p>\u00bfQu\u00e9 podemos obtener una vez hayamos analizado el fichero $I30? </p> <ul> <li>Fecha de Creaci\u00f3n del Fichero que hay en la carpeta </li> <li>Fecha de modificaci\u00f3n del fichero que hay en la carpeta </li> <li>Fecha de acceso del fichero que hay en la carpeta </li> <li>Fecha de cambio de registro MFT que hay en la carpeta </li> <li>Tama\u00f1o f\u00edsico, l\u00f3gico. </li> <li>Registro MFT </li> </ul> <p> </p> <p>Nunca obtendremos la fecha del fichero borrado que hubo en la carpeta. </p>"},{"location":"ud2/#shadow-copies","title":"Shadow Copies","text":"<p>Las shadow copies tambi\u00e9n conocidas como el Servicio Volume Snapshot o Volume Shadow Copy (VSS), es una tecnolog\u00eda que se incluy\u00f3 en los sistemas operativos a partir de Windows 7. Es un servicio de Backup autom\u00e1tico y transparente para el usuario que est\u00e9 utilizando el sistema. </p> <p> </p> <p>F\u00edsicamente las shadows copies se encuentran en la carpeta ra\u00edz: System Volume Information </p> <p> </p> <p>En un equipo encendido o Live, es f\u00e1cil acceder a dichas shadows copies: </p> <p> </p> <p>\u00bfc\u00f3mo podr\u00edamos acceder a las shadows copies de una imagen forense?  **Ver Video: 02-Analisis de Shadows</p> <p>Junto con Arsenal Image Mounter y la herramienta de Nirsoft ShadowCopy View podr\u00edamos extraer los ficheros que hay en cada snapshot. </p> <p> </p> <p>Para analizar las Shadows Copies de un Windows 10, hay que lanzarlo desde un Windows 10. As\u00ed para todas las versiones de Windows. </p> <p>\u00bfDe qu\u00e9 ficheros se realiza backup mediante las shadows copies? </p> <p>Para ello habr\u00eda que analizar el registro de Windows, en especial el fichero SYSTEM e ir a la siguiente ruta: </p> <ul> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VSS Y a esta ruta: </li> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore Dentro de esta \u00faltima clave de registro, podremos encontrar: </li> <li>FilesNotToBackup -&gt; ficheros que no se deben copiar </li> <li>KeysNotToRestore\u200a -&gt; claves de registro de Windows que no se deben de copiar. </li> </ul>"},{"location":"ud2/#carving","title":"Carving","text":""},{"location":"ud2/#que-ocurre-cuando-se-borra-un-fichero-mediante-el-sistema-operativo","title":"\u00bfQu\u00e9 ocurre cuando se borra un fichero mediante el sistema operativo?","text":"<p>Cuando vac\u00eda la papelera en un Sistema Windows, se borra presionando la tecla \u201cSHIFT\u201d o se borra desde el CMD, es cuando de verdad se produce un borrado el fichero. A continuaci\u00f3n identificamos todo el proceso a nivel forense: </p> <ol> <li>Se cambia el atributo flag, en la cabecera del registro MFT del fichero o carpeta que se ha borrado: </li> <li>Archivos: 0x01 to 0x00 </li> <li>Directorios: 0x03 to 0x02. </li> <li>El atributo $BITMAP del registro del MFT es procesado y establecido a 0 </li> <li>Los atributos no residentes del registro del MFT asociado al fichero en cuesti\u00f3n, son procesados y sus cl\u00faster son establecidos como espacio libre en el fichero $BITMAP. </li> </ol> <p>\u00bfTodo el proceso anterior impide que se pueda recuperar la informaci\u00f3n? No. Como ya hemos visto anteriormente se podr\u00e1 recuperar siempre y cuando no se sobrescriba el registro MFT, debido al uso del sistema. </p> <p>Los ransomware cuando deshabilitan las Shadows copies, lo que hacen es utilizar una llamada al sistema para la lanzar el comando pertinente. Este comando es propio del sistema operativo </p> <p> </p> <p>Para recuperarlas veremos en la parte de carving otra herramienta. </p> <p>\u00bfLas herramientas de borrado seguro c\u00f3mo funcionan? Estas herramientas pueden eliminar: </p> <ul> <li>El registro de MFT completo del fichero asociado </li> <li>Logfile </li> <li>Shadows copies </li> </ul> <p>A parte de realizar las operaciones anteriores, los clusters que son utilizados para contener el propio fichero, se sobrescriben a ceros o siguiendo un est\u00e1ndar de borrado que va en funci\u00f3n del n\u00famero de pasadas. </p>"},{"location":"ud2/#recuperacion-de-datos-mediante-el-propio-sistema-de-archivos","title":"Recuperaci\u00f3n de datos mediante el propio sistema de archivos","text":"<p>\u00bfC\u00f3mo funcionan los programas de recuperaci\u00f3n de ficheros que analizan el MFT? </p> <ol> <li>Buscan en el registro $MFT del fichero en cuesti\u00f3n. </li> <li>Analizan su atributo $DATA del registro. </li> <li>S\u00ed el atributo $DATA es residente, el contenido como tal est\u00e1 en el propio registro. </li> <li>S\u00ed el atributo $DATA es no residente, el contenido del fichero est\u00e1 en un cl\u00faster externo. A continuaci\u00f3n, se parsea el RunList. (Runlist contiene los clusters asociados al fichero) </li> <li>Verificar si los clusters del Runlist est\u00e1n allocated o no. Si todos los cl\u00faster est\u00e1n allocated La recuperaci\u00f3n de datos es posible. </li> <li>Si algunos clusters tienen de estado de allocated a 1, se puede realizar una recuperaci\u00f3n de datos parcial. Los que est\u00e1n allocate cambian a 0. </li> <li>Si todos los clusters estuviesen a 1, significa que ya hay un fichero que utiliza todos los cl\u00faster </li> </ol> <p>Este tipo de t\u00e9cnicas si permite recuperar el nombre del fichero, ya que se obtiene del atributo $FILE_NAME. </p> <p>Otras t\u00e9cnicas de recuperaci\u00f3n de archivos utilizando artefactos del sistema de archivos, ser\u00edan: </p> <ul> <li>Carving de registros MFT en el espacio libre </li> <li>B\u00fasqueda de registros MFT en el propio registro $MFT, en el slack space. </li> </ul>"},{"location":"ud2/#recuperacion-de-datos-mediante-carving","title":"Recuperaci\u00f3n de datos mediante carving","text":"<p>La recuperaci\u00f3n de datos mediante carving, se basa en ir analizando cl\u00faster a cl\u00faster del dispositivo de almacenamiento en busca de cabeceras o formas conocidas. Esta t\u00e9cnica NO permite recuperar el nombre del fichero. No depende del sistema de archivos, sino de conocer previamente como esta formado el fichero que queremos recuperar. </p> <p> </p> <p>Tres tipos de t\u00e9cnicas: </p> <ul> <li>Basadas en cabeceras y cierre del fichero: Header-Footer con tama\u00f1o m\u00e1ximo del fichero </li> <li>Basadas en c\u00f3mo est\u00e1 el fichero construido : File structure based carving </li> <li>Content based Carving -&gt; basadas en el contenido en s\u00ed </li> </ul>"},{"location":"ud2/#tecnica-header-footer","title":"T\u00e9cnica Header - Footer","text":"<p>Se utiliza un header conocido y un footer: </p> <ul> <li>Fichero JPEG Header: OxFF,OxD8 -&gt; FFD8 </li> <li>Fichero JPEG Footer: OxFF,OxD9 -&gt; FFD9 </li> </ul> <p>Un listado de todas las cabeceras o firmas lo podemos encontrar en la siguiente URL: https://www.garykessler.net/library/file_sigs.html </p> <p>\u00bfQu\u00e9 herramienta podemos utilizar para aplicar esta t\u00e9cnica? Photorec </p> <p>\u00bfSirve con los programas de borrado seguro? No, ya que no podemos identificar headers/footers conocidos al haber sido sobrescritos por ciertos patrones grupos de ceros. </p> <p>Photorec no funciona con formato de imagen Encase, solo en im\u00e1genes en RAW o sobre el dispositivo f\u00edsico. </p> <p>Dispone de much\u00edsimas cabeceras y tipos de ficheros: https://www.cgsecurity.org/wiki/File_Formats_Recovered_By_PhotoRec </p> <p> </p> <p>**Ver video: 03-Photorec </p> <p>La t\u00e9cnica de carving no es v\u00e1lida para ficheros que est\u00e9n desfragmentados ya que los clusters que ocupan el fichero no est\u00e1n contiguos. </p> <p>\u00bfQu\u00e9 podr\u00edamos recuperar mediante t\u00e9cnicas de carving? </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>Shadows Copies </li> <li>$I30 </li> </ul> <p>Las shadows se pueden recuperar gracias a la siguiente herramienta: https://github.com/mnrkbys/vss_carver </p> <p>En el github aparece como y qu\u00e9 comandos son necesarios para poder utilizarla: </p> <p> </p>"},{"location":"ud2/#stream-carving-vs-file-carving","title":"Stream Carving vs File Carving","text":"<p>El data Stream Carving se basa en extraer fragmentos de las siguientes fuentes de </p> <p>informaci\u00f3n: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre </li> <li>Ficheros de bases de datos Ejemplos: </li> <li>URLs (navegaci\u00f3n privada) </li> <li>Sesiones de Chat </li> <li>E-mails </li> <li>Claves de Cifrado </li> </ul> <p>El data stream carving est\u00e1 basado en la localizaci\u00f3n de peque\u00f1os fragmentos y no en la b\u00fasqueda del fichero entero. Los peque\u00f1os fragmentos pueden tener un gran significado, pero normalmente son parte de un fichero. Por ejemplo, las bases de datos como el fichero index.dat puede contener cientos de URL que han sido visitadas cuando se borraron. Si no eres capaz de recuperar el fichero completo se podr\u00edan extraer fragmentos. </p> <p>El file Carving o carving a secas, puede extraer ficheros de: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre Ejemplos: </li> <li>Word (.doc/.docx) </li> <li>Im\u00e1genes (.jpg,.png,.gif) </li> <li>Archivos (.zip /.rar) </li> </ul> <p>Una herramienta que permite hacer ambos tipos de recuperaci\u00f3n es Bulk Extractor, soporta im\u00e1genes forenses en formato E01: </p> <p> </p> <p>Tambi\u00e9n permite realizar carving de: </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>$I30 </li> </ul> <p>** Ver video: 04-Bulk Extractor </p> <p>Una vez seleccionemos con Bulk Extractor la imagen a procesar, podemos ver el estado de c\u00f3mo va avanzado: </p> <p> </p> <p>Todos los resultados los guardar\u00e1 sobre la carpeta que hemos indicado. </p>"},{"location":"ud2/#timeline","title":"Timeline","text":"<p>El timeline o l\u00ednea del tiempo nos permite obtener acotar en tiempo la investigaci\u00f3n de una evidencia, por ejemplo: nos indican que la investigaci\u00f3n est\u00e1 focalizada a ra\u00edz de la comunicaci\u00f3n a un trabajador que va ser despedido. La compa\u00f1\u00eda a ra\u00edz de esta comunicaci\u00f3n ha visto un comportamiento sospechoso. </p> <ul> <li>Fecha de comunicaci\u00f3n de despido: m\u00ednima fecha a investigar </li> <li>Fecha de salida de la compa\u00f1\u00eda: m\u00e1xima fecha a investigar </li> </ul> <p>Nuestro timeline estar\u00e1 basado \u00fanicamente en los timestamps del sistema de archivos, es decir, en las fechas de: </p> <ul> <li>Creaci\u00f3n de fichero -&gt; C </li> <li>Modificaci\u00f3n de fichero -&gt; M </li> <li>Cambio de registro MFT -&gt;B </li> <li>Acceso -&gt; A </li> </ul> <p>Estas fechas se le denomina MACB timestamp, para crear el Timeline podemos utilizar la herramienta Autopsy: </p> <p> </p> <p>** Ver video: 05-Autopsy</p> <p>Otra manera de generar un Timeline, ser\u00eda con la herramienta MFT2CSV, pero seleccionando el formato de salida log2timeline. Una vez se haya generado el CSV, deberemos de abrirlo con la herramienta TimeLine Explorer. </p> <p> </p> <p>** Ver Video: 06-Timeline </p>"},{"location":"ud2/#metadatos-de-ficheros","title":"Metadatos de ficheros","text":"<p>Los metadatos est\u00e1n definidos como estructura interna del propio fichero en s\u00ed. No tiene nada que ver con los metadatos que hemos visto del sistema de archivos. \u00bfQu\u00e9 tipos de ficheros pueden contener metadatos? </p> <ul> <li>Im\u00e1genes </li> <li>Documentos ofim\u00e1ticos </li> <li>Documentos de Audio </li> <li>Documentos de video </li> <li>Ejecutables </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en un fichero ofim\u00e1tico? </p> <ul> <li>T\u00edtulo </li> <li>Versi\u00f3n de MS Office Utilizada </li> <li>\u00daltimo Autor </li> <li>Creaci\u00f3n del documento /hora </li> <li>\u00daltima fecha de guardado </li> <li>\u00daltima fecha de impresi\u00f3n </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en una imagen? </p> <ul> <li>EXIF Data </li> <li>Marca C\u00e1mara / Modelo </li> <li>Hora de creaci\u00f3n </li> <li>Hora de modificaci\u00f3n </li> <li>Informaci\u00f3n de la imagen </li> <li>Coordenadas GPS </li> </ul> <p>Nota: Estos metadatos son muy f\u00e1ciles de manipular. Para realizar una investigaci\u00f3n correcta, se deben utilizar m\u00e1s artefactos y verificar dicha informaci\u00f3n. </p> <p> </p> <p>** Ver Video: 07-Exif tool </p> <p>Exiftool tambi\u00e9n permite analizar de manera recursiva un directorio: https://owl.phy.queensu.ca/~phil/exiftool/examples.html </p> <p>Las fechas que aparecen como metadatos en el documento ofim\u00e1tico son introducidas por la herramienta ofim\u00e1tica. No confundir con las fechas del sistema de archivos. </p> <p>Un documento como tal nunca contendr\u00e1 fechas a no ser que disponga de alg\u00fan metadato dentro \u00e9l. </p> <p>Otra herramienta muy buena para metadatos es Metadiver: https://www.easymetadata.com/metadiver-2/ </p> <p> </p> <p>Caracter\u00edsticas: </p> <p> </p>"},{"location":"ud2/#lastvisited-mru-vs-opensavemru","title":"LastVisited MRU vs OpenSaveMRU","text":"<p>Windows tiene cajas de di\u00e1logo que todos los programas usan. </p> <ul> <li>Tenemos dos tipos: </li> <li>LastVisitedMRU </li> <li>OpenSaveMRU </li> </ul> <p> </p>"},{"location":"ud2/#lastvisitedmru","title":"LastVisitedMRU","text":"<p>Este artefacto monitoriza qu\u00e9 aplicaci\u00f3n abre o guarda el fichero que hemos visto en el OpenSaveMRU. Te indica la ruta donde abri\u00f3 el fichero y el ejecutable </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU -&gt; WinXP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU LasVisitedPidlMRU -&gt; ( Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2/#opensavemru","title":"OpenSaveMRU","text":"<p>Este artefacto monitoriza los ficheros que han sido abiertos o guardados dentro de una ventana de Windows. Esto no solamente ocurre con los navegadores sino con la mayor\u00eda de las aplicaciones. </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Op enSaveMRU -&gt; Win XP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 Op enSavePidlMRU -&gt; (Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2/#ultimos-comandos-ejecutados","title":"\u00daltimos Comandos Ejecutados","text":"<p>Este artefacto, muestra los \u00faltimos comandos ejecutados desde el men\u00fa de ejecutar (RunBox): </p> <p> </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Policies\\RunRU </li> </ul> <p> </p>"},{"location":"ud2/#user-assistkey","title":"User AssistKey","text":"<p>Todos los programas con interfaz gr\u00e1fico que son ejecutados desde el escritorio son monitorizados por el launcher de Windows. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist{GUID}\\Co unt </p> <p>El GUID es el identificador de la aplicaci\u00f3n que se utiliza. Datos que podemos obtener: </p> <ul> <li>Last Run Time (UTC) </li> <li>Run Count: n\u00famero de veces que se ha ejecutado </li> <li>Nombre de la aplicaci\u00f3n GUI </li> <li>Focus Time: tiempo total que la aplicaci\u00f3n ha tenido el foco. </li> <li>Focus Count: n\u00famero total de veces que la aplicaci\u00f3n sali\u00f3 y entr\u00f3 del foco. </li> </ul> <p>El valor del nombre tambi\u00e9n tiene un significado en los User Assist Keys. El nombre de la clave siempre empezar\u00e1 por UEME_ e ir\u00e1 seguido por: </p> <ul> <li>RUNPATH: path absoluto del ejecutable. Un usuario normalmente ha clicado a trav\u00e9s de la interfaz de Windows Explorer. </li> <li>RUNCPL: para lanzar el panel de control. </li> <li>RUNPIDL: puntero al fichero actual como un fichero LNK. </li> <li>UIQCUT: cuenta las veces que ha sido lanzado a trav\u00e9s del QUICKLaunch </li> <li>UISCUT: cuenta las veces que ha sido lanzado a trav\u00e9s de un acceso directo en el escritorio. </li> <li>UITOOLBAT: informaci\u00f3n sobre los clicks de Windows Explorer ToolBar </li> </ul> <p> </p> <p>Registry Explorer interpreta directamente los valores en la columna Program Name. </p>"},{"location":"ud2/#shell-items","title":"Shell Items","text":"<p>\u00bfQu\u00e9 es un shell item? Informaci\u00f3n o fichero que tiene informaci\u00f3n para acceder a </p> <p>otro fichero. </p> <p>Atributos: </p> <ul> <li>Tipo del target donde est\u00e1 el fichero: fijo, extra\u00edble, red </li> <li>Path del fichero target: unidad, etiqueta del volumen </li> <li>Metadatos: MAC timestamps, tama\u00f1o, registro MFT, N\u00famero de secuencia </li> </ul> <p>Tipos: </p> <ul> <li>Accesos directos (LNK) </li> <li>Jumplists </li> <li>Shellbags </li> </ul> <p> </p> <p>Header de LNK </p> <p>Al tener un firma espec\u00edfica se podr\u00eda realizar carving para recuperar los que se hayan borrado. </p>"},{"location":"ud2/#recent-documents-lnk","title":"Recent Documents (LNK)","text":"<p>Windows crea este shortcut cuando un usuario abre o utiliza un fichero. </p> <p>Ruta: </p> <ul> <li>Win7-Win10: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent  <li>Office: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Office\\Recent  <li>M\u00e1ximo 149 ficheros y directorios </li> <p>Tipos: </p> <ul> <li>1- Fichero Target </li> <li>2- Directorio padre del fichero target </li> </ul> <p>Informaci\u00f3n: </p> <ul> <li>MAC Times del target File </li> <li>Informaci\u00f3n del volumen donde est\u00e1 el target file </li> <li>Directorio del target file </li> </ul> <p>Los archivos podr\u00edan haber sido borrados o eliminados, almacenados en un recurso compartido de red o USB, por lo que, aunque el archivo podr\u00eda ya no estar all\u00ed, seguir\u00e1 existiendo los archivos LNK asociados con el archivo original. Las fechas del sistema de archivos indican: </p> <ul> <li>Fecha de creaci\u00f3n-&gt; la primera vez que se abri\u00f3 </li> <li>Fecha de modificaci\u00f3n -&gt; La \u00faltima vez que se abri\u00f3. </li> </ul> <p> </p> <p>Nuevo funcionamiento de Recent Documents en Windows 10 </p> <ul> <li>Cuando un fichero es creado, tambi\u00e9n se crea su LNK en el RECENT (anteriormente solo cuando se abr\u00eda). Se mantiene las fechas del sistema de archivo. </li> <li>Cuando una carpeta es creada en un directorio, la carpeta, la carpeta padre y la carpeta abuelo son creados como LNK en el RECENT. </li> <li>El mayor cambio es que ahora en los ficheros LNK se incluye la extensi\u00f3n y antes no. </li> </ul> <p>Nuevos tipos de LNK con URLs en Windows 8/10 </p> <p> </p> <p>\u00bfC\u00f3mo se gener\u00f3 este tipo de LNK? </p> <ol> <li>Run Dialog </li> <li>Windows Search Charm </li> <li>A trav\u00e9s de un fichero LNK </li> <li>A trav\u00e9s de un link de una aplicaci\u00f3n </li> </ol> <p>Herramienta para analizar ficheros LNK: LINKPARSER </p> <p> </p> <p>Campos: </p> <ul> <li>Link: son las fechas del destino UTC, es decir, las fechas del sistema de archivos del fichero en s\u00ed. </li> <li>File: son las fechas propias del LNK del UTC </li> <li>El hash MD5 es el del propio LNK, nunca del fichero en s\u00ed. </li> <li>MAC Address del equipo donde est\u00e1 el fichero original. </li> <li>Volume Label: Etiqueta del volumen </li> <li>DriveType: tipo de medio -&gt; muy \u00fatil para dispositivos USB </li> </ul> <p>** Ver Video:10-LinkParser </p> <p>LeCMD: otra herramienta para analizar LNK </p> <p> </p> <p>** Ver Video: 11-LECMD </p>"},{"location":"ud2/#jumplists","title":"Jumplists","text":"<p>Los usuarios pueden \u201csaltar\u201d a los archivos recientemente abiertos. Para las investigaciones forenses proporciona otra ubicaci\u00f3n donde verificar la creaci\u00f3n de ficheros no ejecutables. </p> <p>Esto debe coincidir con el registro de RecentDocs, Recent Docs *ext, Office Recent Docs y los ficheros LNK en el Recent Folder. </p> <p> </p> <p>Hay dos tipos de Jumplists: </p> <ul> <li>autom\u00e1ticos que son creados por cada aplicaci\u00f3n de Windows </li> <li>custom que son creados con el desarrollo espec\u00edfico de la aplicaci\u00f3n. </li> </ul> <p>Los dos se pueden encontrar en el Recent Folder. </p> <p>Dentro de cada fichero JUMPLIST puede haber fechas propias: creaci\u00f3n de la entrada, modificaci\u00f3n de la entrada y \u00faltimo acceso a la entrada. En la imagen superior, para el fichero documento_prueba.docx podr\u00eda tener estas fechas. </p> <p>Automatic destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDes tinations. <p>Contiene una lista de aplicaciones ordenadas por AppID. Los nombres est\u00e1n en el formato XXXXXXXX.autmaticDestinations-ms </p> <ul> <li>Creation Time: Primera fecha de ejecuci\u00f3n (a nivel el sistema de archivos) </li> <li>Modificaci\u00f3n time: \u00faltima fecha de ejecuci\u00f3n de la aplicaci\u00f3n (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>La informaci\u00f3n almacenada en el directorio de Automatic Destinations tiene que tener un \u00fanico archivo con el AppID. </p> <p>Custom Destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\CustomDestin ation <p>Son creados por cada aplicaci\u00f3n y por lo tanto \u201ccustom\u201d </p> <p>Un Jumplist customizado est\u00e1 destinado a presentar el contenido que la aplicaci\u00f3n ha establecido como importante basado en el uso previo o a trav\u00e9s de una acci\u00f3n que ha sido indicada por el usuario como importante, tal como a\u00f1adir el \u00edtem a favoritos o anclar la aplicaci\u00f3n a la barra de inicio. Tambi\u00e9n tienen una APPID. </p> <ul> <li>Creation Time (a nivel el sistema de archivos): primera vez de ejecuci\u00f3n. </li> <li>Modificaci\u00f3n time: \u00faltima vez que la aplicaci\u00f3n fue a\u00f1adida al fichero en concreto (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>Los Jumplist evidencian que una aplicaci\u00f3n espec\u00edfica existi\u00f3 y se ejecut\u00f3. </p> <p>Cada Jumplist, sea autom\u00e1tico o custom, tiene su AppID. Este tipo de identificador est\u00e1 asociado a un programa en concreto como vemos en la imagen siguiente: </p> <p> </p> <p>https://www.forensicswiki.org/wiki/Jump_Lists </p> <p>Herramienta para analizar Jumplist: JumpList Explorer </p> <p> </p> <p>** Ver Video: 12-JumplistExplorer </p>"},{"location":"ud2/#shellbags","title":"Shellbags","text":"<p>Los sistemas Windows almacenan las opciones de visualizaci\u00f3n de Windows Explorer mediante entradas de registro y son conocidas como ShellBags. </p> <ul> <li>Esto nos permite saber qu\u00e9 directorio han sido accedidos a nivel local, de red o dispositivos extra\u00edbles. </li> <li>Evidencia la existencia de directorios previos. </li> <li>Localizaci\u00f3n de las Shellbags: </li> </ul> <p>Explorer Access: </p> <ul> <li>USRCLASS.DAT\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\Bags </li> <li>USRCLASS.DAT\\LocalSettings\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> </ul> <p>Desktop Access: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\Bags </li> </ul> <p>Los documentos de Microsoft tienen Shellbags adicionales y est\u00e1n presentes en los sistemas Win7-Win10 </p> <p>La existencia de dicha entrada en el registro prueba que usuario especific\u00f3 visit\u00f3 al menos una vez ese directorio. </p> <p>Para analizar los shellbags, vamos a utilizar Shelbag Explorer: </p> <p> </p> <p>Respecto a los timestamps: </p> <ul> <li>En azul corresponde con los MAC times del sistema de archivos de la carpeta PPT </li> <li>En rojo es la informaci\u00f3n propia de shellbag, donde indica la \u00faltima interacci\u00f3n con la carpeta PPT y cu\u00e1l fue la primera. </li> <li>Tambi\u00e9n indica el sistema de archivos sobre el que estaba la carpeta. </li> </ul> <p>** Ver Video:13-ShellbagExplorer </p> <p>Hasta ahora hemos dicho: </p> <ul> <li>Evidenciar que se ha ejecutado mediante el an\u00e1lisis del UserAssist </li> <li>Evidenciar que se ha \u201ctocado\u201d realizando un timeline del sistema de archivos o del registro. </li> <li>Evidenciar que directorios has abierto mediante el an\u00e1lisis de Shellbags. </li> </ul>"},{"location":"ud2/#thumbnails","title":"Thumbnails","text":"<p>Cuando un usuario previsualiza una carpeta de tal manera que la organiza mediante thumbnails, se crea un fichero oculto \u201cthumbs.db\u201d que almacena la preview de im\u00e1genes en hay en la carpeta, incluso si las im\u00e1genes fueron borradas. </p> <p>Thumbs.db </p> <ul> <li>WinXP/Win8-8,1 -&gt; Creado autom\u00e1ticamente </li> <li>*Win7/Win10 -&gt; Autom\u00e1tica creado si es accedido v\u00eda UNC Path -&gt; \\ruta\\ruta* </li> </ul> <p>\u00bfQu\u00e9 hay en el Thumbs.db? </p> <ul> <li>Imagen peque\u00f1a de la imagen original incluso si es borrada </li> <li>\u00daltima fecha de modificaci\u00f3n -&gt; Windows XP </li> <li>Nombre original -&gt; Windows XP </li> </ul> <p>Herramienta que analiza el fichero Thumbs.db: Thumbsviewer </p> <p> </p> <p>thumbsviewer.github.io </p>"},{"location":"ud2/#thumbcache","title":"Thumbcache","text":"<p>El Thumcache, es la evoluci\u00f3n del thums.db. Su funcionamiento es el mismo. </p> <p> </p> <p>Ruta: C:\\Users\\\\AppData\\Local\\Microsoft\\Windows\\Explorer <ul> <li>Solo Thumbnails </li> <li>Localizaci\u00f3n de donde estuvo ese thumbnail </li> <li>Solo para Windows 7 / 8 / 10 </li> </ul> <p>En la carpeta anterior, se encuentran los preview de las im\u00e1genes en funci\u00f3n del tama\u00f1o. De esta manera se adapta a los requisitos del usuario. </p> <ul> <li>Thumbcache_32.db -&gt; small </li> <li>Thumbcache_96.db -&gt; medium </li> <li>Thumbcache_256.db -&gt; large </li> <li>Thumbcache_1024.db -&gt; extra large </li> </ul> <p>Herramienta ThumbCache Viewer</p> <p> </p>"},{"location":"ud2/#papelera-de-reciclaje","title":"Papelera de Reciclaje","text":"<p>Carpeta oculta del sistema que contiene un subdirectorio con el SID del usuario. EL SID del usuario lo podemos obtener el fichero SAM. </p> <p>RECYCLER -&gt; 2000/NT/XP/2003 </p> <ul> <li>Archivo oculto llamado INFO2 </li> <li>Contiene la fecha de borrado y el nombre del archivo original </li> </ul> <p>$Recycle.bin -&gt; Vista/Win7/Win8/Win10 </p> <ul> <li>El archivo es ASCII y UNICODE </li> <li>La fecha del borrado y el nombre del fichero original borrado est\u00e1n en ficheros distintos </li> <li>$I -&gt; Informaci\u00f3n del fichero (fecha de borrado) </li> <li>$R -&gt; el contenido del fichero </li> </ul> <p>Solo los ficheros que son borrados desde el Explorer de Windows, van a esta localizacion. No es un borrado como tal, ya que los ficheros se encuentran disponibles. </p> <p>Si el usuario realiza SHIFT + borrado el fichero no pasa por la papelera de reciclaje. </p> <p>A nivel del sistema de archivos, el fichero original es movido a la papelera de reciclaje y renombrado con $R{nombre} y se crea un fichero con $I{nombre} que contiene la fecha del \u201cborrado\u201d. El borrado real, se proceder\u00e1 de verdad cuando la papelera se haya vaciado. </p> <p>Herramienta para procesar la papelera: Rifiuti. </p> <p> </p> <p>Dos versiones de la herramienta en funci\u00f3n del sistema operativo: </p> <p> </p> <p>** Ver Video:16-Rifitui </p>"},{"location":"ud2/#ejecucion-de-programas","title":"Ejecuci\u00f3n de programas","text":"<p>En esta secci\u00f3n vamos a ver todos los artefactos forenses que indiquen la ejecuci\u00f3n de un programa. </p>"},{"location":"ud2/#windows-prefetch","title":"Windows Prefetch","text":"<p>La misi\u00f3n de Windows Prefetch es incrementar el rendimiento del sistema con una precarga del ejecutable. El cache manager monitoriza todos los ficheros y directorios y los mapea contra el fichero .pf (el fichero .pf ser\u00e1 el artefacto forense que analizaremos) </p> <ul> <li>Deshabilitado en sistemas con disco SSD </li> <li>Muestra c\u00f3mo y cu\u00e1ndo un binario se ejecut\u00f3 </li> </ul> <p>Ruta: C:\\Windows\\Prefetch </p> <ul> <li>Limitado a 128 ficheros en XP/VISTA/WIN7 </li> <li>Limitado a 1024 ficheros en Win8/Win10 </li> <li>{Nombre_ejecutable}-{hash}.pf </li> <li>Windows 10 los prefetch vienen comprimidos </li> <li>El hash est\u00e1 basado en el path del ejectuable y los argumentos que reciben </li> </ul> <p>Ruta: C:\\Windows\\Prefetch\\Layout.ini </p> <ul> <li>El fichero layout.ini contiene los nombres de los directorios de los ficheros que est\u00e1n en el Prefetch </li> <li>El desfragmentador de disco utiliza el layout.ini para realojar todos los directorios y ficheros en un \u00e1rea contigua del disco. </li> </ul> <p>\u00bfQu\u00e9 indica este artefacto forense? </p> <ul> <li>N\u00famero de ejecuciones (hasta 8 veces puede registrar) </li> <li>Fechas de las ejecuciones (UTC) </li> <li>El propio fichero, ya indica la ejecuci\u00f3n del programa </li> <li>Ficheros abiertos por el programa </li> </ul> <p>Herramienta para analizar los Prefetch: PeCMD </p> <p> </p> <p>Resultado de ejecutar PeCMD </p> <p> </p> <p>** Ver V\u00eddeo Prefetch - 011 </p>"},{"location":"ud2/#superfetch","title":"SuperFetch","text":"<p>Superfetch consiste en una serie de bases de datos localizados en la carpeta C:\\Windows\\Prefetch\\Ag*.db, que tienen como misi\u00f3n optimizar el uso de memoria. No reemplaza al servicio Prefetch </p> <p> </p> <p>\u00bfQu\u00e9 podemos obtener? </p> <ul> <li>Nombre de la aplicaci\u00f3n </li> <li>N\u00famero de ejecuciones </li> <li>Ficheros necesarios que son utilizados por el binario. </li> <li>Volumen accedido </li> <li>Path completo </li> <li>TimeFrames </li> <li>Timestamp </li> </ul> <p>Herramienta para analizar el Superfetch: CrowdResponse </p> <p> </p> <p>https://www.crowdstrike.com/resources/community-tools/crowdresponse/ </p>"},{"location":"ud2/#srum","title":"SRUM","text":"<p>System Resource Usage Monitor (SRUM) es un artefacto forense que est\u00e1 destinado a monitorizar los recursos que consume un proceso. </p> <p>Ruta: C:\\Windows\\System32\\sru\\SRUDB.dat </p> <ul> <li>A partir de Windows 8 </li> <li>Es una Base de datos en formato ESE </li> </ul> <p>Se ha llegado a identificar hasta 60 d\u00edas de monitorizaci\u00f3n y nos puede indicar: </p> <ul> <li>AppID y Path  </li> <li>Usuario que ejecuta </li> <li>Bytes enviados </li> <li>Bytes recibidos </li> <li>Interfaz de red </li> <li>Tiempo de conexi\u00f3n </li> <li>Tiempo de duraci\u00f3n </li> </ul> <p>El Prefetch indica el arranque de un proceso, pero no la duraci\u00f3n: </p> <p> </p> <p>Ejemplo del proceso: Explorer.exe </p> <p>La actividad es actualizada cada 60 min en la base de datos o durante un apagado correcto </p> <p> </p> <p>Si realizamos un apagado incorrecto hay que reparar la base de datos ESE mediante el comando: esentul /mh SRUDB.dat </p> <p>Herramienta que nos permite analizar el fichero SRUDB.dat: SRUM DUMP </p> <p> </p> <p>** Ver Video:17-SRUM </p> <p>Lo resultados de ejecutar la herramienta SRUM DUMP, donde se identifica el proceso junto con su timestams y los bytes que ha enviado y recibido: </p> <p> </p> <p> </p>"},{"location":"ud2/#appcompatcache-shimcache","title":"AppCompatCache (ShimCache)","text":"<p>Se encarga de chequear la compatibilidad de la aplicaci\u00f3n dentro del sistema operativo. Verifica si la aplicaci\u00f3n necesita aplicarse ciertas propiedades en el actual sistema operativo o funcionar viejos sistemas operativos. </p> <p>Appcompatcache monitorizar\u00e1 del ejecutable: </p> <ul> <li>Fecha de \u00faltima modificaci\u00f3n: $STANDARD_INFORMATION </li> <li>Path donde se encuentra </li> <li>Y si fue ejecutado </li> </ul> <p>Si la aplicaci\u00f3n sufre una modificaci\u00f3n o actualizaci\u00f3n, ser\u00e1 nuevamente actualizada Ruta: </p> <ul> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\Appcompatibility\\Appco mpat Cache -&gt; XP -&gt; 96 entradas </li> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\AppcompatCache\\AppCo mp atCache -&gt; Server 2003 (512 entradas) y 2008/2012/2016 \u2013 Win7/Win8/Win10 (1024 entradas) </li> </ul> <p>Cuando se modifican las propiedades de una aplicaci\u00f3n, se crean entradas en el registro. Todo programa (.exe, .bat,.dll) es chequeado con la base de datos para buscar una compatibilidad. Este es el artefacto forense que encontramos.</p> <p>Solo se actualiza cuando el sistema es apagado y no antes. </p> <ul> <li>Eventos m\u00e1s recientes est\u00e1n al principio </li> <li>Nuevos eventos se escriben al ser apagado. </li> </ul> <p>\u00bfQu\u00e9 podemos evidenciar? </p> <p> </p> <p>Herramienta que permite analizar el AppCompatCache: AppCompatCache (ShimCache) Parser </p> <p> </p> <p>** Ver video:18- Shimcache </p> <p>Resultado de ejecutar AppCompatCache y llevarlo a TimelineExplorer: </p> <p> </p>"},{"location":"ud2/#amcachehve","title":"Amcache.hve","text":"<p>Artfacto forense, que es un registro en s\u00ed mismo con la siguiente ruta: C:\\Windows\\AppCompat\\Programas\\Amcache.hve (Windows 7/8/8.1/10 y 2012/2016) </p> <ul> <li>Keys: Amcache.hve\\Root\\File{Volume GUID}###### -&gt; Para el Formato Antiguo </li> <li>Hay una entrada por cada ejecuci\u00f3n, informaci\u00f3n del directorio, fecha \u00faltima modificaci\u00f3n $StandarInfo y el volumen desde el que ejecut\u00f3 (GUID de volumen) </li> <li>La primera vez que se ejecut\u00f3: \u00faltima modificaci\u00f3n de la clave de registro </li> <li>El SHA1 del ejecutable tambi\u00e9n est\u00e1 en el registro </li> </ul> <p>Lo analizamos con la Herramienta AmcacheParser: </p> <p> </p> <p>** Ver Video: 19-Amcache </p> <p>Resultado de la ejecuci\u00f3n AmCacheParser: </p> <p> </p>"},{"location":"ud2/#recentfilecache","title":"RecentFileCache","text":"<p>Este artefacto solo se encuentra en Windows 7 y en la siguiente ruta: C:\\Windows\\AppCompat\\Programs\\RecentFileCache.bcf </p> <p>Contiene la ejecuci\u00f3n de binarios m\u00e1s reciente en el sistema Windows 7. Para ver de manera m\u00e1s detallada c\u00f3mo se crea este artefacto forense: </p> <p>http://journeyintoir.blogspot.com/2013/12/revealing-recentfilecachebcf-file.html Para analizar este artefacto utilizaremos la herramienta RecentFileCacheParser: </p> <p> </p> <p>Como siempre, deberemos extraer previamente el artefacto forense mediante Access Data FTK de la ruta anteriormente indicada para que esta herramienta sea capaz de interpretar y analizar. Abrimos un CMD para ejecutar la herramienta e indicarle donde se encuentra el artefacto extra\u00eddo: </p> <p> </p> <p>Finalmente abrimos el fichero CSV generado. Hay que tener cuidado que la extensi\u00f3n es un TSV, es decir un fichero generado por tabulaciones. </p> <p> </p> <p>Lo abrimos con OpenOffice, cambi\u00e1ndole la extensi\u00f3n a \u201cCSV\u201d. </p> <p> </p> <p>Finalmente disponemos una tabla con la ejecuci\u00f3n de los binarios.</p>"},{"location":"ud2/#tareas-programadas","title":"Tareas Programadas","text":"<p>Un malware o backdoor puede utilizar las tareas programadas como mecanismo de </p> <p>persistencia </p> <p>Ruta: C:\\Windows\\Tasks o C:\\Windows\\System32\\Tasks </p> <p> </p> <p>Podemos extraerlas con Arsenal Image Mounter las tareas para analizarlas. Aunque no tengan extensi\u00f3n, una vez extra\u00eddas se puede abrir con el Notepad y verlas como un fichero XML: </p> <p> </p> <p>La fecha de cuando se a\u00f1adi\u00f3, la podemos sacar de las propiedades del sistemas de archivos, gracias a FTK Imager: </p> <p> </p>"},{"location":"ud2/#servicios","title":"Servicios","text":"<p>Los servicios del sistema operativo, los podemos encontrar en la siguiente clave de registro: Ruta: SYSTEM\\ControlSet001\\Services </p> <p>Lo analizamos con Registry Explorer </p> <p> </p> <p>Campos por destacar: </p> <ul> <li>Display Name: nombre del servicio </li> <li>Start mode: el tipo de arranque </li> <li>Image Path: ejecutable con los argumentos que recibe </li> <li>Name Key Last Write: \u00faltima vez que se actualizo la clave del registro </li> <li>Parameters Key Last Write: \u00faltima vez que se cambiaron los par\u00e1metros </li> </ul>"},{"location":"ud2/#navegadores","title":"Navegadores","text":""},{"location":"ud2/#email-forensics","title":"Email Forensics","text":"<p>\u00bfQu\u00e9 informaci\u00f3n podemos encontrar analizando un email? </p> <ul> <li>\u00bfQui\u00e9n envi\u00f3 el email? -&gt; direcci\u00f3n de correo, direcci\u00f3n IP, pruebas de contexto </li> <li>\u00bfCu\u00e1ndo fue enviado? -&gt; Timestamp en la cabecera, timestamp de los servidores </li> <li>\u00bfDesde donde fue enviado? Direcci\u00f3n IP / ISP, Geolocalizaci\u00f3n, Mail server domain, Message ID </li> <li>\u00bfEs el contenido relevante?. Message Body, Adjuntos, libreta de direcciones, Entradas de calendario</li> </ul>"},{"location":"ud2/#cabecera-de-correo-electronico","title":"Cabecera de correo electr\u00f3nico","text":"<p>Podemos encontrar en la cabecera la fecha de cuando se envi\u00f3 el correo electr\u00f3nico, el message ID, el destinatario, el remitente. </p> <p>---&gt; Header  </p> <p>---&gt; Cuerpo </p> <p>---&gt; Adjunto </p> <p>Tambi\u00e9n podemos saber cu\u00e1ndo fue recibido el correo electr\u00f3nico por el servidor SMTP mediante el campo: \u201cReceived\u201d </p>"},{"location":"ud2/#message-id","title":"Message ID","text":"<p>El message ID lo proporciona el servidor que env\u00eda el email y consiste en un \u00fanico identificador a\u00f1adido al nombre del servidor con la @. </p> <p>Este campo puede ser utilizado para identificar mensajes relacionados gracias al tag References y In-Reply-To: </p> <p> </p> <p> </p> <p> </p> <p>En la conversaci\u00f3n anterior, se puede ver el hist\u00f3rico de Message ID que hay. Esto indica que debe haber tambi\u00e9n cuatro mensajes. Uno por cada Message ID. </p>"},{"location":"ud2/#mapi-headers","title":"Mapi Headers","text":"<p>Si est\u00e1s realizando una investigaci\u00f3n donde hay un servidor Exchange o clientes tales como Microsoft Outlook, debes ser consciente que las propiedades MAPI (Microsoft Messaging Application Programing Interface) estar\u00e1n presentes. Son unas cabeceras adicionales que nos van a permitir extraer m\u00e1s informaci\u00f3n de un simple correo electr\u00f3nico: </p> <ul> <li>Mapi-Client-Submit-Time: la fecha del sistema local cuando el email fue enviado por el cliente. </li> <li>Mapi-Conversation-Index: indica cu\u00e1ntos mensajes hijos fueron parte de la cadena de emails y registra los timestamps para cada mensaje en la cadena. </li> <li>Mapi-Entry-ID: un identificador de mensaje dentro del almacenamiento como PST. Puede ayudar a identificar si un usuario dispon\u00eda de varios ficheros PSTs. </li> <li>Mapi-Message-Flags y Pr_last_Verb_Executed: proporciona informaci\u00f3n detallada de las acciones que ocurrieron en un Cliente MAPI: Le\u00eddo, sin leer, respondidos, reenviados, fuera de la oficina </li> </ul>"},{"location":"ud2/#outlook-pst","title":"Outlook PST","text":"<p>El cliente de correo por excelencia de sistemas Windows, es Microsoft Outlook. Todos los mensajes enviados, recibidos, contactos y calendario se almacenan en un fichero PST. </p> <p>Fichero almacenado por defecto: </p> <ul> <li>%USERPROFILE%\\LocalSettings\\ApplicationData\\Microsoft\\Outlook (WinXP y anteriores) </li> <li>%USERPROFILE%\\AppData\\Local\\Microsoft\\Outlook -&gt; Win7 / Win8 y en adelante </li> </ul> <p>La clave de registro nos puede indicar qu\u00e9 archivos est\u00e1n siendo utilizados. </p> <ul> <li>HKEY_CURRENT_USER\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Windo ws Messagin Subsystem\\Profiles\\Outlook </li> <li>El Archivo tiene un tama\u00f1o m\u00e1ximo de 50 GB </li> </ul> <p>Si no lo encontr\u00e1semos, deber\u00edamos buscar por extensi\u00f3n o realizar t\u00e9cnica de recuperaci\u00f3n de datos, ya que el fichero PST dispone de cabecera conocida. Se podr\u00eda realizar mediante Photorec. </p> <p>Herramienta para ver ficheros PST: Kernel PST Viewer </p> <p> </p>"},{"location":"ud2/#outlook-ost","title":"Outlook OST","text":"<p>Microsoft Outlook genera un fichero OST cuando la cuenta ha sido configurada mediante IMAP o mediante Exchage. Al igual que en PST, almacena mensajes enviados, recibidos, contactos, calendario. El buz\u00f3n local (fichero OST) de mensajes est\u00e1 sincronizado con el servidor. </p> <ul> <li>\u00daltimos 12 meses de email por defecto </li> <li>Fichero m\u00e1ximo de 50gb </li> <li>La ruta es la misma que el fichero PST </li> <li>Se puede realizar t\u00e9cnicas de carving para recuperarlo </li> </ul> <p>Herramienta: Kernel OST Viewer </p> <p> </p> <p>** Ver video: 15 - Kernel OST Viewer </p> <p>Hay que tener en cuenta que se puede recuperar un fichero OST/PST del sistema de archivos porque se haya borrado, o recuperar emails borrados de dentro del fichero OST/PST. En el caso de ficheros OST, existe una herramienta de pago: https://www.kerneldatarecovery.com/ost-recovery.html </p>"},{"location":"ud2/#recuperacion-de-adjuntos","title":"Recuperaci\u00f3n de Adjuntos","text":"<p>Microsoft Outlook utiliza un Directorio temporal seguro para abrir los adjuntos de los mensajes de correo electr\u00f3nico: </p> <ul> <li>%APPDATA%\\Local\\Microsoft\\Windows\\TemporaryInternetFiles\\Content.Outlook -&gt; IE10 </li> <li>%APPDATA%\\Local\\Microsoft\\InetCache\\Content.Outlook -&gt; IE11+ </li> </ul> <p>Antes de la versi\u00f3n de Outlook 2007, los mensajes quedan guardados siempre. </p> <p>Despu\u00e9s de la versi\u00f3n de Outlook 2007 en adelante, los adjuntos est\u00e1n, mientras que el correo electr\u00f3nico est\u00e9 abierto o quedar\u00eda en esa carpeta si Outlook es cerrado correctamente. </p>"},{"location":"ud2/#thunderbird-mbox","title":"Thunderbird MBOX","text":"<p>El cliente de correo Thunderbird almacena la informaci\u00f3n en ficheros MBOX. Estos ficheros pueden ser encontrados en la siguiente ruta: </p> <p>\\Users\\%USERNAME%\\AppData\\Roaming\\Thunderbird\\Profiles </p> <p>Para poder leer este fichero MBOX sin la necesidad de Thunderbird podemos recurrir a Autopsy. Creamos un nuevo caso como hemos visto anteriormente, pero esta vez, en vez de a\u00f1adir una imagen forense vamos a\u00f1adir un fichero, en este caso el fichero MBOX. </p> <p> </p> <p>Despu\u00e9s seleccionamos el \u201cEmail Parser\u201d para que pueda extraer los emails contenidos en el fichero MBOX </p> <p> </p> <p>Este M\u00f3dulo, es capaz tambi\u00e9n de leer ficheros PST y OST. Una vez que haya terminado de analizar el fichero MBOX podremos acceder a los correos en la siguiente secci\u00f3n: </p> <p> </p>"},{"location":"ud2/#plataformas-y-herramientas-de-analisis","title":"Plataformas y herramientas de an\u00e1lisis","text":"<p>Existen en el mercado una cantidad inimaginable de herramientas forenses, es decisi\u00f3n de cada investigador elegir aquellas que mas se adapten a su forma de trabajar. Mi recomendaci\u00f3n es que vay\u00e1is probando herramientas, tanto las recogidas en la unidad did\u00e1cticaes como aquellas que encontr\u00e9is y recoj\u00e1is en vuestra herramienta de notas todas aquellas que os puedan ser \u00fatiles para el futuro.</p>"},{"location":"ud2/#algunos-repositorios-muy-conocidos","title":"Algunos repositorios muy conocidos:","text":"<ul> <li>Forensic Wiki</li> <li>Eric Zimmerman\u015b Tools</li> <li>SANS Tools Collection</li> <li>Free Forensics Software \u2013 The Ultimate List</li> <li>Repo de herramientas de an\u00e1lisis forense windows</li> </ul>"},{"location":"ud2/#ejemplos-de-plataformas-preconfiguradas","title":"Ejemplos de plataformas preconfiguradas","text":"<ul> <li>Disk_Analysis_Tools (Forensic Wiki)</li> <li>Autopsy </li> <li>Caine</li> </ul>"},{"location":"ud2/#windows-forensics-cheat-sheets","title":"Windows Forensics Cheat Sheets","text":"<ul> <li>SANS_Windows Forensic Analysis Poster</li> <li>SANS_Windows Third Party Forensics Poster</li> </ul>"},{"location":"ud3/","title":"Documentation and Reporting","text":""},{"location":"ud3/#conceptos-basicos","title":"Conceptos B\u00e1sicos","text":""},{"location":"ud3/#definicion-y-objetivos","title":"Definici\u00f3n y Objetivos","text":"<p>La inform\u00e1tica forense es una disciplina que combina elementos de la ley y la inform\u00e1tica para recopilar y analizar datos de sistemas inform\u00e1ticos, redes y dispositivos electr\u00f3nicos. Su objetivo principal es descubrir y utilizar evidencia digital en investigaciones legales y criminales.</p>"},{"location":"ud3/#importancia-actual","title":"Importancia Actual","text":"<p>En un mundo cada vez m\u00e1s digitalizado, la inform\u00e1tica forense se ha vuelto esencial. Ayuda a descubrir evidencias en casos de ciberataques, fraudes y otros delitos cibern\u00e9ticos, jugando un rol crucial en la resoluci\u00f3n de cr\u00edmenes y litigios legales.</p>"},{"location":"ud3/#marco-legal","title":"Marco Legal","text":"<p>El art\u00edculo 335 de la Ley de Enjuiciamiento Criminal (LEC) destaca la importancia de peritos con conocimientos cient\u00edficos, t\u00e9cnicos o pr\u00e1cticos para valorar hechos o circunstancias relevantes en asuntos legales, resaltando la relevancia del an\u00e1lisis forense en el sistema judicial.</p>"},{"location":"ud3/#momentos-procesales","title":"Momentos Procesales","text":"<p>Los informes periciales pueden presentarse en distintas etapas del proceso judicial, dependiendo del caso. Estos informes son fundamentales para proporcionar una base t\u00e9cnica o cient\u00edfica durante las diferentes fases de un litigio, desde las alegaciones iniciales hasta la contestaci\u00f3n a demandas.</p>"},{"location":"ud3/#realidad-actual","title":"Realidad Actual","text":"<p>La inform\u00e1tica forense enfrenta desaf\u00edos \u00fanicos debido a la r\u00e1pida evoluci\u00f3n tecnol\u00f3gica. Aunque la estructura documental judicial es clara, los informes forenses deben adaptarse continuamente a nuevas tecnolog\u00edas y m\u00e9todos, lo que plantea la necesidad de una constante actualizaci\u00f3n y normalizaci\u00f3n.</p>"},{"location":"ud3/#regulacion","title":"Regulaci\u00f3n","text":"<p>La inform\u00e1tica forense, a diferencia de campos m\u00e1s establecidos como la medicina legal, a\u00fan est\u00e1 en proceso de definir est\u00e1ndares regulatorios claros. Esta situaci\u00f3n subraya la necesidad de entidades espec\u00edficas que establezcan normativas y gu\u00edas para la pr\u00e1ctica forense digital.</p>"},{"location":"ud3/#normativa","title":"Normativa","text":"<p>Documentos como RFC3227, ISO 179001 y UNE 71505 establecen buenas pr\u00e1cticas y normas para la gesti\u00f3n de evidencias electr\u00f3nicas y los informes forenses. Estos est\u00e1ndares ayudan a asegurar la calidad, integridad y validez legal de las evidencias digitales recopiladas.</p>"},{"location":"ud3/#el-informe-y-dictamen-pericial","title":"El Informe y Dictamen Pericial","text":"<p>Elaborar informes periciales que sean comprensibles para audiencias no t\u00e9cnicas, especialmente en entornos judiciales, es un desaf\u00edo. Es crucial mantenerse dentro de los l\u00edmites del encargo pericial y evitar conclusiones que excedan el alcance de la consulta.</p>"},{"location":"ud3/#contenido-de-un-informe","title":"Contenido de un Informe","text":"<p>Un informe pericial debe incluir elementos como el juramento del perito, declaraci\u00f3n de abstenci\u00f3n, \u00edndice, resumen ejecutivo, antecedentes, objetivos, fuentes de informaci\u00f3n, m\u00e9todos de adquisici\u00f3n de evidencias, an\u00e1lisis detallado, limitaciones y conclusiones. Cada parte aporta a la claridad y validez del informe.</p>"},{"location":"ud3/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Un informe pericial efectivo debe estar bien estructurado, ser conciso y claro. Debe evitar la extensi\u00f3n innecesaria y basar su valor en argumentaciones s\u00f3lidas. La orientaci\u00f3n hacia el destinatario y el uso de un lenguaje comprensible son fundamentales para su efectividad.</p>"},{"location":"ud4/","title":"UD3 - Linux Forensics","text":""},{"location":"ud5/","title":"UD4 - Memory Forensics","text":""},{"location":"ud6/","title":"UD5 - Mobile Device Forensics","text":""},{"location":"ud7/","title":"UD6 - IoT Forensics","text":""},{"location":"ud8/","title":"UD7 - Cloud Forensics","text":""},{"location":"ud2/ud2.1.Caracateristicas_OS/","title":"Caracter\u00edsticas de los sistemas operativos Windows y Linux","text":""},{"location":"ud2/ud2.2.Plataformas_y_herramientas_de_analisis/","title":"Plataformas y herramientas de an\u00e1lisis","text":"<p>Existen en el mercado una cantidad inimaginable de herramientas forenses, es decisi\u00f3n de cada investigador elegir aquellas que mas se adapten a su forma de trabajar. Mi recomendaci\u00f3n es que vay\u00e1is probando herramientas, tanto las recogidas en la unidad did\u00e1cticaes como aquellas que encontr\u00e9is y recoj\u00e1is en vuestra herramienta de notas todas aquellas que os puedan ser \u00fatiles para el futuro.</p>"},{"location":"ud2/ud2.2.Plataformas_y_herramientas_de_analisis/#algunos-repositorios-muy-conocidos","title":"Algunos repositorios muy conocidos:","text":"<ul> <li>Forensic Wiki</li> <li>Eric Zimmerman\u015b Tools</li> <li>SANS Tools Collection</li> <li>Free Forensics Software \u2013 The Ultimate List</li> <li>Repo de herramientas de an\u00e1lisis forense windows</li> </ul>"},{"location":"ud2/ud2.2.Plataformas_y_herramientas_de_analisis/#ejemplos-de-plataformas-preconfiguradas","title":"Ejemplos de plataformas preconfiguradas","text":"<ul> <li>Disk_Analysis_Tools (Forensic Wiki)</li> <li>Autopsy </li> <li>Caine</li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/","title":"Principales artefactos en sistemas windows","text":""},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#windows-forensics-cheat-sheets","title":"Windows Forensics Cheat Sheets","text":"<ul> <li>SANS_Windows Forensic Analysis Poster</li> <li>SANS_Windows Third Party Forensics Poster</li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#identificacion-y-analisis-de-artefactos-forenses-propios-del-sistema-de-archivos","title":"Identificaci\u00f3n y an\u00e1lisis de artefactos forenses propios del sistema de archivos","text":""},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#index-records","title":"$INDEX Records","text":"<p>NTFS indexa la informaci\u00f3n de cada directorio en un B+ Tree: </p> <p> </p> <p>FTK analiza el sistema de archivos y lo representa como un fichero m\u00e1s ($I30), seg\u00fan vemos en la imagen superior. </p> <p>Este atributo contiene informaci\u00f3n sobre los nombres de archivo y directorios que hay almacenados y que hubo dentro de \u00e9l. Este atributo es tambi\u00e9n conocido como $INDX y contiene: </p> <ul> <li>$INDEX_ROOT = 0x90 </li> <li>$INDEX_ALLOCATION = 0xA0 </li> <li>$BITMAP = 0XB0 </li> </ul> <p>Cuando borras un fichero de un directorio, el atributo $I30 queda de manera de slack space y se puede encontrar evidencias de que existi\u00f3. Es decir, dentro del propio fichero $I30 tenemos slack space. </p> <p> </p> <p>En la captura se identifica el fichero Uforia.pdf como $I30 INDX Entry. Es decir, esta entrada est\u00e1 dentro del $I30. \u00bfQu\u00e9 herramienta podemos utilizar para analizar el fichero $I30? </p> <p>IndexCSV </p> <p> </p> <p>Muy importante marcar la opci\u00f3n de Slack para que pueda obtener dentro del slack space del fichero I30 los registros que hubo. </p> <p>** Ver video: 01 - An\u00e1lisis de INDX </p> <p>\u00bfQu\u00e9 podemos obtener una vez hayamos analizado el fichero $I30? </p> <ul> <li>Fecha de Creaci\u00f3n del Fichero que hay en la carpeta </li> <li>Fecha de modificaci\u00f3n del fichero que hay en la carpeta </li> <li>Fecha de acceso del fichero que hay en la carpeta </li> <li>Fecha de cambio de registro MFT que hay en la carpeta </li> <li>Tama\u00f1o f\u00edsico, l\u00f3gico. </li> <li>Registro MFT </li> </ul> <p> </p> <p>Nunca obtendremos la fecha del fichero borrado que hubo en la carpeta. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#shadow-copies","title":"Shadow Copies","text":"<p>Las shadow copies tambi\u00e9n conocidas como el Servicio Volume Snapshot o Volume Shadow Copy (VSS), es una tecnolog\u00eda que se incluy\u00f3 en los sistemas operativos a partir de Windows 7. Es un servicio de Backup autom\u00e1tico y transparente para el usuario que est\u00e9 utilizando el sistema. </p> <p> </p> <p>F\u00edsicamente las shadows copies se encuentran en la carpeta ra\u00edz: System Volume Information </p> <p> </p> <p>En un equipo encendido o Live, es f\u00e1cil acceder a dichas shadows copies: </p> <p> </p> <p>\u00bfc\u00f3mo podr\u00edamos acceder a las shadows copies de una imagen forense?  **Ver Video: 02-Analisis de Shadows</p> <p>Junto con Arsenal Image Mounter y la herramienta de Nirsoft ShadowCopy View podr\u00edamos extraer los ficheros que hay en cada snapshot. </p> <p> </p> <p>Para analizar las Shadows Copies de un Windows 10, hay que lanzarlo desde un Windows 10. As\u00ed para todas las versiones de Windows. </p> <p>\u00bfDe qu\u00e9 ficheros se realiza backup mediante las shadows copies? </p> <p>Para ello habr\u00eda que analizar el registro de Windows, en especial el fichero SYSTEM e ir a la siguiente ruta: </p> <ul> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VSS Y a esta ruta: </li> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore Dentro de esta \u00faltima clave de registro, podremos encontrar: </li> <li>FilesNotToBackup -&gt; ficheros que no se deben copiar </li> <li>KeysNotToRestore\u200a -&gt; claves de registro de Windows que no se deben de copiar. </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#carving","title":"Carving","text":""},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#que-ocurre-cuando-se-borra-un-fichero-mediante-el-sistema-operativo","title":"\u00bfQu\u00e9 ocurre cuando se borra un fichero mediante el sistema operativo?","text":"<p>Cuando vac\u00eda la papelera en un Sistema Windows, se borra presionando la tecla \u201cSHIFT\u201d o se borra desde el CMD, es cuando de verdad se produce un borrado el fichero. A continuaci\u00f3n identificamos todo el proceso a nivel forense: </p> <ol> <li>Se cambia el atributo flag, en la cabecera del registro MFT del fichero o carpeta que se ha borrado: </li> <li>Archivos: 0x01 to 0x00 </li> <li>Directorios: 0x03 to 0x02. </li> <li>El atributo $BITMAP del registro del MFT es procesado y establecido a 0 </li> <li>Los atributos no residentes del registro del MFT asociado al fichero en cuesti\u00f3n, son procesados y sus cl\u00faster son establecidos como espacio libre en el fichero $BITMAP. </li> </ol> <p>\u00bfTodo el proceso anterior impide que se pueda recuperar la informaci\u00f3n? No. Como ya hemos visto anteriormente se podr\u00e1 recuperar siempre y cuando no se sobrescriba el registro MFT, debido al uso del sistema. </p> <p>Los ransomware cuando deshabilitan las Shadows copies, lo que hacen es utilizar una llamada al sistema para la lanzar el comando pertinente. Este comando es propio del sistema operativo </p> <p> </p> <p>Para recuperarlas veremos en la parte de carving otra herramienta. </p> <p>\u00bfLas herramientas de borrado seguro c\u00f3mo funcionan? Estas herramientas pueden eliminar: </p> <ul> <li>El registro de MFT completo del fichero asociado </li> <li>Logfile </li> <li>Shadows copies </li> </ul> <p>A parte de realizar las operaciones anteriores, los clusters que son utilizados para contener el propio fichero, se sobrescriben a ceros o siguiendo un est\u00e1ndar de borrado que va en funci\u00f3n del n\u00famero de pasadas. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-datos-mediante-el-propio-sistema-de-archivos","title":"Recuperaci\u00f3n de datos mediante el propio sistema de archivos","text":"<p>\u00bfC\u00f3mo funcionan los programas de recuperaci\u00f3n de ficheros que analizan el MFT? </p> <ol> <li>Buscan en el registro $MFT del fichero en cuesti\u00f3n. </li> <li>Analizan su atributo $DATA del registro. </li> <li>S\u00ed el atributo $DATA es residente, el contenido como tal est\u00e1 en el propio registro. </li> <li>S\u00ed el atributo $DATA es no residente, el contenido del fichero est\u00e1 en un cl\u00faster externo. A continuaci\u00f3n, se parsea el RunList. (Runlist contiene los clusters asociados al fichero) </li> <li>Verificar si los clusters del Runlist est\u00e1n allocated o no. Si todos los cl\u00faster est\u00e1n allocated La recuperaci\u00f3n de datos es posible. </li> <li>Si algunos clusters tienen de estado de allocated a 1, se puede realizar una recuperaci\u00f3n de datos parcial. Los que est\u00e1n allocate cambian a 0. </li> <li>Si todos los clusters estuviesen a 1, significa que ya hay un fichero que utiliza todos los cl\u00faster </li> </ol> <p>Este tipo de t\u00e9cnicas si permite recuperar el nombre del fichero, ya que se obtiene del atributo $FILE_NAME. </p> <p>Otras t\u00e9cnicas de recuperaci\u00f3n de archivos utilizando artefactos del sistema de archivos, ser\u00edan: </p> <ul> <li>Carving de registros MFT en el espacio libre </li> <li>B\u00fasqueda de registros MFT en el propio registro $MFT, en el slack space. </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-datos-mediante-carving","title":"Recuperaci\u00f3n de datos mediante carving","text":"<p>La recuperaci\u00f3n de datos mediante carving, se basa en ir analizando cl\u00faster a cl\u00faster del dispositivo de almacenamiento en busca de cabeceras o formas conocidas. Esta t\u00e9cnica NO permite recuperar el nombre del fichero. No depende del sistema de archivos, sino de conocer previamente como esta formado el fichero que queremos recuperar. </p> <p> </p> <p>Tres tipos de t\u00e9cnicas: </p> <ul> <li>Basadas en cabeceras y cierre del fichero: Header-Footer con tama\u00f1o m\u00e1ximo del fichero </li> <li>Basadas en c\u00f3mo est\u00e1 el fichero construido : File structure based carving </li> <li>Content based Carving -&gt; basadas en el contenido en s\u00ed </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#tecnica-header-footer","title":"T\u00e9cnica Header - Footer","text":"<p>Se utiliza un header conocido y un footer: </p> <ul> <li>Fichero JPEG Header: OxFF,OxD8 -&gt; FFD8 </li> <li>Fichero JPEG Footer: OxFF,OxD9 -&gt; FFD9 </li> </ul> <p>Un listado de todas las cabeceras o firmas lo podemos encontrar en la siguiente URL: https://www.garykessler.net/library/file_sigs.html </p> <p>\u00bfQu\u00e9 herramienta podemos utilizar para aplicar esta t\u00e9cnica? Photorec </p> <p>\u00bfSirve con los programas de borrado seguro? No, ya que no podemos identificar headers/footers conocidos al haber sido sobrescritos por ciertos patrones grupos de ceros. </p> <p>Photorec no funciona con formato de imagen Encase, solo en im\u00e1genes en RAW o sobre el dispositivo f\u00edsico. </p> <p>Dispone de much\u00edsimas cabeceras y tipos de ficheros: https://www.cgsecurity.org/wiki/File_Formats_Recovered_By_PhotoRec </p> <p> </p> <p>**Ver video: 03-Photorec </p> <p>La t\u00e9cnica de carving no es v\u00e1lida para ficheros que est\u00e9n desfragmentados ya que los clusters que ocupan el fichero no est\u00e1n contiguos. </p> <p>\u00bfQu\u00e9 podr\u00edamos recuperar mediante t\u00e9cnicas de carving? </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>Shadows Copies </li> <li>$I30 </li> </ul> <p>Las shadows se pueden recuperar gracias a la siguiente herramienta: https://github.com/mnrkbys/vss_carver </p> <p>En el github aparece como y qu\u00e9 comandos son necesarios para poder utilizarla: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#stream-carving-vs-file-carving","title":"Stream Carving vs File Carving","text":"<p>El data Stream Carving se basa en extraer fragmentos de las siguientes fuentes de </p> <p>informaci\u00f3n: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre </li> <li>Ficheros de bases de datos Ejemplos: </li> <li>URLs (navegaci\u00f3n privada) </li> <li>Sesiones de Chat </li> <li>E-mails </li> <li>Claves de Cifrado </li> </ul> <p>El data stream carving est\u00e1 basado en la localizaci\u00f3n de peque\u00f1os fragmentos y no en la b\u00fasqueda del fichero entero. Los peque\u00f1os fragmentos pueden tener un gran significado, pero normalmente son parte de un fichero. Por ejemplo, las bases de datos como el fichero index.dat puede contener cientos de URL que han sido visitadas cuando se borraron. Si no eres capaz de recuperar el fichero completo se podr\u00edan extraer fragmentos. </p> <p>El file Carving o carving a secas, puede extraer ficheros de: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre Ejemplos: </li> <li>Word (.doc/.docx) </li> <li>Im\u00e1genes (.jpg,.png,.gif) </li> <li>Archivos (.zip /.rar) </li> </ul> <p>Una herramienta que permite hacer ambos tipos de recuperaci\u00f3n es Bulk Extractor, soporta im\u00e1genes forenses en formato E01: </p> <p> </p> <p>Tambi\u00e9n permite realizar carving de: </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>$I30 </li> </ul> <p>** Ver video: 04-Bulk Extractor </p> <p>Una vez seleccionemos con Bulk Extractor la imagen a procesar, podemos ver el estado de c\u00f3mo va avanzado: </p> <p> </p> <p>Todos los resultados los guardar\u00e1 sobre la carpeta que hemos indicado. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#timeline","title":"Timeline","text":"<p>El timeline o l\u00ednea del tiempo nos permite obtener acotar en tiempo la investigaci\u00f3n de una evidencia, por ejemplo: nos indican que la investigaci\u00f3n est\u00e1 focalizada a ra\u00edz de la comunicaci\u00f3n a un trabajador que va ser despedido. La compa\u00f1\u00eda a ra\u00edz de esta comunicaci\u00f3n ha visto un comportamiento sospechoso. </p> <ul> <li>Fecha de comunicaci\u00f3n de despido: m\u00ednima fecha a investigar </li> <li>Fecha de salida de la compa\u00f1\u00eda: m\u00e1xima fecha a investigar </li> </ul> <p>Nuestro timeline estar\u00e1 basado \u00fanicamente en los timestamps del sistema de archivos, es decir, en las fechas de: </p> <ul> <li>Creaci\u00f3n de fichero -&gt; C </li> <li>Modificaci\u00f3n de fichero -&gt; M </li> <li>Cambio de registro MFT -&gt;B </li> <li>Acceso -&gt; A </li> </ul> <p>Estas fechas se le denomina MACB timestamp, para crear el Timeline podemos utilizar la herramienta Autopsy: </p> <p> </p> <p>** Ver video: 05-Autopsy</p> <p>Otra manera de generar un Timeline, ser\u00eda con la herramienta MFT2CSV, pero seleccionando el formato de salida log2timeline. Una vez se haya generado el CSV, deberemos de abrirlo con la herramienta TimeLine Explorer. </p> <p> </p> <p>** Ver Video: 06-Timeline </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#metadatos-de-ficheros","title":"Metadatos de ficheros","text":"<p>Los metadatos est\u00e1n definidos como estructura interna del propio fichero en s\u00ed. No tiene nada que ver con los metadatos que hemos visto del sistema de archivos. \u00bfQu\u00e9 tipos de ficheros pueden contener metadatos? </p> <ul> <li>Im\u00e1genes </li> <li>Documentos ofim\u00e1ticos </li> <li>Documentos de Audio </li> <li>Documentos de video </li> <li>Ejecutables </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en un fichero ofim\u00e1tico? </p> <ul> <li>T\u00edtulo </li> <li>Versi\u00f3n de MS Office Utilizada </li> <li>\u00daltimo Autor </li> <li>Creaci\u00f3n del documento /hora </li> <li>\u00daltima fecha de guardado </li> <li>\u00daltima fecha de impresi\u00f3n </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en una imagen? </p> <ul> <li>EXIF Data </li> <li>Marca C\u00e1mara / Modelo </li> <li>Hora de creaci\u00f3n </li> <li>Hora de modificaci\u00f3n </li> <li>Informaci\u00f3n de la imagen </li> <li>Coordenadas GPS </li> </ul> <p>Nota: Estos metadatos son muy f\u00e1ciles de manipular. Para realizar una investigaci\u00f3n correcta, se deben utilizar m\u00e1s artefactos y verificar dicha informaci\u00f3n. </p> <p> </p> <p>** Ver Video: 07-Exif tool </p> <p>Exiftool tambi\u00e9n permite analizar de manera recursiva un directorio: https://owl.phy.queensu.ca/~phil/exiftool/examples.html </p> <p>Las fechas que aparecen como metadatos en el documento ofim\u00e1tico son introducidas por la herramienta ofim\u00e1tica. No confundir con las fechas del sistema de archivos. </p> <p>Un documento como tal nunca contendr\u00e1 fechas a no ser que disponga de alg\u00fan metadato dentro \u00e9l. </p> <p>Otra herramienta muy buena para metadatos es Metadiver: https://www.easymetadata.com/metadiver-2/ </p> <p> </p> <p>Caracter\u00edsticas: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#registro-de-windows","title":"Registro de Windows","text":"<p>El registro de Windows, es uno de los artefactos m\u00e1s importante para un investigador, ya que dispone de mucha informaci\u00f3n acerca del sistema y de la actividad del usuario. Veremos cuatro secciones relacionadas con el registro de Windows: </p> <ul> <li>Registro de Windows : veremos todo lo necesario para leer el registro </li> <li>Usuario / Grupo: analizaremos la informaci\u00f3n relacionada permitiendo obtener el \u00faltimo login y los usuarios que tienen acceso al sistema. En el SAM. </li> <li>Configuraci\u00f3n del sistema: obtener la \u00faltima direcci\u00f3n IP, identificar los puntos de acceso a los que se ha conectado. SYSTEM o SOFTWARE </li> <li>Actividad del usuario: la parte m\u00e1s \u00fatil en cuanto al registro. Monitorizar la actividad gracias a los documentos abiertos, aplicaciones ejecutadas, etc. NTUSER.DAT </li> </ul> <p>Donde se encuentranlos ficheros de registro en un sistema Windows: en %Windir%\\System32\\Config: </p> <ul> <li>SAM -&gt; HKEY_LOCAL_MACHINE </li> <li>SECURITY -&gt; HKEY_LOCAL_MACHINE </li> <li>SYSTEM -&gt; HKEY_LOCAL_MACHINE </li> <li>SOFTWARE -&gt; HKEY_LOCAL_MACHINE </li> <li>DEFAULT -&gt; HKEY_LOCAL_MACHINE </li> </ul> <p>Existe tambi\u00e9n otro registro, relacionado con el usuario en \\%UserProfile%{user}\\: </p> <ul> <li>NTUSER.DAT -&gt; HKEY_CURRENT_USER </li> </ul> <p>Si abrimos nuestro Sistema y ejecutamos regedit.exe, veremos que la ra\u00edz del registro es la siguiente: </p> <p> </p> <p>Los sistemas Windows disponen de un backup del registro localizado en %Windir%\\System32\\Config\\RegBack:</p> <ul> <li>SAM -&gt; HKEY_LOCAL_MACHINE </li> <li>SECURITY -&gt; HKEY_LOCAL_MACHINE </li> <li>SYSTEM -&gt; HKEY_LOCAL_MACHINE </li> <li>SOFTWARE -&gt; HKEY_LOCAL_MACHINE </li> <li>DEFAULT -&gt; HKEY_LOCAL_MACHINE </li> </ul> <p>Esta copia de seguridad solo est\u00e1 disponible de Windows Vista en adelante y de Windows 2008 Server en adelante. Otro lugar donde pod\u00edamos encontrar una copia del registro ser\u00eda en las Shadow Copies. </p> <p>\u00bfQu\u00e9 registros hay asociados al usuario? </p> <ol> <li>NTUSER.DAT </li> <li>C:\\Users{username}\\NTUSER.DAT -&gt; WinVista-Win10 </li> <li>C:\\Documents and Settings{username}\\NTUSER.dat -&gt; XP </li> </ol> <p> </p> <ol> <li>USRCLASS.DAT </li> <li>C:\\Users{username}\\AppData\\Local\\Microsoft\\Windows\\USRCLASS.DAT -&gt; Solo disponible a partir de Win7/Win8/Win10 </li> </ol> <p>USRCLASS.DAT es muy importante porque contiene informaci\u00f3n en cuanto la ejecuci\u00f3n de programas indicando que directorios y han sido abiertos o cerrados. </p> <ul> <li>El prop\u00f3sito principal del UsrClass.DAT es ayudar a la UAC. </li> </ul> <p>Estos registros de usuario son \u00fanicos para el usuario del sistema, por lo que siempre habr\u00e1 uno para cada usuario. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-claves-valor","title":"Recuperaci\u00f3n de Claves-Valor","text":"<p>\u00bfQu\u00e9 hay dentro del registro de Windows? La informaci\u00f3n est\u00e1 organizada: </p> <p> </p> <p>Key : similar a los directorios (keys) y subdirectorios (subkeys) </p> <ul> <li>Produce una jerarqu\u00eda de directorios </li> </ul> <p>Values: informaci\u00f3n almacenada dentro de una key </p> <ul> <li>Contiene informaci\u00f3n en forma de: strings, integers, lists. </li> </ul> <p>Los Hives del registro de Windows tiene espacio libre similar al sistema de archivos, por lo que se podr\u00e1n recuperar keys borradas. Una clave borrada es marcada, pero no es deslocalizada, por lo que permite la recuperaci\u00f3n de: </p> <ul> <li>Keys, Values y TimeStamps </li> </ul> <p>A d\u00eda de hoy no hay herramientas anti forenses que limpien completamente el espacio libre del registro. </p> <p> </p> <p>En la imagen anterior vemos la herramienta Registry Explorer donde aparece en rojo las claves-valor que han sido borradas. M\u00e1s adelante veremos c\u00f3mo funciona esta herramienta. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#last-write-time","title":"Last Write Time","text":"<p>Dentro del registro tambi\u00e9n hay timestamps y se le llama \u201cLast Write Time\u201d. Como bien dice su nombre, es la \u00faltima vez que se modifica la key-value del registro. Para poder interpretar este campo como una fecha real, es necesario realizar pruebas con la aplicaci\u00f3n que escriba en el registro y poder contextualizar la informaci\u00f3n. </p> <p>Otro elemento que indica un orden temporal es el MRU, que es el acr\u00f3nimo de Most Recenty Used. </p> <ul> <li>Existen varios MRU que son responsables del drop-down sobre un men\u00fa que aparece o cuando tecleas algo en Internet Explorer. </li> <li>En el registro, los MRULists son una Key-Value que son responsables de mantener registrado las adiciones al registro. Por lo tanto, se puede determinar en qu\u00e9 orden se a\u00f1adi\u00f3. </li> <li>La MRUList puede variar en funci\u00f3n del sistema operativo. </li> <li>El Last write de la key ser\u00e1 la fecha del primer MRULIst que ocurri\u00f3 </li> </ul> <p>Herramientas para analizar el registro de manera online: </p> <p> </p> <p>Herramientas para Analizar el Registro de manera offline: Registry Explorer </p> <p> </p> <p>Registry Explorer dispone de: </p> <ol> <li>Bookmarks: en funci\u00f3n del registry hive cargado (NTUSER.DAT,SYSTEM,etc), carga unos bookmarks u otros. Son claves del registro que se conocen y contienen informaci\u00f3n \u00fatil. </li> </ol> <p> </p> <ol> <li>Find: permite buscar por el string o regex, filtrando por tiempo, valores m\u00ednimos. </li> </ol> <p> </p> <p>** Ver video: 08-Registry Explorer </p> <p>RegRipper es otra herramienta escrita en Perl que se encarga de analizar los hives del registro. El an\u00e1lisis no es tan user friendly como lo que presenta Registry Explorer, pero tambi\u00e9n dispone de unos bookmarks o plugins de localizaciones de key-value del Registro con informaci\u00f3n relevante: </p> <p>https://github.com/keydet89/RegRipper2.8/tree/master/plugins </p> <p>A diferencia de Registry Explorer, en RegRipper se le debe indicar mediante el campo de Profile cual es el tipo de hive que va analizar. De esta manera cargar\u00e1 los plugins acordemente. </p> <p> </p> <p>El reporte de RegRipper es un fichero de texto que puede ser abierto con Notepad++. ** Ver video: 002-RegRipper </p> <p>Windows Registry Recovery es otro software que permite analizar el registro de Windows, de manera visual. Es muy \u00fatil para obtener qu\u00e9 aplicaciones han sido instaladas, como podemos apreciar en la imagen inferior. </p> <p>En funci\u00f3n del Hive seleccionado, las opciones de la izquierda dispondr\u00e1n de informaci\u00f3n. </p> <p> </p> <p>** Ver Video:09-WRR </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#sam","title":"SAM","text":"<p>El fichero SAM o hive SAM, contiene todos los usuarios y grupos que hay a nivel local en el sistema Windows. Tambi\u00e9n dispone de los hashes pertinentes que son validados cuando un usuario hace logon. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#identificando-usuarios-y-grupos","title":"Identificando Usuarios y Grupos","text":"<p>Del fichero SAM podemos obtener a qu\u00e9 grupo est\u00e1 asignado el usuario, como por ejemplo: </p> <ul> <li>Administradores </li> <li>Usuarios </li> <li>Usuarios del escritorio Remoto </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener del registro SAM del usuario? </p> <p>La informaci\u00f3n se encuentra en SAM\\Domains\\Account\\Users y contiene: </p> <ul> <li>El usuario y el RID asociado a \u00e9l. </li> <li>Variedad de informaci\u00f3n asociado al usuario </li> <li>\u00daltimo login (vac\u00edo si se utiliza una cuenta Microsoft para hacer login) </li> <li>\u00daltimo login fallido </li> <li>Contador de login </li> <li>Pol\u00edtica de passwords </li> <li>Cuando se cre\u00f3 la cuenta. </li> </ul> <p> </p> <p>En la imagen anterior se ve el detalle que el usuario \u201cismis\u201d utiliza una cuenta Microsoft para hacer login, debido a que el campo \u201cLast Logon Time\u201d est\u00e1 vac\u00edo. </p> <p>Con la herramienta WRR se puede identificar correctamente: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#passwords-en-blanco","title":"Passwords en blanco","text":"<p>Windows 10 implementa un cifrado de hashes, que puede inducir a error, si no es analizado correctamente. Si la herramienta no es capaz de interpretar este nuevo cifrado aparecer\u00e1 que el NTLM-HASH es un blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p> <p>Para poder ver los hashes es necesario tener el SAM y el SYSTEM del sistema. Gracias a la herramienta Windows Password Recovery de Passcape podr\u00edamos verificar su hash: </p> <p> </p> <p>Windows Password Recovery si puede leer el nuevo cifrado AES 128 de Windows, mimikatz tambi\u00e9n. </p> <p> </p> <p>Si no lo leyese bien, aparecer\u00eda un hash blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#principales-artefactos-del-registro-de-windows","title":"Principales Artefactos del registro de Windows","text":"<p>A continuaci\u00f3n, vamos a identificar las principales claves-valor del registro que pueden ser susceptibles de ser usadas en caso de realizar una investigaci\u00f3n. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#identificar-la-version-del-sistema","title":"Identificar la versi\u00f3n del sistema","text":"<p>Este artefacto forense, como bien el t\u00edtulo, nos va permitir identificar en el registro la versi\u00f3n del sistema. </p> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion determina: </p> <ul> <li>La versi\u00f3n de Windows </li> <li>Service Pack instalador </li> <li>Fecha de instalaci\u00f3n en formato Epoch Time (n\u00famero de segundos desde el 1/1/1970) </li> <li>En Windows tiene el campo Install Time que sigue el formato de Windows 64 bit, respecto al tiempo </li> </ul> <p> </p> <p>En el registro encontraremos la fecha (Install Time) en decimal, la convertimos a hexadecimal y la pasamos por la herramienta Dcode. </p> <p> </p> <p>DCode: https://www.digital-detective.net/dcode/ </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#nombre-de-la-maquina","title":"Nombre de la m\u00e1quina","text":"<p>Es \u00fatil ya que el nombre de la m\u00e1quina aparece en otras localizaciones pero generalmente se usa para asegurar que estamos trabajando con el equipo correcto. </p> <p>Ruta: System\\ControlSet001\\Control\\ComputerName\\ComputerName </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#zona-horaria","title":"Zona horaria","text":"<p>Es \u00fatil para correlacionar correctamente la actividad en la evidencia: Logs internos del sistema y timestamps estar\u00e1n basadas en esta informaci\u00f3n Antes hab\u00edamos visto los timestamps del registro est\u00e1n en UTC. </p> <p>FAT est\u00e1 asociado a la hora local del sistema y por lo tanto a este par\u00e1metro. NTFS est\u00e1 en UTC. </p> <p>Ruta: System\\ControlSet001\\Control\\TimeZoneInformation </p> <p> </p> <p>Romance Standard Time = Central European TIME: </p> <p>https://en.wikipedia.org/wiki/Central_European_Time** </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#fecha-de-ultimo-acceso","title":"Fecha de \u00faltimo acceso","text":"<p>Por defecto Windows no actualiza la fecha de \u00faltimo acceso. Es una propiedad que se encuentra en el registro: </p> <p>Ruta: System\\ControlSet001\\Control \\Filesystem </p> <ul> <li>Hay que verificar si est\u00e1 activado buscando NtfsDisableLastAccessUpdate = 0 </li> <li>Por defecto viene activada esta opci\u00f3n lo que impide saber cu\u00e1ndo se accedi\u00f3 (Win7-Win10) </li> </ul> <p> </p> <p>Comando para activarlo: fsutil behavior set disablelastaccess 0 </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#interfaces-de-red","title":"Interfaces de Red","text":"<p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Determinar los interfaces de red de la m\u00e1quina </li> <li>Determinar si el sistema tuvo una IP Est\u00e1tica o por DHCP Obtener GUID del interface para hacer correlaciones </li> </ul> <p>Ruta: System\\ControlSet001\\Services\\Tcpip\\Parameters\\Interfaces{GUID_INTERFACE} </p> <p> </p> <p>Esta informaci\u00f3n aparece mucho mejor representada en el WRR: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#historico-de-redes","title":"Hist\u00f3rico de Redes","text":"<p>\u00bfQu\u00e9 podemos encontrar? </p> <ul> <li>Identificar redes a la que el equipo se conect\u00f3 </li> <li>Identificar si las redes eran cableadas o inal\u00e1mbricas </li> <li>Identificar el nombre dominio </li> <li>Identificar el SSID </li> <li>Identificar la MAC Address del gateway </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Unmanaged </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Managed </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Nla\\Cache </li> </ul> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Primera y \u00faltima vez que se produjo la conexi\u00f3n a la red </li> <li>Listar conexiones que han sido conectadas a trav\u00e9s de VPN </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#cuando-se-conecto-a-una-red","title":"Cuando se conect\u00f3 a una Red","text":"<p>Prop\u00f3sito: </p> <ul> <li>Identificar el tipo de red a la que se conect\u00f3 </li> <li>Identificar el SSID de la red inal\u00e1mbrica </li> <li>El timestamp de este artefacto est\u00e1 en local time. </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\WZCSVC\\Parameters\\Interfaces{GUID} -&gt; XP </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles -&gt; Win7-Win10 </li> </ul> <p>Si la maquina es Win7-Win10 el tipo de red (NameType) viene definido de la siguiente manera: </p> <ul> <li>0x47 -&gt; Wireless </li> <li>0x06 -&gt; Cableada </li> <li>0x17 -&gt; 3G </li> </ul> <p>Categor\u00eda: </p> <ul> <li>Public -&gt; 0 </li> <li>Private / Home -&gt; 1 </li> <li>Domain /Work 2 </li> </ul> <p> </p> <p>Podemos identificar tambi\u00e9n DateCreated y DateLastConnected. Usando Windows 128 bit time y est\u00e1 almacenado en local time. </p> <p> </p> <p>Con el ProfileGUID {54ADAF4F-0492-458F-96EA-652ED5ABD35C} podemos mapear informaci\u00f3n hist\u00f3rica. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#carpetas-compartidas","title":"Carpetas Compartidas","text":"<p>\u00bfQu\u00e9 podemos identificar? </p> <ul> <li>Carpetas compartidas a nivel local </li> <li>Configuraci\u00f3n de dichas carpetas compartidas </li> </ul> <p>Ruta: *System\\ControlSet001\\Services\\lanmanserver\\Shares* Flags: </p> <ul> <li>CSCFlags: Caching Setting </li> <li>MaxUses: Usuarios m\u00e1ximos </li> <li>Permissions: Permisos de la carpeta </li> <li>Remark: Comentarios del usuario a\u00f1adidos </li> <li>Type: Tipo de compartici\u00f3n </li> </ul> <p> </p> <p>Client Side Caching </p> <p>Esta opci\u00f3n aparece dentro del CSCFLAGS: Si se comparte la carpeta con el Client Side Caching, si el cliente est\u00e1 desconectado de la red, dispondr\u00e1 de una copia del fichero en su sistema. </p> <p> </p> <p>La copia de estos ficheros se guardan tanto en el cliente como en el servidor en la ruta C:\\Windows\\CSC: </p> <ul> <li>CSCFlag=0 -&gt; Opci\u00f3n por defecto, donde el usuario debe indicar que ficheros quiere cachear </li> <li>CSCFlag=16 -&gt; Cacheo de documentos autom\u00e1ticos. \u201cAll files and programs that users open from the shared folder are automatically available offline\u201d with the \u201coptimize for perforance. </li> <li>CSCFlag=32 Igual que la opci\u00f3n anterior pero con la opci\u00f3n de \u201cOptimizado para rendimiento\u201d </li> <li>CSCFlag=48 Cach\u00e9 deshabilitada. </li> <li>CSCFlag=2048: Opci\u00f3n por defecto en Win7-Win10 hasta que el usuario deshabilita \u201cSimple File Sharing\u201d o utiliza las opciones avanzadas de compartici\u00f3n. Por defecto tambi\u00e9n el \u201cHomegroup\u201d </li> </ul> <p>Maxuses: n\u00famero total de conexiones a una compartici\u00f3n simple. Es un dato para limitar las conexiones. Por defecto 4294967295 para 32 bits. </p> <p>Path: directorio local. </p> <p>Permissions: aparentemente, este valor puede ayudar a determinar c\u00f3mo se comparti\u00f3 una carpeta. 0 es para cuando el valor ha sido creado mediante GUI o Powershell. </p> <ul> <li>Para Windows 7-Windows10, el valor es 9 si fue creado con el advanced file sharing y 63 si fue mediante l\u00ednea de comandos. </li> </ul> <p>Type: tipo de dispositivo o recurso accedido </p> <ul> <li>0 = Disk Drive/ Folder </li> <li>1 = Impresora </li> <li>3 = IPC </li> <li>2147483 = Admin (Disk,Printer, Device o IPC) </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#autostart-programs","title":"AutoStart Programs","text":"<p>\u00bfQu\u00e9 obtenemos? </p> <ul> <li>Determinar qu\u00e9 programas se ejecutan autom\u00e1ticamente </li> <li>\u00datil para localizar malware </li> <li>Determinar la \u00faltima fecha de cu\u00e1ndo se actualiz\u00f3 (generalmente \u00faltimo arranque del sistema) </li> </ul> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Runonce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#informacion-de-apagado","title":"Informaci\u00f3n de Apagado","text":"<p>Ruta: </p> <ul> <li>System\\ControlSet001\\Control\\Windows (Hora de apagado) </li> <li>System\\ControlSet001\\Control\\Watchdog\\Display (Shutdown count) \u2013 solo XP </li> </ul> <p>Las fechas est\u00e1n en HEX en formato Windows 64 Little Endian </p> <p> </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#busqueda-en-win7","title":"B\u00fasqueda en Win7","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordwheelQuery </p> <p>Aunque Windows vista no tiene almacenados los valores de b\u00fasqueda en el registro, Windows 7/8/10 s\u00ed. </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#busqueda-en-win-8-10","title":"B\u00fasqueda en Win 8 /10","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery </p> <ul> <li>Como Windows 8/10 pierde el bot\u00f3n de Inicio, las b\u00fasquedas quedan limitadas a la barra de b\u00fasqueda del Explorer. </li> <li>Las b\u00fasquedas son almacenadas en orden temporal. </li> <li>MRU = 0 es la \u00faltima b\u00fasqueda </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#typed-paths-windows-10","title":"Typed Paths Windows 10","text":"<p>Muestra como se ha escrito una ruta en el men\u00fa de inicio o en la barra del Explorer. Es \u00fatil para demostrar que el usuario conoc\u00eda con antelaci\u00f3n la ruta exacta. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recent-docs","title":"Recent Docs","text":"<p>Documentos recientes que han sido abiertos por el usuario desde Windows XP a </p> <p>Win10. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs </p> <p> </p> <p>MRU = 0 ser\u00eda el m\u00e1s actual </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#office-recent-docs","title":"Office Recent Docs","text":"<p>Este artefacto forense muestra los documentos ofim\u00e1ticos recientes, abiertos por el usuario: Ruta: NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\FileMRU </p> <ul> <li>14.0 Office 2010 </li> <li>12.0 Office 2007 </li> </ul> <p>NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\ UserMRU\\LiveID_###\\FileMRU -&gt; Office 365 </p> <ul> <li>15.0 office 2013 </li> <li>16.0 Office 2016 </li> </ul> <p>La clave FileMRU tendr\u00e1 una lista de los ficheros m\u00e1s recientes de office ordenados del 1-50. </p> <p> </p> <p>Dentro de este artefacto lo interesante es que viene la ruta completa si es comparada con el directorio \u201cRecent Docs\u201d que veremos m\u00e1s adelante. </p> <p>En la misma localizaci\u00f3n dentro de los Office 365 aparece una key llamada PlaceMRU, el cual muestra la localizaci\u00f3n del path previamente abierto en ese directorio. </p> <p>Los 8 bytes que hay a continuaci\u00f3n de la letra T es un timestamp en formato Windows 64 Big Endian. </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#auroguardado-de-ficheros-office","title":"Auroguardado de Ficheros Office","text":"<p>Los ficheros de autoguardado est\u00e1n en la carpeta: </p> <p>Ruta: *C:\\Usuarios\\\\AppData\\Roaming\\Microsoft{Excel|Word|Powerpoint}* <ul> <li>Ficheros con extensi\u00f3n .asd </li> </ul> <p> </p> <p>El fichero se renombra y ya podr\u00eda ser abierto. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#lastvisited-mru-vs-opensavemru","title":"LastVisited MRU vs OpenSaveMRU","text":"<p>Windows tiene cajas de di\u00e1logo que todos los programas usan. </p> <ul> <li>Tenemos dos tipos: </li> <li>LastVisitedMRU </li> <li>OpenSaveMRU </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#lastvisitedmru","title":"LastVisitedMRU","text":"<p>Este artefacto monitoriza qu\u00e9 aplicaci\u00f3n abre o guarda el fichero que hemos visto en el OpenSaveMRU. Te indica la ruta donde abri\u00f3 el fichero y el ejecutable </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU -&gt; WinXP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU LasVisitedPidlMRU -&gt; ( Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#opensavemru","title":"OpenSaveMRU","text":"<p>Este artefacto monitoriza los ficheros que han sido abiertos o guardados dentro de una ventana de Windows. Esto no solamente ocurre con los navegadores sino con la mayor\u00eda de las aplicaciones. </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Op enSaveMRU -&gt; Win XP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 Op enSavePidlMRU -&gt; (Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#ultimos-comandos-ejecutados","title":"\u00daltimos Comandos Ejecutados","text":"<p>Este artefacto, muestra los \u00faltimos comandos ejecutados desde el men\u00fa de ejecutar (RunBox): </p> <p> </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Policies\\RunRU </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#user-assistkey","title":"User AssistKey","text":"<p>Todos los programas con interfaz gr\u00e1fico que son ejecutados desde el escritorio son monitorizados por el launcher de Windows. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist{GUID}\\Co unt </p> <p>El GUID es el identificador de la aplicaci\u00f3n que se utiliza. Datos que podemos obtener: </p> <ul> <li>Last Run Time (UTC) </li> <li>Run Count: n\u00famero de veces que se ha ejecutado </li> <li>Nombre de la aplicaci\u00f3n GUI </li> <li>Focus Time: tiempo total que la aplicaci\u00f3n ha tenido el foco. </li> <li>Focus Count: n\u00famero total de veces que la aplicaci\u00f3n sali\u00f3 y entr\u00f3 del foco. </li> </ul> <p>El valor del nombre tambi\u00e9n tiene un significado en los User Assist Keys. El nombre de la clave siempre empezar\u00e1 por UEME_ e ir\u00e1 seguido por: </p> <ul> <li>RUNPATH: path absoluto del ejecutable. Un usuario normalmente ha clicado a trav\u00e9s de la interfaz de Windows Explorer. </li> <li>RUNCPL: para lanzar el panel de control. </li> <li>RUNPIDL: puntero al fichero actual como un fichero LNK. </li> <li>UIQCUT: cuenta las veces que ha sido lanzado a trav\u00e9s del QUICKLaunch </li> <li>UISCUT: cuenta las veces que ha sido lanzado a trav\u00e9s de un acceso directo en el escritorio. </li> <li>UITOOLBAT: informaci\u00f3n sobre los clicks de Windows Explorer ToolBar </li> </ul> <p> </p> <p>Registry Explorer interpreta directamente los valores en la columna Program Name. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#shell-items","title":"Shell Items","text":"<p>\u00bfQu\u00e9 es un shell item? Informaci\u00f3n o fichero que tiene informaci\u00f3n para acceder a </p> <p>otro fichero. </p> <p>Atributos: </p> <ul> <li>Tipo del target donde est\u00e1 el fichero: fijo, extra\u00edble, red </li> <li>Path del fichero target: unidad, etiqueta del volumen </li> <li>Metadatos: MAC timestamps, tama\u00f1o, registro MFT, N\u00famero de secuencia </li> </ul> <p>Tipos: </p> <ul> <li>Accesos directos (LNK) </li> <li>Jumplists </li> <li>Shellbags </li> </ul> <p> </p> <p>Header de LNK </p> <p>Al tener un firma espec\u00edfica se podr\u00eda realizar carving para recuperar los que se hayan borrado. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recent-documents-lnk","title":"Recent Documents (LNK)","text":"<p>Windows crea este shortcut cuando un usuario abre o utiliza un fichero. </p> <p>Ruta: </p> <ul> <li>Win7-Win10: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent  <li>Office: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Office\\Recent  <li>M\u00e1ximo 149 ficheros y directorios </li> <p>Tipos: </p> <ul> <li>1- Fichero Target </li> <li>2- Directorio padre del fichero target </li> </ul> <p>Informaci\u00f3n: </p> <ul> <li>MAC Times del target File </li> <li>Informaci\u00f3n del volumen donde est\u00e1 el target file </li> <li>Directorio del target file </li> </ul> <p>Los archivos podr\u00edan haber sido borrados o eliminados, almacenados en un recurso compartido de red o USB, por lo que, aunque el archivo podr\u00eda ya no estar all\u00ed, seguir\u00e1 existiendo los archivos LNK asociados con el archivo original. Las fechas del sistema de archivos indican: </p> <ul> <li>Fecha de creaci\u00f3n-&gt; la primera vez que se abri\u00f3 </li> <li>Fecha de modificaci\u00f3n -&gt; La \u00faltima vez que se abri\u00f3. </li> </ul> <p> </p> <p>Nuevo funcionamiento de Recent Documents en Windows 10 </p> <ul> <li>Cuando un fichero es creado, tambi\u00e9n se crea su LNK en el RECENT (anteriormente solo cuando se abr\u00eda). Se mantiene las fechas del sistema de archivo. </li> <li>Cuando una carpeta es creada en un directorio, la carpeta, la carpeta padre y la carpeta abuelo son creados como LNK en el RECENT. </li> <li>El mayor cambio es que ahora en los ficheros LNK se incluye la extensi\u00f3n y antes no. </li> </ul> <p>Nuevos tipos de LNK con URLs en Windows 8/10 </p> <p> </p> <p>\u00bfC\u00f3mo se gener\u00f3 este tipo de LNK? </p> <ol> <li>Run Dialog </li> <li>Windows Search Charm </li> <li>A trav\u00e9s de un fichero LNK </li> <li>A trav\u00e9s de un link de una aplicaci\u00f3n </li> </ol> <p>Herramienta para analizar ficheros LNK: LINKPARSER </p> <p> </p> <p>Campos: </p> <ul> <li>Link: son las fechas del destino UTC, es decir, las fechas del sistema de archivos del fichero en s\u00ed. </li> <li>File: son las fechas propias del LNK del UTC </li> <li>El hash MD5 es el del propio LNK, nunca del fichero en s\u00ed. </li> <li>MAC Address del equipo donde est\u00e1 el fichero original. </li> <li>Volume Label: Etiqueta del volumen </li> <li>DriveType: tipo de medio -&gt; muy \u00fatil para dispositivos USB </li> </ul> <p>** Ver Video:10-LinkParser </p> <p>LeCMD: otra herramienta para analizar LNK </p> <p> </p> <p>** Ver Video: 11-LECMD </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#jumplists","title":"Jumplists","text":"<p>Los usuarios pueden \u201csaltar\u201d a los archivos recientemente abiertos. Para las investigaciones forenses proporciona otra ubicaci\u00f3n donde verificar la creaci\u00f3n de ficheros no ejecutables. </p> <p>Esto debe coincidir con el registro de RecentDocs, Recent Docs *ext, Office Recent Docs y los ficheros LNK en el Recent Folder. </p> <p> </p> <p>Hay dos tipos de Jumplists: </p> <ul> <li>autom\u00e1ticos que son creados por cada aplicaci\u00f3n de Windows </li> <li>custom que son creados con el desarrollo espec\u00edfico de la aplicaci\u00f3n. </li> </ul> <p>Los dos se pueden encontrar en el Recent Folder. </p> <p>Dentro de cada fichero JUMPLIST puede haber fechas propias: creaci\u00f3n de la entrada, modificaci\u00f3n de la entrada y \u00faltimo acceso a la entrada. En la imagen superior, para el fichero documento_prueba.docx podr\u00eda tener estas fechas. </p> <p>Automatic destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDes tinations. <p>Contiene una lista de aplicaciones ordenadas por AppID. Los nombres est\u00e1n en el formato XXXXXXXX.autmaticDestinations-ms </p> <ul> <li>Creation Time: Primera fecha de ejecuci\u00f3n (a nivel el sistema de archivos) </li> <li>Modificaci\u00f3n time: \u00faltima fecha de ejecuci\u00f3n de la aplicaci\u00f3n (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>La informaci\u00f3n almacenada en el directorio de Automatic Destinations tiene que tener un \u00fanico archivo con el AppID. </p> <p>Custom Destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\CustomDestin ation <p>Son creados por cada aplicaci\u00f3n y por lo tanto \u201ccustom\u201d </p> <p>Un Jumplist customizado est\u00e1 destinado a presentar el contenido que la aplicaci\u00f3n ha establecido como importante basado en el uso previo o a trav\u00e9s de una acci\u00f3n que ha sido indicada por el usuario como importante, tal como a\u00f1adir el \u00edtem a favoritos o anclar la aplicaci\u00f3n a la barra de inicio. Tambi\u00e9n tienen una APPID. </p> <ul> <li>Creation Time (a nivel el sistema de archivos): primera vez de ejecuci\u00f3n. </li> <li>Modificaci\u00f3n time: \u00faltima vez que la aplicaci\u00f3n fue a\u00f1adida al fichero en concreto (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>Los Jumplist evidencian que una aplicaci\u00f3n espec\u00edfica existi\u00f3 y se ejecut\u00f3. </p> <p>Cada Jumplist, sea autom\u00e1tico o custom, tiene su AppID. Este tipo de identificador est\u00e1 asociado a un programa en concreto como vemos en la imagen siguiente: </p> <p> </p> <p>https://www.forensicswiki.org/wiki/Jump_Lists </p> <p>Herramienta para analizar Jumplist: JumpList Explorer </p> <p> </p> <p>** Ver Video: 12-JumplistExplorer </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#shellbags","title":"Shellbags","text":"<p>Los sistemas Windows almacenan las opciones de visualizaci\u00f3n de Windows Explorer mediante entradas de registro y son conocidas como ShellBags. </p> <ul> <li>Esto nos permite saber qu\u00e9 directorio han sido accedidos a nivel local, de red o dispositivos extra\u00edbles. </li> <li>Evidencia la existencia de directorios previos. </li> <li>Localizaci\u00f3n de las Shellbags: </li> </ul> <p>Explorer Access: </p> <ul> <li>USRCLASS.DAT\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\Bags </li> <li>USRCLASS.DAT\\LocalSettings\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> </ul> <p>Desktop Access: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\Bags </li> </ul> <p>Los documentos de Microsoft tienen Shellbags adicionales y est\u00e1n presentes en los sistemas Win7-Win10 </p> <p>La existencia de dicha entrada en el registro prueba que usuario especific\u00f3 visit\u00f3 al menos una vez ese directorio. </p> <p>Para analizar los shellbags, vamos a utilizar Shelbag Explorer: </p> <p> </p> <p>Respecto a los timestamps: </p> <ul> <li>En azul corresponde con los MAC times del sistema de archivos de la carpeta PPT </li> <li>En rojo es la informaci\u00f3n propia de shellbag, donde indica la \u00faltima interacci\u00f3n con la carpeta PPT y cu\u00e1l fue la primera. </li> <li>Tambi\u00e9n indica el sistema de archivos sobre el que estaba la carpeta. </li> </ul> <p>** Ver Video:13-ShellbagExplorer </p> <p>Hasta ahora hemos dicho: </p> <ul> <li>Evidenciar que se ha ejecutado mediante el an\u00e1lisis del UserAssist </li> <li>Evidenciar que se ha \u201ctocado\u201d realizando un timeline del sistema de archivos o del registro. </li> <li>Evidenciar que directorios has abierto mediante el an\u00e1lisis de Shellbags. </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#dispositivos-usb","title":"Dispositivos USB","text":"<p>Los dispositivos de almacenamiento USB son muchas veces objetos de investigaci\u00f3n, debido a que son utilizados para copiar ficheros/carpetas. \u00bfQu\u00e9 informaci\u00f3n podemos obtener siempre de un dispositivo USB? </p> <ul> <li>Vendor/Make/Versi\u00f3n </li> <li>N\u00famero de serie \u00fanico </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener relacionada con un dispositivo de almacenamiento USB? </p> <ul> <li>Determinar la unidad asignada y el nombre del volumen </li> <li>Encontrar el usuario que utiliz\u00f3 ese dispositivo USB </li> <li>Descubrir la primera vez que el dispositivo USB fue conectado </li> <li>Determinar la \u00faltima vez que el dispositivo USB fue conectado </li> <li>Determinar cuando el dispositivo fue quitado del sistema </li> </ul> <p>\u00bfCu\u00e1les son los artefactos forenses que podemos utilizar para identificar la copia de un fichero a un dispositivo de almacenamiento USB? </p> <ol> <li>Windows Registry Hives: </li> <li>System </li> <li>Software </li> <li>Ntuser.dat </li> <li>Setupapi.dev.log </li> <li>Shell Items </li> <li>Jumplists </li> <li>LNK Files </li> <li>ShellBags </li> </ol>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#mass-storage-device","title":"Mass Storage Device","text":"<p>Tambi\u00e9n conocidos como dispositivos de almacenamiento (USB Mass Storage). En Windows son montados autom\u00e1ticamente siempre que el sistema de archivos sea compatible con Windows. </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#picture-transfer-protocol","title":"Picture Transfer Protocol","text":"<p>Desarrollado por el International Imaging Industry Association. Un dispositivo PTP en </p> <p>Windows: </p> <ul> <li>No tiene acceso al sistema de archivos </li> <li>Solo tiene acceso a im\u00e1genes y archivos de video </li> <li>Dispone Exploraci\u00f3n limitada y l\u00f3gica del contenido </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#media-transfer-protocol","title":"Media Transfer Protocol","text":"<p>\u00bfQu\u00e9 caracter\u00edsticas tiene el MTP? </p> <ul> <li>Mejora y extensi\u00f3n del PTP. </li> <li>No tiene acceso al sistema de archivos. </li> <li>Acceso a la tarjeta interna y SD. </li> <li>Dentro de Windows es montado como un dispositivo portable </li> </ul> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#identificar-evidencias-de-uso-dispositivos-usb","title":"Identificar evidencias de uso dispositivos USB","text":"<p>MSC USB </p> <p>Creaci\u00f3n de ficheros LNK para todos los ficheros que hayan sido abiertos </p> <ul> <li>Windows Recent Folder </li> <li>Microsoft Office Recent Folder </li> <li>Jumplist: Automatic Destinations </li> </ul> <p>MTP USB </p> <p>Windows puede o no puede crear ficheros LNK. Depende de la aplicaci\u00f3n y del tipo de archivo. Algunos MTP LNK no apuntan a la fuente MTP pero apunta al WPDNSE folder: C:\\users\\\\Appdata\\Local\\Temp\\WPDNSE{GUID} <p> </p> <p>Los ficheros DOC no apuntan a la fuente original sino a un directorio temporal. Solo ocurre con los documentos office. </p> <ul> <li>Los ficheros JPG si dejan un LNK verdadero a la fuente original. </li> <li>Los ficheros PDF, TXT y XLS no producen ning\u00fan fichero LNK. </li> </ul> <p>\u00bfQu\u00e9 contiene el directorio temporal WPDNSE? </p> <ul> <li>Mantiene una copia del fichero </li> <li>El directorio es temporal y no sobrevive a un reinicio </li> <li>El GUID se saca de una Shellbag</li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#usbstor","title":"USBStor","text":"<p>El registro USBstor, se encarga de monitorizar cualquier dispositivo USB que haya sido conectado a la m\u00e1quina: </p> <p>Ruta: SYSTEM\\ControlSet001\\Enum\\USBSTOR </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Se puede identificar al fabricante, el producto y la versi\u00f3n de un dispositivo MSC que est\u00e1 conectado a la m\u00e1quina. </li> <li>Identificar un \u00fanico dispositivo USB que ha sido conectado a la m\u00e1quina. </li> <li>Determinar el tiempo por el cual el dispositivo estaba conectado a la m\u00e1quina </li> <li>Identificar el n\u00famero de serie f\u00edsico del dispositivo USB. </li> </ul> <p> </p> <p>En rojo el n\u00famero de serie del dispositivo. En azul el Device Class ID. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#identificacion-de-vidpid","title":"Identificaci\u00f3n de VID/PID","text":"<p>Para localizar estos valores debemos de recurrir a SYSTEM\\ ControlSet001\\Enum\\USB: </p> <ul> <li>VID: Vendor ID </li> <li>PID: Product ID </li> </ul> <p> </p> <p>VID:0930 y PID:6544 </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#obtener-el-nombre-del-volumen","title":"Obtener el nombre del volumen","text":"<p>Ruta: SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices Aplica para MSC, </p> <p>MTP y PTP. </p> <ul> <li>Se relaciona el dispositivo USB F\u00edsico, que dispone de un n\u00famero de serie con un nombre de Volumen. </li> <li>El nombre del volumen puede ser mapeado a una unidad mediante los ficheros LNK </li> </ul> <p> </p> <p> </p> <p>Para las capturas de imagen anteriores, el nombre del volumen es DATA. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#obtener-la-ultima-unidad-asignada","title":"Obtener la \u00faltima unidad asignada","text":"<p>Solo MSC que sean discos de almacenamiento externos aplica la siguiente casu\u00edstica para la ruta del registro: System\\MoutedDevices. </p> <p>Los dispositivos particionados con MBR dejan una firma de 4 bytes, en el registro, la clave MoutedDevices. Para el particionado en GPT deja el GUID del tipo de partici\u00f3n. 89 </p> <p>La firma del MBR se encuentra el primer sector en el offset 0X1B8 o 440 del disco </p> <p> </p> <p> </p> <p>Tambi\u00e9n podemos obtener la \u00faltima unidad asignada analizando la clave de registro System\\MoutedDevices: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#localizar-el-usuario-que-ha-utilizado-el-usb","title":"Localizar el usuario que ha utilizado el USB","text":"<ol> <li>El primer paso es localizar el GUID del Volumen en SYSTEM\\mountedDevices. Localizando el n\u00famero de serie dentro del mismo. </li> </ol> <p>\\??\\Volume{2e1ce865-c747-11e8-add4-34238779763e} </p> <ol> <li>Y luego este GUID asociarlo al NTUSER.DAT del usuario: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Mountpoin </li> </ol> <p>ts2 </p> <p> </p> <p>Ha sido encontrado dentro del NTUSER.DAT del usuario ismis. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#volume-serial-number","title":"Volume Serial Number","text":"<p>El volumen serial number, es el n\u00famero de serie del volumen l\u00f3gico del sistema de archivos: </p> <ul> <li>No confundir con el n\u00famero de serie f\u00edsico del dispositivo. </li> <li>Solo dispositivos MSC </li> </ul> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion\\EMDMgmt </p> <p> </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <p>Sabiendo el nombre del volumen y el serial number del volumen pueden correlacionar la informaci\u00f3n con los ficheros LNK y la clave de registro RecentDocs </p> <p>Este artefacto depender\u00e1 de si el servicio ReadyBoost est\u00e1 habilitado o no. \u00bfQu\u00e9 informaci\u00f3n hay en EMDMgmt Key? </p> <ul> <li>Fabricante, ID y Serial number </li> <li>Volume Name del sistema de archivos, muy \u00fatil para relacionar con los LNK. </li> </ul> <p>\u00bfQu\u00e9 pasar\u00eda si el dispositivo USB es reformateado? Un formateo solo escribe los datos necesarios para tener de nuevo un sistema de archivos \u201climpio\u201d. No realiza ning\u00fan borrado. </p> <ul> <li>Tendr\u00edamos un nombre de volumen nuevo </li> <li>Tendr\u00edamos un nuevo volumen serial number </li> <li>Pero se mantiene el serial number f\u00edsico del dispositivo. </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#timestamps","title":"Timestamps","text":"<p>Primera y \u00faltima vez que se conect\u00f3 al dispositivo Ruta: </p> <p>*System\\ControlSet001\\Enum\\USBSTOR{VEN_PROD_VERSION}{USB serial}\\Properties{83da6326-97\u00aa6-4088-9453-a1923f573b29}* </p> <ul> <li>Win7 y Win8 -&gt; Primera conexi\u00f3n -&gt; 0064 </li> <li>Win8 en adelante -&gt; Ultima conexi\u00f3n -&gt; 0066 </li> <li>Win8 en adelante -&gt; Fecha de desconexi\u00f3n con independencia de si es quitado con seguridad o sin ella. -&gt; 0067 </li> </ul> <p> </p> <p>Timestamps 64 bits Hex Windows Time Little Endian pero Registry Explorer los interpreta: </p> <ul> <li>0064: 10/3/2018 8:06:48 PM +00:00 </li> <li>0066: 10/3/2018 8:24:46 PM +00:00 </li> <li>0067: 10/3/2015 9:17:12 PM +00:00 </li> </ul> <p>Tambi\u00e9n podemos analizar el fichero SetupApi.dev.log para obtener timestamps de cuando se produjo la conexi\u00f3n USB: </p> <p>Ruta: </p> <ul> <li>XP -&gt; C:\\Windows\\setupapi.log </li> <li>Win7-Win10 -&gt; C:\\Windows\\inf\\setupapi.dev.log </li> </ul> <p>Los timestamps est\u00e1n local time. </p> <p> </p> <p>Tambi\u00e9n podemos utilizar los eventos del sistema para localizar los timestamps, a partir de Windows 7 / 8 / 10. Lo veremos m\u00e1s adelante. </p> <p>Herramientas para realizar todos estos pasos de manera autom\u00e1tica: USB Detective </p> <p> </p> <p>** Ver Video:14-USB Detective </p> <p>Los datos concuerdan con lo que hemos analizado anteriormente. Incluso el VSN o volumen serial number no ha sido capaz de encontrarlo como nosotros.</p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#email-forensics","title":"Email Forensics","text":"<p>\u00bfQu\u00e9 informaci\u00f3n podemos encontrar analizando un email? </p> <ul> <li>\u00bfQui\u00e9n envi\u00f3 el email? -&gt; direcci\u00f3n de correo, direcci\u00f3n IP, pruebas de contexto </li> <li>\u00bfCu\u00e1ndo fue enviado? -&gt; Timestamp en la cabecera, timestamp de los servidores </li> <li>\u00bfDesde donde fue enviado? Direcci\u00f3n IP / ISP, Geolocalizaci\u00f3n, Mail server domain, Message ID </li> <li>\u00bfEs el contenido relevante?. Message Body, Adjuntos, libreta de direcciones, Entradas de calendario</li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#cabecera-de-correo-electronico","title":"Cabecera de correo electr\u00f3nico","text":"<p>Podemos encontrar en la cabecera la fecha de cuando se envi\u00f3 el correo electr\u00f3nico, el message ID, el destinatario, el remitente. </p> <p>---&gt; Header  </p> <p>---&gt; Cuerpo </p> <p>---&gt; Adjunto </p> <p>Tambi\u00e9n podemos saber cu\u00e1ndo fue recibido el correo electr\u00f3nico por el servidor SMTP mediante el campo: \u201cReceived\u201d </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#message-id","title":"Message ID","text":"<p>El message ID lo proporciona el servidor que env\u00eda el email y consiste en un \u00fanico identificador a\u00f1adido al nombre del servidor con la @. </p> <p>Este campo puede ser utilizado para identificar mensajes relacionados gracias al tag References y In-Reply-To: </p> <p> </p> <p> </p> <p> </p> <p>En la conversaci\u00f3n anterior, se puede ver el hist\u00f3rico de Message ID que hay. Esto indica que debe haber tambi\u00e9n cuatro mensajes. Uno por cada Message ID. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#mapi-headers","title":"Mapi Headers","text":"<p>Si est\u00e1s realizando una investigaci\u00f3n donde hay un servidor Exchange o clientes tales como Microsoft Outlook, debes ser consciente que las propiedades MAPI (Microsoft Messaging Application Programing Interface) estar\u00e1n presentes. Son unas cabeceras adicionales que nos van a permitir extraer m\u00e1s informaci\u00f3n de un simple correo electr\u00f3nico: </p> <ul> <li>Mapi-Client-Submit-Time: la fecha del sistema local cuando el email fue enviado por el cliente. </li> <li>Mapi-Conversation-Index: indica cu\u00e1ntos mensajes hijos fueron parte de la cadena de emails y registra los timestamps para cada mensaje en la cadena. </li> <li>Mapi-Entry-ID: un identificador de mensaje dentro del almacenamiento como PST. Puede ayudar a identificar si un usuario dispon\u00eda de varios ficheros PSTs. </li> <li>Mapi-Message-Flags y Pr_last_Verb_Executed: proporciona informaci\u00f3n detallada de las acciones que ocurrieron en un Cliente MAPI: Le\u00eddo, sin leer, respondidos, reenviados, fuera de la oficina </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#outlook-pst","title":"Outlook PST","text":"<p>El cliente de correo por excelencia de sistemas Windows, es Microsoft Outlook. Todos los mensajes enviados, recibidos, contactos y calendario se almacenan en un fichero PST. </p> <p>Fichero almacenado por defecto: </p> <ul> <li>%USERPROFILE%\\LocalSettings\\ApplicationData\\Microsoft\\Outlook (WinXP y anteriores) </li> <li>%USERPROFILE%\\AppData\\Local\\Microsoft\\Outlook -&gt; Win7 / Win8 y en adelante </li> </ul> <p>La clave de registro nos puede indicar qu\u00e9 archivos est\u00e1n siendo utilizados. </p> <ul> <li>HKEY_CURRENT_USER\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Windo ws Messagin Subsystem\\Profiles\\Outlook </li> <li>El Archivo tiene un tama\u00f1o m\u00e1ximo de 50 GB </li> </ul> <p>Si no lo encontr\u00e1semos, deber\u00edamos buscar por extensi\u00f3n o realizar t\u00e9cnica de recuperaci\u00f3n de datos, ya que el fichero PST dispone de cabecera conocida. Se podr\u00eda realizar mediante Photorec. </p> <p>Herramienta para ver ficheros PST: Kernel PST Viewer </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#outlook-ost","title":"Outlook OST","text":"<p>Microsoft Outlook genera un fichero OST cuando la cuenta ha sido configurada mediante IMAP o mediante Exchage. Al igual que en PST, almacena mensajes enviados, recibidos, contactos, calendario. El buz\u00f3n local (fichero OST) de mensajes est\u00e1 sincronizado con el servidor. </p> <ul> <li>\u00daltimos 12 meses de email por defecto </li> <li>Fichero m\u00e1ximo de 50gb </li> <li>La ruta es la misma que el fichero PST </li> <li>Se puede realizar t\u00e9cnicas de carving para recuperarlo </li> </ul> <p>Herramienta: Kernel OST Viewer </p> <p> </p> <p>** Ver video: 15 - Kernel OST Viewer </p> <p>Hay que tener en cuenta que se puede recuperar un fichero OST/PST del sistema de archivos porque se haya borrado, o recuperar emails borrados de dentro del fichero OST/PST. En el caso de ficheros OST, existe una herramienta de pago: https://www.kerneldatarecovery.com/ost-recovery.html </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-adjuntos","title":"Recuperaci\u00f3n de Adjuntos","text":"<p>Microsoft Outlook utiliza un Directorio temporal seguro para abrir los adjuntos de los mensajes de correo electr\u00f3nico: </p> <ul> <li>%APPDATA%\\Local\\Microsoft\\Windows\\TemporaryInternetFiles\\Content.Outlook -&gt; IE10 </li> <li>%APPDATA%\\Local\\Microsoft\\InetCache\\Content.Outlook -&gt; IE11+ </li> </ul> <p>Antes de la versi\u00f3n de Outlook 2007, los mensajes quedan guardados siempre. </p> <p>Despu\u00e9s de la versi\u00f3n de Outlook 2007 en adelante, los adjuntos est\u00e1n, mientras que el correo electr\u00f3nico est\u00e9 abierto o quedar\u00eda en esa carpeta si Outlook es cerrado correctamente. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#thunderbird-mbox","title":"Thunderbird MBOX","text":"<p>El cliente de correo Thunderbird almacena la informaci\u00f3n en ficheros MBOX. Estos ficheros pueden ser encontrados en la siguiente ruta: </p> <p>\\Users\\%USERNAME%\\AppData\\Roaming\\Thunderbird\\Profiles </p> <p>Para poder leer este fichero MBOX sin la necesidad de Thunderbird podemos recurrir a Autopsy. Creamos un nuevo caso como hemos visto anteriormente, pero esta vez, en vez de a\u00f1adir una imagen forense vamos a\u00f1adir un fichero, en este caso el fichero MBOX. </p> <p> </p> <p>Despu\u00e9s seleccionamos el \u201cEmail Parser\u201d para que pueda extraer los emails contenidos en el fichero MBOX </p> <p> </p> <p>Este M\u00f3dulo, es capaz tambi\u00e9n de leer ficheros PST y OST. Una vez que haya terminado de analizar el fichero MBOX podremos acceder a los correos en la siguiente secci\u00f3n: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#thumbnails","title":"Thumbnails","text":"<p>Cuando un usuario previsualiza una carpeta de tal manera que la organiza mediante thumbnails, se crea un fichero oculto \u201cthumbs.db\u201d que almacena la preview de im\u00e1genes en hay en la carpeta, incluso si las im\u00e1genes fueron borradas. </p> <p>Thumbs.db </p> <ul> <li>WinXP/Win8-8,1 -&gt; Creado autom\u00e1ticamente </li> <li>*Win7/Win10 -&gt; Autom\u00e1tica creado si es accedido v\u00eda UNC Path -&gt; \\ruta\\ruta* </li> </ul> <p>\u00bfQu\u00e9 hay en el Thumbs.db? </p> <ul> <li>Imagen peque\u00f1a de la imagen original incluso si es borrada </li> <li>\u00daltima fecha de modificaci\u00f3n -&gt; Windows XP </li> <li>Nombre original -&gt; Windows XP </li> </ul> <p>Herramienta que analiza el fichero Thumbs.db: Thumbsviewer </p> <p> </p> <p>thumbsviewer.github.io </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#thumbcache","title":"Thumbcache","text":"<p>El Thumcache, es la evoluci\u00f3n del thums.db. Su funcionamiento es el mismo. </p> <p> </p> <p>Ruta: C:\\Users\\\\AppData\\Local\\Microsoft\\Windows\\Explorer <ul> <li>Solo Thumbnails </li> <li>Localizaci\u00f3n de donde estuvo ese thumbnail </li> <li>Solo para Windows 7 / 8 / 10 </li> </ul> <p>En la carpeta anterior, se encuentran los preview de las im\u00e1genes en funci\u00f3n del tama\u00f1o. De esta manera se adapta a los requisitos del usuario. </p> <ul> <li>Thumbcache_32.db -&gt; small </li> <li>Thumbcache_96.db -&gt; medium </li> <li>Thumbcache_256.db -&gt; large </li> <li>Thumbcache_1024.db -&gt; extra large </li> </ul> <p>Herramienta ThumbCache Viewer</p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#papelera-de-reciclaje","title":"Papelera de Reciclaje","text":"<p>Carpeta oculta del sistema que contiene un subdirectorio con el SID del usuario. EL SID del usuario lo podemos obtener el fichero SAM. </p> <p>RECYCLER -&gt; 2000/NT/XP/2003 </p> <ul> <li>Archivo oculto llamado INFO2 </li> <li>Contiene la fecha de borrado y el nombre del archivo original </li> </ul> <p>$Recycle.bin -&gt; Vista/Win7/Win8/Win10 </p> <ul> <li>El archivo es ASCII y UNICODE </li> <li>La fecha del borrado y el nombre del fichero original borrado est\u00e1n en ficheros distintos </li> <li>$I -&gt; Informaci\u00f3n del fichero (fecha de borrado) </li> <li>$R -&gt; el contenido del fichero </li> </ul> <p>Solo los ficheros que son borrados desde el Explorer de Windows, van a esta localizacion. No es un borrado como tal, ya que los ficheros se encuentran disponibles. </p> <p>Si el usuario realiza SHIFT + borrado el fichero no pasa por la papelera de reciclaje. </p> <p>A nivel del sistema de archivos, el fichero original es movido a la papelera de reciclaje y renombrado con $R{nombre} y se crea un fichero con $I{nombre} que contiene la fecha del \u201cborrado\u201d. El borrado real, se proceder\u00e1 de verdad cuando la papelera se haya vaciado. </p> <p>Herramienta para procesar la papelera: Rifiuti. </p> <p> </p> <p>Dos versiones de la herramienta en funci\u00f3n del sistema operativo: </p> <p> </p> <p>** Ver Video:16-Rifitui </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#ejecucion-de-programas","title":"Ejecuci\u00f3n de programas","text":"<p>En esta secci\u00f3n vamos a ver todos los artefactos forenses que indiquen la ejecuci\u00f3n de un programa. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#windows-prefetch","title":"Windows Prefetch","text":"<p>La misi\u00f3n de Windows Prefetch es incrementar el rendimiento del sistema con una precarga del ejecutable. El cache manager monitoriza todos los ficheros y directorios y los mapea contra el fichero .pf (el fichero .pf ser\u00e1 el artefacto forense que analizaremos) </p> <ul> <li>Deshabilitado en sistemas con disco SSD </li> <li>Muestra c\u00f3mo y cu\u00e1ndo un binario se ejecut\u00f3 </li> </ul> <p>Ruta: C:\\Windows\\Prefetch </p> <ul> <li>Limitado a 128 ficheros en XP/VISTA/WIN7 </li> <li>Limitado a 1024 ficheros en Win8/Win10 </li> <li>{Nombre_ejecutable}-{hash}.pf </li> <li>Windows 10 los prefetch vienen comprimidos </li> <li>El hash est\u00e1 basado en el path del ejectuable y los argumentos que reciben </li> </ul> <p>Ruta: C:\\Windows\\Prefetch\\Layout.ini </p> <ul> <li>El fichero layout.ini contiene los nombres de los directorios de los ficheros que est\u00e1n en el Prefetch </li> <li>El desfragmentador de disco utiliza el layout.ini para realojar todos los directorios y ficheros en un \u00e1rea contigua del disco. </li> </ul> <p>\u00bfQu\u00e9 indica este artefacto forense? </p> <ul> <li>N\u00famero de ejecuciones (hasta 8 veces puede registrar) </li> <li>Fechas de las ejecuciones (UTC) </li> <li>El propio fichero, ya indica la ejecuci\u00f3n del programa </li> <li>Ficheros abiertos por el programa </li> </ul> <p>Herramienta para analizar los Prefetch: PeCMD </p> <p> </p> <p>Resultado de ejecutar PeCMD </p> <p> </p> <p>** Ver V\u00eddeo Prefetch - 011 </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#superfetch","title":"SuperFetch","text":"<p>Superfetch consiste en una serie de bases de datos localizados en la carpeta C:\\Windows\\Prefetch\\Ag*.db, que tienen como misi\u00f3n optimizar el uso de memoria. No reemplaza al servicio Prefetch </p> <p> </p> <p>\u00bfQu\u00e9 podemos obtener? </p> <ul> <li>Nombre de la aplicaci\u00f3n </li> <li>N\u00famero de ejecuciones </li> <li>Ficheros necesarios que son utilizados por el binario. </li> <li>Volumen accedido </li> <li>Path completo </li> <li>TimeFrames </li> <li>Timestamp </li> </ul> <p>Herramienta para analizar el Superfetch: CrowdResponse </p> <p> </p> <p>https://www.crowdstrike.com/resources/community-tools/crowdresponse/ </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#srum","title":"SRUM","text":"<p>System Resource Usage Monitor (SRUM) es un artefacto forense que est\u00e1 destinado a monitorizar los recursos que consume un proceso. </p> <p>Ruta: C:\\Windows\\System32\\sru\\SRUDB.dat </p> <ul> <li>A partir de Windows 8 </li> <li>Es una Base de datos en formato ESE </li> </ul> <p>Se ha llegado a identificar hasta 60 d\u00edas de monitorizaci\u00f3n y nos puede indicar: </p> <ul> <li>AppID y Path  </li> <li>Usuario que ejecuta </li> <li>Bytes enviados </li> <li>Bytes recibidos </li> <li>Interfaz de red </li> <li>Tiempo de conexi\u00f3n </li> <li>Tiempo de duraci\u00f3n </li> </ul> <p>El Prefetch indica el arranque de un proceso, pero no la duraci\u00f3n: </p> <p> </p> <p>Ejemplo del proceso: Explorer.exe </p> <p>La actividad es actualizada cada 60 min en la base de datos o durante un apagado correcto </p> <p> </p> <p>Si realizamos un apagado incorrecto hay que reparar la base de datos ESE mediante el comando: esentul /mh SRUDB.dat </p> <p>Herramienta que nos permite analizar el fichero SRUDB.dat: SRUM DUMP </p> <p> </p> <p>** Ver Video:17-SRUM </p> <p>Lo resultados de ejecutar la herramienta SRUM DUMP, donde se identifica el proceso junto con su timestams y los bytes que ha enviado y recibido: </p> <p> </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#appcompatcache-shimcache","title":"AppCompatCache (ShimCache)","text":"<p>Se encarga de chequear la compatibilidad de la aplicaci\u00f3n dentro del sistema operativo. Verifica si la aplicaci\u00f3n necesita aplicarse ciertas propiedades en el actual sistema operativo o funcionar viejos sistemas operativos. </p> <p>Appcompatcache monitorizar\u00e1 del ejecutable: </p> <ul> <li>Fecha de \u00faltima modificaci\u00f3n: $STANDARD_INFORMATION </li> <li>Path donde se encuentra </li> <li>Y si fue ejecutado </li> </ul> <p>Si la aplicaci\u00f3n sufre una modificaci\u00f3n o actualizaci\u00f3n, ser\u00e1 nuevamente actualizada Ruta: </p> <ul> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\Appcompatibility\\Appco mpat Cache -&gt; XP -&gt; 96 entradas </li> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\AppcompatCache\\AppCo mp atCache -&gt; Server 2003 (512 entradas) y 2008/2012/2016 \u2013 Win7/Win8/Win10 (1024 entradas) </li> </ul> <p>Cuando se modifican las propiedades de una aplicaci\u00f3n, se crean entradas en el registro. Todo programa (.exe, .bat,.dll) es chequeado con la base de datos para buscar una compatibilidad. Este es el artefacto forense que encontramos.</p> <p>Solo se actualiza cuando el sistema es apagado y no antes. </p> <ul> <li>Eventos m\u00e1s recientes est\u00e1n al principio </li> <li>Nuevos eventos se escriben al ser apagado. </li> </ul> <p>\u00bfQu\u00e9 podemos evidenciar? </p> <p> </p> <p>Herramienta que permite analizar el AppCompatCache: AppCompatCache (ShimCache) Parser </p> <p> </p> <p>** Ver video:18- Shimcache </p> <p>Resultado de ejecutar AppCompatCache y llevarlo a TimelineExplorer: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#amcachehve","title":"Amcache.hve","text":"<p>Artfacto forense, que es un registro en s\u00ed mismo con la siguiente ruta: C:\\Windows\\AppCompat\\Programas\\Amcache.hve (Windows 7/8/8.1/10 y 2012/2016) </p> <ul> <li>Keys: Amcache.hve\\Root\\File{Volume GUID}###### -&gt; Para el Formato Antiguo </li> <li>Hay una entrada por cada ejecuci\u00f3n, informaci\u00f3n del directorio, fecha \u00faltima modificaci\u00f3n $StandarInfo y el volumen desde el que ejecut\u00f3 (GUID de volumen) </li> <li>La primera vez que se ejecut\u00f3: \u00faltima modificaci\u00f3n de la clave de registro </li> <li>El SHA1 del ejecutable tambi\u00e9n est\u00e1 en el registro </li> </ul> <p>Lo analizamos con la Herramienta AmcacheParser: </p> <p> </p> <p>** Ver Video: 19-Amcache </p> <p>Resultado de la ejecuci\u00f3n AmCacheParser: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recentfilecache","title":"RecentFileCache","text":"<p>Este artefacto solo se encuentra en Windows 7 y en la siguiente ruta: C:\\Windows\\AppCompat\\Programs\\RecentFileCache.bcf </p> <p>Contiene la ejecuci\u00f3n de binarios m\u00e1s reciente en el sistema Windows 7. Para ver de manera m\u00e1s detallada c\u00f3mo se crea este artefacto forense: </p> <p>http://journeyintoir.blogspot.com/2013/12/revealing-recentfilecachebcf-file.html Para analizar este artefacto utilizaremos la herramienta RecentFileCacheParser: </p> <p> </p> <p>Como siempre, deberemos extraer previamente el artefacto forense mediante Access Data FTK de la ruta anteriormente indicada para que esta herramienta sea capaz de interpretar y analizar. Abrimos un CMD para ejecutar la herramienta e indicarle donde se encuentra el artefacto extra\u00eddo: </p> <p> </p> <p>Finalmente abrimos el fichero CSV generado. Hay que tener cuidado que la extensi\u00f3n es un TSV, es decir un fichero generado por tabulaciones. </p> <p> </p> <p>Lo abrimos con OpenOffice, cambi\u00e1ndole la extensi\u00f3n a \u201cCSV\u201d. </p> <p> </p> <p>Finalmente disponemos una tabla con la ejecuci\u00f3n de los binarios.</p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#tareas-programadas","title":"Tareas Programadas","text":"<p>Un malware o backdoor puede utilizar las tareas programadas como mecanismo de </p> <p>persistencia </p> <p>Ruta: C:\\Windows\\Tasks o C:\\Windows\\System32\\Tasks </p> <p> </p> <p>Podemos extraerlas con Arsenal Image Mounter las tareas para analizarlas. Aunque no tengan extensi\u00f3n, una vez extra\u00eddas se puede abrir con el Notepad y verlas como un fichero XML: </p> <p> </p> <p>La fecha de cuando se a\u00f1adi\u00f3, la podemos sacar de las propiedades del sistemas de archivos, gracias a FTK Imager: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#servicios","title":"Servicios","text":"<p>Los servicios del sistema operativo, los podemos encontrar en la siguiente clave de registro: Ruta: SYSTEM\\ControlSet001\\Services </p> <p>Lo analizamos con Registry Explorer </p> <p> </p> <p>Campos por destacar: </p> <ul> <li>Display Name: nombre del servicio </li> <li>Start mode: el tipo de arranque </li> <li>Image Path: ejecutable con los argumentos que recibe </li> <li>Name Key Last Write: \u00faltima vez que se actualizo la clave del registro </li> <li>Parameters Key Last Write: \u00faltima vez que se cambiaron los par\u00e1metros </li> </ul>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-de-windows","title":"Eventos de Windows","text":"<p>El registro de eventos de Windows proporciona una gran cantidad de informaci\u00f3n la cual puede ayudar a un investigador a juntar las piezas relevantes sobre las acciones ocurridas en el sistema. </p> <p>Los eventos son recolectados y almacenados por el Servicio de Registro de Eventos. De manera similar a otros artefactos forenses, es provechoso realizar el ejercicio mental de determinar cu\u00e1les preguntas pueden responder los datos del registro de eventos. </p> <p> </p> <p>\u00bfQu\u00e9 podemos obtener de los eventos de Windows? </p> <ol> <li>\u00bfQu\u00e9 ocurri\u00f3? (Identificador del Evento, Categor\u00edas del Evento, Descripci\u00f3n) </li> </ol> <p>Los registros de eventos pueden ser complicados para un usuario normal, pero est\u00e1n dise\u00f1ados para proporcionar informaci\u00f3n muy espec\u00edfica sobre las actividades ocurridas en el sistema. </p> <ol> <li>\u00bfCu\u00e1l fue el d\u00eda y la hora? (Marcas de Tiempo) </li> </ol> <p>Las marcas de tiempo son una parte clave de los registros de eventos, pues proporcionan un contexto temporal para los eventos. Con sistemas registrando miles de eventos, las marcas de tiempo pueden tambi\u00e9n ayudar al investigador a acercar su enfoque. </p> <ol> <li>\u00bfQui\u00e9nes son los usuarios involucrados? (Cuenta de Usuario, Descripci\u00f3n) </li> </ol> <p>Cualquier cosa hecha dentro de Windows es realizada dentro del contexto de una cuenta. Se puede identificar referencias hacia usuarios espec\u00edficos, como tambi\u00e9n a informaci\u00f3n sobre las actividades del sistema operativo Windows realizadas mediante una cuenta especial como System o NetworkService. </p> <ol> <li>\u00bfCu\u00e1les son los sistemas involucrados? (Nombre del Host, Direcci\u00f3n IP) </li> </ol> <p>En un entorno de red, es muy com\u00fan encontrar referencias hacia otros sistemas aparte del host, como recursos siendo accedidos remotamente. Originalmente s\u00f3lo el nombre Netbios era registrado, haciendo el rastreo y la atribuci\u00f3n mucho m\u00e1s dif\u00edcil. En sistemas m\u00e1s recientes, la direcci\u00f3n IP es registrada dentro del registro de eventos (Cuando aplica). </p> <ol> <li>\u00bfCu\u00e1les recursos se accedieron? (Archivos, Carpetas, Impresoras, Servicios) </li> </ol> <p>El Servicio de Registro de Eventos puede ser configurado para almacenar informaci\u00f3n muy granular relacionada a la utilizaci\u00f3n de varios objetos del sistema. Con casi todos los recursos considerados como un objeto, esto proporciona una muy poderosa auditor\u00eda. Como un ejemplo; puede ayudar a identificar intentos de acceso no autorizado hacia los archivos del sistema. </p> <p>Los eventos de Windows, centralizan el registro logs del sistema e informaci\u00f3n sobre: </p> <ul> <li>Software </li> <li>Hardware </li> <li>Funciones del sistema operativo </li> <li>Seguridad </li> </ul> <p>A nivel del sistema de archivos, los podemos encontrar en las siguientes rutas. </p> <p> </p> <p>Como podemos observar tenemos dos tipos de eventos: Event log en formato Binario (antes de Windows Vista) </p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extensi\u00f3n en (.evt) </li> </ul> <p>Event log en formato XML (de Windows Vista en adelante) </p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extension (.evtx) </li> <li>200 tipos de ficheros m\u00e1s que el formato antiguo </li> <li>Ahora incluyen direcciones IP </li> </ul> <p>Las localizaciones de los ficheros de eventos las podemos localizar en el registro SYSTEM en la siguiente ruta: </p> <p>HKLM\\SYSTEM\\CurrentControlSet\\Services\\EventLog{Application|System|Security} </p> <p> </p> <p>Existen tambi\u00e9n otros tipos de eventos que no son del sistema operativo Windows, como aplicaciones de terceros, Exchange, Sysmon, SQL Server. </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-de-seguridad","title":"Eventos de Seguridad","text":"<p>Los eventos de seguridad son solo actualizados por el proceso LSASS (Local Security Authority Subsystem Service). Se encuentran en C:\\Windows\\System32\\winevt\\Security.evtx </p> <p>Solo con permisos de administrador se pueden ver, exportar o eliminar. Tienen un tama\u00f1o m\u00e1ximo, pero es configurable como vemos a continuaci\u00f3n: </p> <p> </p> <p>Normalmente, el escenario es que veremos, es que, una vez alcanzado el tama\u00f1o asignado, se sobrescribir\u00e1 los eventos m\u00e1s viejos, es decir un fichero circular. </p> <p>\u00bfQu\u00e9 podemos identificar en los eventos de seguridad? </p> <ul> <li>Login logoff </li> <li>Conducta del usuario y acciones </li> <li>Acceso a Archivos, Directorios y recursos compartidos </li> <li>Modificaciones de la configuraci\u00f3n de seguridad </li> </ul> <p>Los eventos est\u00e1n identificados por ID, y en funci\u00f3n de ese identificador podremos identificar que ha ocurrido. En la siguiente web podemos encontrar una descripci\u00f3n exhaustiva de todos los identificadores: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-relacionados-con-la-autenticacion-del-usuario","title":"Eventos relacionados con la autenticaci\u00f3n del usuario","text":"<p>Eventos de relacionados con la autenticaci\u00f3n del usuario del sistema Windows: </p> EventID Descripci\u00f3n 4624 Evento de autenticaci\u00f3n satisfactorio 4625 Evento de fallido de autenticaci\u00f3n 4634/4647 Log off 4672 Logon con permisos de administrador Ejemplo de evento 4625 <p> </p> <p>Ejemplo de evento 4634 Log OFF </p> <p> </p> <p>Ejemplo de evento 4672 logon especial\u00e7 </p> <p> </p> <p>Dentro del Evento 4624/4625 encontramos los siguientes subtipos: </p> <ul> <li>2 -&gt; Interactive: este tipo de autenticaci\u00f3n involucra la utilizaci\u00f3n del teclado y pantalla del sistema, o la utilizaci\u00f3n de terceras herramientas remotas como VNC o PSexec -U- </li> <li>3 -&gt; Network: conexi\u00f3n a una carpeta compartida del propio equipo . </li> <li>4 -&gt; Batch: tambi\u00e9n v\u00e1lido para las tareas programadas, donde los procesos son ejecutados en nombre de otro. </li> <li>5 -&gt; Service: servicios arrancados por el Service Control Manager </li> <li>7 -&gt; Desbloqueo de pantalla con password </li> <li>8 -&gt; Network Cleartext: el usuario se ha autenticado en la m\u00e1quina desde la red pero sus credenciales no han sido hasheadas. Este tipo de evento suele provenir de la autenticaci\u00f3n realizada mediante Internet Information Services (IIS), servidor Web de Microsoft. </li> <li>9 -&gt; NewCredentials: es generado cuando se ejecuta un comando con RunAs desde la CMD o se conecta con una unidad de red, con credenciales distintas a las de la propia sesion. </li> <li>10 -&gt; Remote Interactive: este tipo de autenticaci\u00f3n se produce cuando una autenticaci\u00f3n se realiza mediante Terminales Services o Remote Desktop Protocol. </li> <li>11 -&gt; CachedInteractive: se autentica con las credenciales \u00faltimas cacheadas ya que no ha sido posible contactar con el controlador de dominio. </li> </ul> <p>Ejemplo de evento 4624 tipo 2: </p> <p> </p> <p>Dentro del evento 4625 se puede indicar el tipo de error al autenticarse mediante los estados y subestados: </p> <p> </p> <p>Ejemplo de evento 4625 con subestados: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-eventos-de-windows","title":"Recuperaci\u00f3n de eventos de Windows","text":"<p>Los eventos del sistema los podemos visualizar desde la propia gesti\u00f3n de eventos o Event Viewer de Windows (eventvwr.msc) o podemos utilizar una herramienta que nos permita trabajar tanto de manera live como de manera post-mortem. </p> <p>Event-Log Explorer </p> <p> </p> <p>** Ver Video: 20-Eventos del Sistema </p> <p>Se podr\u00eda utilizar t\u00e9cnicas de carving para poder recuperar este tipo de ficheros, pero siempre es muy importante desde que se produce el incidente que la m\u00e1quina sea apagada/tirada del cable para que la probabilidad de recuperaci\u00f3n de este tipo de ficheros aumente tal y como se demuestra en el siguiente enlace. </p> <p>https://rawsec.lu/blog/posts/2017/Jun/23/carving-evtx/ </p> <p>La herramienta que nos va permitir realizar carving de este tipo de ficheros es Bulk_extractor. Tal y como vimos su funcionamiento en la parte de carving, bastar\u00eda con proporcionarle una imagen f\u00edsica o l\u00f3gica y marcar el esc\u00e1ner como se muestra en la imagen de a continuaci\u00f3n: </p> <p> </p>"},{"location":"ud2/ud2.3.Principales_artefactos_en_sistemas_windows/#analisis-de-casuisticas-mas-comunes-en-cuanto-a-seguridad","title":"An\u00e1lisis de casu\u00edsticas m\u00e1s comunes en cuanto a seguridad.","text":"<p>A continuaci\u00f3n veremos las situaciones m\u00e1s comunes que podremos identificar mediante eventos del sistema. </p> <ol> <li>BruteForce Attack </li> </ol> <p>Un ataque de fuerza bruta se podr\u00e1 realizar mediante el intento de autenticaci\u00f3n del usuario hasta que consiga acceso al sistema. Veremos muchos eventos 4625 y a continuaci\u00f3n un 4624 </p> <p> </p> <ol> <li>Remote Desktop Protocol </li> </ol> <p>El remote Desktop Protocol, es el protocol de Windows para poder conectarse a otra m\u00e1quina, mediante credenciales, es decir, un escritorio remoto. </p> <p>En el Security Event Log: </p> <ul> <li>Sesi\u00f3n conectada: Event ID 4778 (incluye direcci\u00f3n IP y Hostname) </li> <li>Sesi\u00f3n desconectada: Event ID 4779 (incluye direcci\u00f3n IP y Hostname) </li> <li>Autenticaci\u00f3n Satisfactoria Event ID 4624 Tipo ( 10 y 7 para reconexi\u00f3n) </li> </ul> <p>Logs auxiliares: </p> <ul> <li>Remote Desktop Services \u2013 RDPCoreTS (Event ID 131) </li> <li>TerminalServices-RemoteConnectionManager%40Operational) (Event ID 1149) </li> <li>Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx (Event ID 21 y 22) </li> </ul> <p>Conexi\u00f3n Satisfactoria </p> <p>Conexi\u00f3n satisfactoria mediante escritorio remoto </p> <p> </p> <p>Ejemplo de evento 1149 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 4624 tipo 7: </p> <p> </p> <p>Ejemplo de evento 21 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 22 con IP Origen: </p> <p> </p> <p>Conexi\u00f3n no satisfactoria </p> <p>La autenticaci\u00f3n no satisfactoria mediante RDP </p> <p> </p> <p>Evento 4625 tipo 2: </p> <p> </p> <p>Conexi\u00f3n LogOFF </p> <p>Desconexi\u00f3n de la consola de escritorio remoto mediante log off solicitado por el usuario. </p> <p> </p> <p>Reconexi\u00f3n </p> <p>Conexi\u00f3n de nuevo con la consola de escritorio remoto </p> <p> </p> <p>Sesi\u00f3n desconectada </p> <p>Sesi\u00f3n desconectada, cerrando la ventana de escritorio remoto </p> <p> </p> <ol> <li>Cambio de Hora </li> </ol> <p>El cambio de hora de un sistema, es una de las peores situaciones que se puede dar para un investigador ya que todos los timestamps quedan modificados: </p> <p>Al hacer un cambio de hora se produce el Evento 4616 dentro de Security.evtx </p> <p> </p> <ol> <li>Dispositivos USB </li> </ol> <p>A parte de todos los artefactos que hemos visto anteriormente para la identificaci\u00f3n de USBs, tambi\u00e9n podemos utilizar los eventos de System: </p> <ul> <li>20001 /20003 contiene cuando se insert\u00f3 por primera vez. </li> <li>10000 contiene cuando se insert\u00f3 por primera vez </li> <li>10100 contiene el log de cuando se actualiz\u00f3 el driver. </li> </ul> <p>Ejemplo de evento 20001 </p> <p> </p> <p>Tambi\u00e9n se puede localizar el n\u00famero de serie en la anterior captura junto con la marca y modelo, en el evento 20003 </p> <p> </p> <p>Eventos de Microsoft-Windows-DeviceSetupManager%4Admin.evtx </p> <ul> <li>Event ID 112: contiene el timestamp de cada dispositivo USB insertado en el sistema. Para correlar, es necesario conocer el ContainderID del USBSTOR key del registro que vimos previamente. </li> </ul> <p> </p> <p>El Container ID concuerda con lo que se vio en la parte de Registro: </p> <p> </p> <ol> <li>Apagado/arranque del Sistema </li> </ol> <p>Identificaci\u00f3n del arranque del Sistema mediante el arranque del servicio \u201cEvent Log\u201d en el evento 6005 </p> <p> </p> <p>Identificaci\u00f3n del apagado del sistema mediante la parada del servicio \u201cEvent Log\u201d mediante el evento 6006 </p> <p> </p> <p>Identificaci\u00f3n de un apagado inesperado mediante el evento 6008: </p> <p> </p> <p>Identificaci\u00f3n del tiempo que lleva encendido del sistema: </p> <p> </p> <p>Apagado del servicio \u201cEvent Log\u201d mediante el evento id 1100 en Security </p> <p> </p> <ol> <li>Vaciado de Logs </li> </ol> <p>Vaciado del fichero Security.evtx, identificado mediante el evento id 1102 </p> <p> </p> <p>Para m\u00e1s informaci\u00f3n de eventos de Windows se puede utilizar la siguiente p\u00e1gina: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/","title":"Principales artefactos en sistemas Linux","text":""},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-son-los-logs-de-linux","title":"\u00bfQu\u00e9 son los logs de Linux?","text":"<p>Los registros del sistema o logs son archivos de texto que registran cronol\u00f3gicamente la totalidad de actividades e incidencias importantes que ocurren en el sistema operativo, incluidos el kernel, los servicios y las aplicaciones que se ejecutan. Los sistemas operativos GNU Linux registran absolutamente todo lo que pasa en el sistema operativo mediante los logs. La totalidad de logs de nuestro equipo los registran y gestionan los demonios journald y/o rsyslogd.</p>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#journald-vs-rsyslogd-similitudes-y-diferencias","title":"Journald vs rsyslogd: Similitudes y diferencias","text":"<ul> <li>Journald.</li> <li>Rsyslogd.</li> </ul>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-registran-los-logs-de-linux","title":"\u00bfQue registran los logs de Linux?","text":"<p>Algunos ejemplos de la informaci\u00f3n que contienen los logs en Linux son los siguientes:</p> <ul> <li>Los paquetes que se instalan y desinstalan en el sistema operativo.</li> <li>Informaci\u00f3n sobre los accesos remotos a nuestro equipo.</li> <li>Los intentos fallidos de autenticaci\u00f3n de los usuarios al equipo.</li> <li>Registro de errores que se dan en los programas o servicios que usamos.</li> <li>Los accesos o salidas bloqueadas por nuestro firewall.</li> </ul> <p>Como vemos, los logs en Linux son una fuente b\u00e1sica para saber qu\u00e9 est\u00e1 pasando en nuestro equipo. Por lo tanto, todo administrador de sistemas deber\u00eda saber c\u00f3mo consultar los logs para de este modo:</p> <ul> <li>Detectar la causas de los problemas que puede tener un equipo o servidor.</li> <li>Registrar y detectar ataques inform\u00e1ticos por parte de un hacker.</li> <li>Detectar comportamientos an\u00f3malos de programas o servicios.</li> <li>Ver el rendimiento de un ordenador o servidor.</li> <li>Averiguar qu\u00e9 ocurri\u00f3 en una determinada actualizaci\u00f3n de un equipo.</li> </ul> <p>Los logs son igualmente esenciales a la hora de gestionar un incidente de ciberseguridad, nos aportar\u00e1n informaci\u00f3n muy importante tanto para resolver un incidente, como para prevenirlo anticipando los problemas que se avecinan gracias a una monitorizaci\u00f3n de los mismos.</p>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#como-se-clasifican-los-logs-de-linux","title":"\u00bfC\u00f3mo se clasifican los Logs de Linux?","text":"<p>Simplificando al m\u00e1ximo los logs en Linux se pueden clasificar del siguiente modo:</p> <ul> <li>Logs de sistema: Generalmente generados por el demonio Rsyslogd. Registran informaci\u00f3n relacionada con el funcionamiento del sistema operativo. Algunos ejemplos de logs de sistema son los que registran informaci\u00f3n sobre los servicios, los que registran los accesos al equipo, los mensajes del sistema, etc.   Englobamos en esta categor\u00eda, eventos de sistema, servicios y eventos.</li> <li>Logs de aplicaciones: Son aquellos que registran cronol\u00f3gicamente los eventos m\u00e1s importantes mientras estamos usando una aplicaci\u00f3n o programa. En este caso, los logs pueden ser generados por la propia aplicaci\u00f3n o por Rsyslogd.</li> </ul>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#localizacion-de-los-logs","title":"Localizaci\u00f3n de los logs","text":"<p>Pr\u00e1cticamente la totalidad de logs se almacenan en las siguientes ubicaciones:</p> <ul> <li>En el directorio /var/log.</li> <li>En los subdirectorios de /var/log.   No obstante, es posible que algunas aplicaciones guarden los logs en otras ubicaciones del sistema operativo.</li> </ul> <pre><code>rv3@slimbook:/$ ls -a /var/log\n.                       boot.log.5      firebird                syslog.7.gz\n..                      boot.log.6      fontconfig.log          teamviewer15\nalternatives.log        boot.log.7      gdm3                    tor\nalternatives.log.1      bootstrap.log   gpu-manager.log         ubuntu-advantage.log\nalternatives.log.10.gz  btmp            gpu-manager-switch.log  ubuntu-advantage.log.1\nalternatives.log.11.gz  btmp.1          guymager.log            ubuntu-advantage-timer.log\nalternatives.log.12.gz  cups            hp                      ubuntu-advantage-timer.log.1\nalternatives.log.2.gz   dist-upgrade    installer               ubuntu-advantage-timer.log.2.gz\nalternatives.log.3.gz   dmesg           journal                 ubuntu-advantage-timer.log.3.gz\nalternatives.log.4.gz   dmesg.0         kern.log                ubuntu-advantage-timer.log.4.gz\nalternatives.log.5.gz   dmesg.1.gz      kern.log.1              ubuntu-advantage-timer.log.5.gz\nalternatives.log.6.gz   dmesg.2.gz      kern.log.2.gz           ubuntu-advantage-timer.log.6.gz\nalternatives.log.7.gz   dmesg.3.gz      kern.log.3.gz           unattended-upgrades\nalternatives.log.8.gz   dmesg.4.gz      kern.log.4.gz           vbox-setup.log\nalternatives.log.9.gz   dpkg.log        lastlog                 vbox-setup.log.1\nanydesk.trace           dpkg.log.1      mysql                   vbox-setup.log.2\napache2                 dpkg.log.10.gz  nordvpn                 vbox-setup.log.3\napt                     dpkg.log.11.gz  openvpn                 vbox-setup.log.4\nauth.log                dpkg.log.12.gz  private                 vmware\nauth.log.1              dpkg.log.2.gz   slimbookbattery.log     vmware-installer\nauth.log.2.gz           dpkg.log.3.gz   speech-dispatcher       vnetlib\nauth.log.3.gz           dpkg.log.4.gz   syslog                  wtmp\nauth.log.4.gz           dpkg.log.5.gz   syslog.1                Xorg.0.log\nboot.log                dpkg.log.6.gz   syslog.2.gz             Xorg.0.log.old\nboot.log.1              dpkg.log.7.gz   syslog.3.gz             Xorg.1.log\nboot.log.2              dpkg.log.8.gz   syslog.4.gz             Xorg.1.log.old\nboot.log.3              dpkg.log.9.gz   syslog.5.gz\nboot.log.4              faillog         syslog.6.gz\n\n</code></pre>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-contienen-los-logs-del-sistema-y-como-podemos-consultarlos","title":"\u00bfQu\u00e9 contienen los logs del sistema y c\u00f3mo podemos consultarlos?","text":"Ubicaci\u00f3n del log Datos registrados en el log y funcionalidad Comando para consultar el log /var/log/auth.log Proporciona un registro de todas las actividades que implican un proceso de autenticaci\u00f3n. Por ejemplo registra los usuarios logueados al sistema operativo. Registra el d\u00eda, hora, usuario y \u00f3rdenes que se han ejecutado con el comando sudo, los cronjobs que se han ejecutado, los intentos fallidos de autenticaci\u00f3n, etc. sudo less /var/log/auth.log /var/log/debug Para registrar datos de los programas que est\u00e1n actuando en modo depuraci\u00f3n. De esta forma los programadores pueden obtener informaci\u00f3n si sus programas est\u00e1n funcionando adecuadamente. sudo less /var/log/debug /var/log/syslog Contiene la totalidad de logs capturados por rsyslogd. Por lo tanto en este fichero encontraremos multitud de logs y ser\u00e1 dif\u00edcil de consultar y filtrar. Por este motivo, los logs se distribuyen en otros ficheros siguiendo la configuraci\u00f3n del fichero /etc/rsyslog.conf. sudo less /var/log/syslog /var/log/kern.log: Proporciona informaci\u00f3n detallada de mensajes del kernel. Por ejemplo si hab\u00e9is compilado un kernel y ten\u00e9is problemas podr\u00e9is ver los mensajes de error y advertencias en kern.log. Tambi\u00e9n puede ser \u00fatil para intentar detectar y solucionar problemas con la detecci\u00f3n de hardware. sudo less /var/log/kern.log /var/log/dmesg Dentro del fichero encontraremos informaci\u00f3n relacionada con el hardware de nuestro equipo. Por lo tanto podremos obtener informaci\u00f3n para concluir si nuestro hardware funciona de forma adecuada. Si nuestra distribuci\u00f3n no contase con este registro, podr\u00edamos hacer uso del comando \u201cdmesg\u201d que nos mostrar\u00e1 en su salida la misma informaci\u00f3n. dmesg | less /var/log/messages Contiene mensajes informativos y no cr\u00edticos de la actividad del sistema operativo. Acostumbra a contener los errores que se registran en el arranque del sistema que no est\u00e9n relacionados con el Kernel. Por lo tanto, si no se inicia un servicio, como por ejemplo el servidor de sonido, podemos buscar informaci\u00f3n dentro de este archivo. sudo less /var/log/messages /var/log/faillog Registra los intentos fallidos de autenticaci\u00f3n de cada usuario. Dentro del archivo se almacena una lista de usuarios, los fallos totales de cada usuario, el n\u00famero de fallo m\u00e1ximos que permitimos y la fecha y hora del \u00faltimo fallo. Si un usuario supera el n\u00famero de fallos m\u00e1ximos establecidos se deshabilitar\u00e1 el usuario por el tiempo que nosotros fijemos. faillog /var/log/btmp Almacena los intentos fallidos de logins en un equipo. Si alguien realizar\u00e1 un ataque de fuerza bruta a un servidor ssh, el fichero registrar\u00eda la IP del atacante, el d\u00eda y hora en que ha fallado el login, el nombre de usuario con que se ha intentado loguear, etc. sudo utmpdump /var/log/btmp sudo last -f /var/log/btmp | more /var/log/lastlog Ayuda a ver la fecha y la hora en que cada usuario se ha conectado por \u00faltima vez. lastlog | less /var/log/wtmp En todo momento contiene los usuarios que est\u00e1n logueados al sistema operativo. who /var/log/boot.log Informaci\u00f3n relacionada con el arranque del sistema. Podemos consultarlo para analizar si se levantan los servicios del sistema, si se levanta la red, si se montan las unidades de almacenamiento, para averiguar un problema que hace que nuestro equipo no inicie, etc. sudo /var/log/boot.log /var/log/cron Registra la totalidad de informaci\u00f3n de las tareas realizadas por cron. Si tienen problemas con la ejecuci\u00f3n de tareas tienen que consultar este log para ver si el trabajo se ha ejecutado o da errores. Debian no dispone de este log, pero encontrar\u00e1n la misma informaci\u00f3n en /var/log/syslog. En Debian pueden configurar el fichero de configuraci\u00f3n /etc/rsyslog.conf para generar un log espec\u00edfico para cron. sudo less /var/log/cron.log /var/log/daemon.log Registra la actividad de los demonios o programas que corren en segundo plano. Para ver si un demonio se levant\u00f3 o est\u00e1 dando errores podemos consultar este log. Dentro de daemon.log encontraremos informaci\u00f3n sobre el demonio que inicia el gestor de inicio, el demonio que inicia la base de datos de MySQL, etc. sudo less /var/log/daemon.log /var/log/dpkg.log Contiene informaci\u00f3n sobre la totalidad de paquetes instalados y desinstalados mediante el comando dpkg. sudo less /var/log/dpkg.log /var/log/apt/history.log Detalle de los paquetes instalados, desinstalados o actualizados mediante el gestor de paquetes apt-get. sudo less /var/log/apt/history.log"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-contienen-los-logs-de-aplicaciones-y-como-podemos-consultarlos","title":"\u00bfQu\u00e9 contienen los logs de aplicaciones y c\u00f3mo podemos consultarlos?","text":"<p>Del mismo modo que en el apartado anterior, a continuaci\u00f3n veremos:</p> <ul> <li>Los logs de las aplicaciones o programas m\u00e1s importantes.</li> <li>La informaci\u00f3n que almacenan cada uno de los logs y para qu\u00e9 puede sernos \u00fatil.</li> <li>Los comandos que tenemos que usar para consultar cada uno de los logs.</li> </ul> Ubicaci\u00f3n de log Datos registrados en el log y funcionalidad Comando para consultar el log /var/log/rkhunter.log Registra la totalidad de resultados obtenidos por rkhunter. rkhunter es una utilidad que analiza el sistema en busca de puertas traseras, rootkits, etc. Dentro del log de este programa encontraremos informaci\u00f3n sobre lo que ha detectado rkhunter en su an\u00e1lisis. sudo less /var/log/rkhunter.log /var/log/samba/. Dentro de la ubicaci\u00f3n /var/log/samba encontrar\u00e1n distintos logs que registran los eventos que han ocurrido en nuestro servidor samba. Algunos de los registros que encontrar\u00e1n son sobre creaciones de directorios, renombrado de archivos, ficheros creados y borrados, registros de conexiones y desconexiones al servidor, etc. sudo less /var/log/samba/samba.log (Los logs de Samba requieren ser configurados. La ubicaci\u00f3n de los logs depende del sistema operativo que usemos) /var/log/cups/. error_log, page_log y access_log contienen informaci\u00f3n acerca las horas en que una IP se ha conectado al servidor, el usuario que se ha conectado al servidor, los errores y advertencias del servidor, la fecha en que se ha imprimido un determinado documento, el n\u00famero de copias, etc. Para m\u00e1s informaci\u00f3n sobre el contenido de los logs de cups pueden consultar el siguiente enlace. sudo less /var/log/cups/error_log sudo less /var/log/cups/access_log sudo less /var/log/cups/page_log /var/log/lighttpd/. access.log y error.log contienen informaci\u00f3n sobre las visitas y errores que se generan cuando un usuario visita una p\u00e1gina web montada sobre un servidor lighttpd. sudo less /var/log/lighttpd/access.log sudo less /var/log/lighttpd/error.log /var/log/apache2/access.log /var/log/httpd/access_log Contiene informaci\u00f3n de los usuarios que han accedido al servidor web Apache. En este fichero encontraremos datos como las p\u00e1ginas que ha visitado una determinada IP, la hora en que una IP nos ha visitado, etc. sudo less /var/log/apache2/access.log sudo less /var/log/httpd/access_log /var/log/apache2/error.log /var/log/httpd/error_log Es el encargado de registrar la totalidad de errores cuando se procesan las solicitudes de los visitantes al servidor web Apache. sudo less /var/log/apache2/error.log sudo less /var/log/httpd/error_log /var/log/prelink/ Contiene informaci\u00f3n sobre las modificaciones que la utilidad prelink realiza a los binarios y librer\u00edas compartidas. sudo less /var/log/prelink/ /var/log/mysql/mysql.log Registro de la totalidad de sentencias que los clientes env\u00edan al servidor sudo less /var/log/mysql/mysql.log /var/log/mysql/error.log Registra los errores o problemas detectados al iniciar, ejecutar o parar el servicio. Por lo tanto en el caso que MySQL o MariaDB no se inicien deberemos acceder a este fichero para obtener informaci\u00f3n del problema. sudo less /var/log/mysql/error.log /var/log/mysql/mysql-slow.log Encontraremos informaci\u00f3n acerca de las sentencias que han tardado m\u00e1s segundos que los especificados en la variable del sistema long_query_time. De esta forma podremos conocer las sentencias SQL que se ejecutan de forma lenta. sudo less /var/log/mysql/mysql-slow.log /var/log/fail2ban.log Registra el d\u00eda y la hora en que una determinada IP ha sido bloqueada y desbloqueada al intentar acceder a un determinado servicio. sudo less /var/log/fail2ban.log /var/log/openvpn.log La hora en la que una determinada IP se ha conectado al servidor OpenVPN. Si quieren registrar los intentos fallidos de autenticaci\u00f3n tambi\u00e9n pueden usar fail2ban. sudo less /var/log/openvpn.log /var/log/openvpn-status.log Contiene informaci\u00f3n de los usuarios conectados al servidor OpenVPN. Ejemplos de la informaci\u00f3n que contiene es la IP de cada uno de los usuarios, La cuenta de usuario con que se ha conectado una determinada IP, la hora en que cada usuario ha iniciado la conexi\u00f3n, etc. sudo less /var/log/openvpn-status.log /var/log/letsencrypt/letsencrypt.log Contiene todo tipo de informaci\u00f3n acerca de los certificados de let\u2019s Encrypt. Por ejemplo si se han producido errores en la renovaci\u00f3n de los certificados ser\u00e1 \u00fatil consultar este log. sudo less /var/log/letsencrypt/letsencrypt.log"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#otros-directorios-de-interes","title":"Otros directorios de inter\u00e9s","text":"<ul> <li>/var/log/lighttpd/</li> <li>/var/log/mail/</li> <li>/var/log/mysqld.log</li> <li>/etc/rsyslog.d/ - /etc/rsyslog.conf</li> <li>/var/log/audit/</li> <li>/var/lib/dhcp/dhcpd.lease =&gt; DHCP usa \u00e9ste fichero para almacenar la base de datos lease del cliente. Este fichero, nos va a ayudar a completar la topolog\u00eda de la red.</li> <li>/home/username/.bash_history =&gt; Guarda los comandos ejecutados en bash por un usuario en particular.   .mysql_history =&gt; El cliente mysql guarda en este fichero un hist\u00f3rico de todas las sentencias ejecutadas.</li> <li>/home/user/.ssh/authorized_keys =&gt; Especifica las claves SSH que se pueden usar para iniciar sesi\u00f3n en la cuenta de usuario para la que est\u00e1 configurado el archivo.</li> </ul>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#como-consultar-el-contenido-de-los-logs","title":"\u00bfC\u00f3mo consultar el contenido de los logs?","text":"<p>En apartados anteriores existen tablas en que se detallan los comandos a usar para consultar cada uno de los logs de nuestro sistema operativo. Si las consultan ver\u00e1n que podremos consultar la gran mayor\u00eda de logs mediante las siguientes utilidades:</p> <ul> <li>locate: Nos permite localizar la ubicaci\u00f3n de un archivo en el sistema.</li> <li>cat: Muestra por pantalla el contenido del fichero.</li> <li>less: Utilidad que permite leer ficheros de texto en Linux.</li> <li>zless: Comando que permite visualizar ficheros comprimidos por el sistema de rotaci\u00f3n de logs.</li> <li>tail: Utilidad que sirve para mostrar las 10 \u00faltimas l\u00edneas de un log o fichero de texto.</li> <li>head: Programa para visualizar las 10 primeras l\u00edneas de un log o fichero de texto.</li> <li>grep: Nos permite filtrar el contenido de un fichero buscando una secuencia de caracteres dada.   Etc.</li> </ul>"},{"location":"ud2/ud2.4.Principales_artefactos_en_sistemas_Linux/#referencias","title":"Referencias","text":"<ul> <li>Qu\u00e9 son, c\u00f3mo funcionan y qu\u00e9 utilidad tienen los logs en Linux</li> <li>12 Critical Linux Log Files You Must be Monitoring</li> <li>Create your own Log Analysis Environment\u2014 (Forensic)</li> <li>Performing Linux Forensic Analysis and Why You Should Care!</li> <li>Linux Forensics Tricks</li> <li>Practical Linux Forensics</li> </ul>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/","title":"An\u00e1lisis de memoria","text":"<p>El an\u00e1lisis forense de la memoria es el proceso de capturar la memoria en ejecuci\u00f3n de un dispositivo y luego analizar la salida capturada en busca de evidencias que nos ayuden a resolver nuestro caso. A diferencia del an\u00e1lisis forense de disco, en el que se clona el sistema de archivos de un dispositivo y todos los archivos del disco se pueden recuperar y analizar, el an\u00e1lisis forense de la memoria se centra en que se estaba ejecutando en un dispositivo cuando se captur\u00f3 el volcado de memoria.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#que-son-los-datos-volatiles","title":"\u00bfQu\u00e9 son los datos vol\u00e1tiles?","text":"<p>Los datos vol\u00e1tiles son todos los datos que se almacenan temporalmente y se perder\u00edan si se desconectara la energ\u00eda del dispositivo que los contiene.</p> <p>Los datos vol\u00e1tiles son de gran importancia en la inform\u00e1tica forense, sobre todo en la respuesta a incidentes. Cuando tratamos con de un dispositivo comprometido, una de las primeras reacciones puede ser apagar el dispositivo para contener la amenaza. El problema con este enfoque es que si por ejemplo tenemos un malware en ejecuci\u00f3n en el dispositivo se ejecutar\u00e1 en la memoria.</p> <p>Por lo tanto, al apagar el dispositivo se perder\u00e1n todas las conexiones de red y los procesos en ejecuci\u00f3n. Estos datos vol\u00e1tiles no se escriben en el disco y cambian constantemente en la memoria, por lo que apagar el dispositivo significa que se ha destruido evidencia valiosa.</p> <p>La contenci\u00f3n de la red (aislar el dispositivo del resto de la red) es la opci\u00f3n preferida cuando se a\u00edsla un dispositivo comprometido. De esa forma contendremos el incidente, conservaramos una evidencia valiosa y no destruiremos los datos vol\u00e1tiles que tenemos en memoria.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#que-es-un-volcado-de-memoria","title":"\u00bfQu\u00e9 es un volcado de memoria?","text":"<p>Un volcado de memoria o volcado de RAM es una \"instant\u00e1nea\" de la memoria.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#que-podemos-encontrar-en-los-datos-volatiles","title":"\u00bfQue podemos encontrar en los datos vol\u00e1tiles?","text":"<p>Los datos vol\u00e1tiles pueden contener informaci\u00f3n muy valiosa para nuestra investigaci\u00f3n.</p> <p>Por ejemplo, podr\u00edamos encontrar actividad en el sistema o en internet que nos ayude a demostrar que se han realizado actividades ilegaes o, por ejemplo, si se accedi\u00f3 a archivos o a un dispositivo externo en esa fecha, lo que puede ayudar a proporcionar evidencia en casos relacionados con el robo de datos.</p> <p>Tambi\u00e9n poddemos econtrar evidencias interesantes relacionadas con una cuenta online de correo electr\u00f3nico, por ejemplo, cuentas de Hotmail o Gmail o de la actividad de las redes sociales, como la mensajer\u00eda de Facebook, que normalmente tambi\u00e9n se almacena en datos vol\u00e1tiles.</p> <p>Otros ejemplos de informaci\u00f3n que podemos encontrar en la memoria volatil:</p> <ul> <li>Procesos en ejecuci\u00f3n</li> <li>Conexiones de red activas y cerradas.</li> <li>El historial de navegaci\u00f3n.</li> <li>Archivos en el sistema.</li> <li>Documentos.</li> <li>Lista de comendos en el CMD de windows o terminal de Linux.</li> <li>El contenido del portapapeles.</li> <li>hash de contrase\u00f1as.</li> <li>Claves y certificados SSL.</li> </ul>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#herramientas-para-analisis-de-memoria","title":"Herramientas para an\u00e1lisis de memoria","text":"<p>En los \u00faltimos a\u00f1os han surgido varias herramientas gratuitas para realizar an\u00e1lisis de la memoria, y a d\u00eda de hoy siguen surgiendo, lamentablemente muchas de ellas han sido abandonadas, como es el caso de Rekall.</p> <p>Es por ello que en esta secci\u00f3n nos vamos a centrar en una herramienta, Volatility.</p> <p> </p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility","title":"Volatility","text":"<p>Volatility es una herramienta forense de memoria gratuita desarrollada y mantenida por Volatility Foundation, considerada como el est\u00e1ndar de facto para el an\u00e1lisis forense de memoria volatil.</p> <p>Volatility se puede expandir enormemente a trav\u00e9s de un sistema de complementos o plugings desarrollados tanto por la fundaci\u00f3n como por la propia comunidad. Es una herramienta invaluable para cualquier Blue Teamer.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility-2-vs-volatility-3","title":"Volatility 2 vs Volatility 3","text":"<p>Actualmente estamos a medio camino entre las dos versiones estables que existen de la herramienta, volatility 2 y volatility 3, el uso de cada una de ellas tiene sus pros y sus contras.</p> <p>La versi\u00f3n nueva de volatility ha sido completamente reescrita y redise\u00f1ada en Python 3, e introduce muchas novedades:</p> <ul> <li>Integraci\u00f3n mucho m\u00e1s sencilla en otras bibliotecas e interfaces de usuario</li> <li>Soporta de forma nativa multiprocesamiento y cach\u00e9s de memoria</li> <li>Detecci\u00f3n autom\u00e1tica de perfiles para todos los sistemas operativos soportados.</li> <li>Soporte nativo de aplicaciones de 32 bits en kernels de 64 bits</li> <li>Evaluaci\u00f3n automatizada del c\u00f3digo en memoria</li> <li>Los plugins est\u00e1n versionados y pueden llamar directamente a otros plugins</li> <li>Soporte automatizado de sistemas operativos y aplicaciones y an\u00e1lisis autom\u00e1tico de m\u00faltiples muestras a la vez</li> </ul> <p>Richard Davis, en su canal de YouTube 13Cubed, public\u00f3 un v\u00eddeo muy interesante sobre Volatility 3 y sus nuevas caracter\u00edsticas.</p> <p>Los inconvenientes del uso de volatility3 vienen fundamentalmente por los plugins, la gran mayor\u00eda de los plugins existentes para volatility2 no han sido a\u00fan migrados a volatility3.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility-installation","title":"Volatility Installation","text":"<p>Por lo que se ha comentado anteriormente, se propone la instalaci\u00f3n de las dos versiones.</p> <ul> <li>Script para instalar volatility 2 en Debian, Ubuntu, or Kali Linux</li> <li>Script para instalar volatility 3 en Debian, Ubuntu, or Kali Linux</li> </ul> <p>Nota. Ten en cuenta que volatility2 se ejecuta bajo python2 y volatility3 bajo python3.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility-plugins","title":"Volatility Plugins","text":"<p>En la wiki de la herramienta podemos encontrar una gu\u00eda de referencia de los principales plugins, as\u00ed como otros desarrollados por la propia comunidad.</p> <p>Si queremos ver una lista de los plugins que trae cargados por defecto, podemos usar propia la ayuda de la herramienta:</p> <pre><code>$ python vol.py --info\n</code></pre>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#formatos-que-admite-volatility","title":"Formatos que admite volatility","text":"<p>Volatility admite volcados de memoria en varios formatos diferentes, para garantizar la m\u00e1xima compatibilidad con diferentes herramientas de adquisici\u00f3n.</p> <p>Puede analizar archivos de hibernaci\u00f3n, volcados de memoria, volcados de n\u00facleo de virtualbox, volcado de memoria sin procesar, etc.. Volatility detectar\u00e1 el formato de archivo subyacente y aplicar\u00e1 el espacio de direcciones adecuado.</p> <p>Listado de formatos de archivo que acepta:</p> <ul> <li>Raw linear sample (dd)</li> <li>Hibernation file (from Windows 7 and earlier)</li> <li>Crash dump file</li> <li>VirtualBox ELF64 core dump</li> <li>VMware saved state and snapshot files</li> <li>EWF format (E01)</li> <li>LiME format</li> <li>Mach-O file format</li> <li>QEMU virtual machine dumps</li> <li>Firewire</li> <li>HPAK (FDPro)</li> </ul> <p>\u00c9chale un ojo a como convertir entre formatos de archivo.</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#perfiles-de-memoria","title":"Perfiles de memoria","text":"<p>Volatility necesita saber de qu\u00e9 tipo de sistema proviene el volcado de memoria, para saber qu\u00e9 estructuras de datos, algoritmos y s\u00edmbolos usar. Por lo tanto antes de comenzar a analizar nuestra captura de memoria debemos indicarle a volatility que perfil de memoria es. Si no sabemos de qu\u00e9 tipo de sistema es el volcado de memoria, podemos usar los complementos imageinfo o kdbgscan para obtener sugerencias.</p> <p>Si queremos ver una lista de nombres de perfil que trae cargados por defecto, podemos usar la propia ayuda de la herramienta:</p> <pre><code>$ python vol.py --info\n</code></pre>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility-no-encuentra-el-perfil-ahora-que-hago","title":"Volatility no encuentra el p\u00e9rfil, \u00bfahora que hago?","text":"<p>Se nos puede dar el caso de que la herramienta no traiga cargado el perfil de memoria que necesitamos, en ese caso tenemos dos opciones:</p> <ol> <li> <p>Podemos acudir al repositorio de la herramienta, descargar los perfiles actualizados y cargarlos en el directorio que los almacen (/volatility/plugins/overlays/sistema_operativo_del_perfil).</p> </li> <li> <p>En caso de que el descarguemos el perfil y siga sin detectarlo, no nos quedar\u00e1 mas remedio que crearlo nosotros y a\u00f1adirlo a la carpeta anteriormente indicada. Un par de art\u00edculos sobre como crear perfiles:</p> </li> </ol> <p>How to generate a Volatility profile for a Linux system</p> <p>Building a Linux profile for Volatility 2 and 3</p>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#como-analizar-una-captura-de-memoria-con-volatility","title":"C\u00f3mo analizar una captura de memoria con volatility","text":"<p>\u00c9sta serie de art\u00edculos hace una revisi\u00f3n muy \u00fatil e interesante del uso de Volatility mostrando algunas de sus capacidades de an\u00e1lisis:</p> <ul> <li> <p>Image Identification</p> </li> <li> <p>Processes and DLLs</p> </li> <li> <p>Process Memory</p> </li> <li> <p>Kernel Memory and Objects</p> </li> <li> <p>Networking</p> </li> <li> <p>Windows Registry</p> </li> <li> <p>Analyze and convert crash dumps and hibernation files</p> </li> <li> <p>Filesystem</p> </li> </ul>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#volatility-cheatsheets","title":"Volatility Cheatsheets","text":"<p>Volatility es una herramienta que abarca muchos aspectos de una investigaci\u00f3n forense. Para dar respuesta a todos esas necesidades tiene, como dijimos anteriormente, una cantidad importante de plugins. Por dicho motivo es muy importante que tengamos a manos una buena gu\u00eda de referencia de los comandos mas importantes. Anteriormente hemos mencionado la wiki de la propia herramienta, os dejo tambien un par de cheatsheets que pueden ser utilidad:</p> <ul> <li>Volaility CheatSheet (Volatility Foundation)</li> <li> <p>Volatility Cheat Sheet (SANS)</p> </li> <li> <p>HAckTricks Cheat Sheet</p> </li> </ul>"},{"location":"ud2/ud2.5.Analisis_Memoria_RAM/#otros-recursos","title":"Otros recursos","text":"<p>No soy muy amante los recursos en papel, pero en este apartado no podemos pasar por alto un libro que deber\u00eda estar en la estanter\u00eda de cualquier apasionado del an\u00e1lisis forense.</p> <p>Eso si el libro tiene 858 p\u00e1ginas, asi que si te lo compras, no lo tengas en la estater\u00eda que pesa un quintal... \u00a1mant\u00e9nlo en tu escritorio y \u00e1brelo!</p> <ul> <li>The Art of Memory Forensics: Detecting Malware and Threats in Windows, Linux, and Mac Memory</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.1.Caracateristicas_OS/","title":"Caracter\u00edsticas de los sistemas operativos Windows y Linux","text":""},{"location":"ud2%20%28copia%29/ud2.2.Plataformas_y_herramientas_de_analisis/","title":"Plataformas y herramientas de an\u00e1lisis","text":"<p>Existen en el mercado una cantidad inimaginable de herramientas forenses, es decisi\u00f3n de cada investigador elegir aquellas que mas se adapten a su forma de trabajar. Mi recomendaci\u00f3n es que vay\u00e1is probando herramientas, tanto las recogidas en la unidad did\u00e1cticaes como aquellas que encontr\u00e9is y recoj\u00e1is en vuestra herramienta de notas todas aquellas que os puedan ser \u00fatiles para el futuro.</p>"},{"location":"ud2%20%28copia%29/ud2.2.Plataformas_y_herramientas_de_analisis/#algunos-repositorios-muy-conocidos","title":"Algunos repositorios muy conocidos:","text":"<ul> <li>Forensic Wiki</li> <li>Eric Zimmerman\u015b Tools</li> <li>SANS Tools Collection</li> <li>Free Forensics Software \u2013 The Ultimate List</li> <li>Repo de herramientas de an\u00e1lisis forense windows</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.2.Plataformas_y_herramientas_de_analisis/#ejemplos-de-plataformas-preconfiguradas","title":"Ejemplos de plataformas preconfiguradas","text":"<ul> <li>Disk_Analysis_Tools (Forensic Wiki)</li> <li>Autopsy </li> <li>Caine</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/","title":"Principales artefactos en sistemas windows","text":""},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#windows-forensics-cheat-sheets","title":"Windows Forensics Cheat Sheets","text":"<ul> <li>SANS_Windows Forensic Analysis Poster</li> <li>SANS_Windows Third Party Forensics Poster</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#identificacion-y-analisis-de-artefactos-forenses-propios-del-sistema-de-archivos","title":"Identificaci\u00f3n y an\u00e1lisis de artefactos forenses propios del sistema de archivos","text":""},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#index-records","title":"$INDEX Records","text":"<p>NTFS indexa la informaci\u00f3n de cada directorio en un B+ Tree: </p> <p> </p> <p>FTK analiza el sistema de archivos y lo representa como un fichero m\u00e1s ($I30), seg\u00fan vemos en la imagen superior. </p> <p>Este atributo contiene informaci\u00f3n sobre los nombres de archivo y directorios que hay almacenados y que hubo dentro de \u00e9l. Este atributo es tambi\u00e9n conocido como $INDX y contiene: </p> <ul> <li>$INDEX_ROOT = 0x90 </li> <li>$INDEX_ALLOCATION = 0xA0 </li> <li>$BITMAP = 0XB0 </li> </ul> <p>Cuando borras un fichero de un directorio, el atributo $I30 queda de manera de slack space y se puede encontrar evidencias de que existi\u00f3. Es decir, dentro del propio fichero $I30 tenemos slack space. </p> <p> </p> <p>En la captura se identifica el fichero Uforia.pdf como $I30 INDX Entry. Es decir, esta entrada est\u00e1 dentro del $I30. \u00bfQu\u00e9 herramienta podemos utilizar para analizar el fichero $I30? </p> <p>IndexCSV </p> <p> </p> <p>Muy importante marcar la opci\u00f3n de Slack para que pueda obtener dentro del slack space del fichero I30 los registros que hubo. </p> <p>** Ver video: 01 - An\u00e1lisis de INDX </p> <p>\u00bfQu\u00e9 podemos obtener una vez hayamos analizado el fichero $I30? </p> <ul> <li>Fecha de Creaci\u00f3n del Fichero que hay en la carpeta </li> <li>Fecha de modificaci\u00f3n del fichero que hay en la carpeta </li> <li>Fecha de acceso del fichero que hay en la carpeta </li> <li>Fecha de cambio de registro MFT que hay en la carpeta </li> <li>Tama\u00f1o f\u00edsico, l\u00f3gico. </li> <li>Registro MFT </li> </ul> <p> </p> <p>Nunca obtendremos la fecha del fichero borrado que hubo en la carpeta. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#shadow-copies","title":"Shadow Copies","text":"<p>Las shadow copies tambi\u00e9n conocidas como el Servicio Volume Snapshot o Volume Shadow Copy (VSS), es una tecnolog\u00eda que se incluy\u00f3 en los sistemas operativos a partir de Windows 7. Es un servicio de Backup autom\u00e1tico y transparente para el usuario que est\u00e9 utilizando el sistema. </p> <p> </p> <p>F\u00edsicamente las shadows copies se encuentran en la carpeta ra\u00edz: System Volume Information </p> <p> </p> <p>En un equipo encendido o Live, es f\u00e1cil acceder a dichas shadows copies: </p> <p> </p> <p>\u00bfc\u00f3mo podr\u00edamos acceder a las shadows copies de una imagen forense?  **Ver Video: 02-Analisis de Shadows</p> <p>Junto con Arsenal Image Mounter y la herramienta de Nirsoft ShadowCopy View podr\u00edamos extraer los ficheros que hay en cada snapshot. </p> <p> </p> <p>Para analizar las Shadows Copies de un Windows 10, hay que lanzarlo desde un Windows 10. As\u00ed para todas las versiones de Windows. </p> <p>\u00bfDe qu\u00e9 ficheros se realiza backup mediante las shadows copies? </p> <p>Para ello habr\u00eda que analizar el registro de Windows, en especial el fichero SYSTEM e ir a la siguiente ruta: </p> <ul> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\VSS Y a esta ruta: </li> <li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore Dentro de esta \u00faltima clave de registro, podremos encontrar: </li> <li>FilesNotToBackup -&gt; ficheros que no se deben copiar </li> <li>KeysNotToRestore\u200a -&gt; claves de registro de Windows que no se deben de copiar. </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#carving","title":"Carving","text":""},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#que-ocurre-cuando-se-borra-un-fichero-mediante-el-sistema-operativo","title":"\u00bfQu\u00e9 ocurre cuando se borra un fichero mediante el sistema operativo?","text":"<p>Cuando vac\u00eda la papelera en un Sistema Windows, se borra presionando la tecla \u201cSHIFT\u201d o se borra desde el CMD, es cuando de verdad se produce un borrado el fichero. A continuaci\u00f3n identificamos todo el proceso a nivel forense: </p> <ol> <li>Se cambia el atributo flag, en la cabecera del registro MFT del fichero o carpeta que se ha borrado: </li> <li>Archivos: 0x01 to 0x00 </li> <li>Directorios: 0x03 to 0x02. </li> <li>El atributo $BITMAP del registro del MFT es procesado y establecido a 0 </li> <li>Los atributos no residentes del registro del MFT asociado al fichero en cuesti\u00f3n, son procesados y sus cl\u00faster son establecidos como espacio libre en el fichero $BITMAP. </li> </ol> <p>\u00bfTodo el proceso anterior impide que se pueda recuperar la informaci\u00f3n? No. Como ya hemos visto anteriormente se podr\u00e1 recuperar siempre y cuando no se sobrescriba el registro MFT, debido al uso del sistema. </p> <p>Los ransomware cuando deshabilitan las Shadows copies, lo que hacen es utilizar una llamada al sistema para la lanzar el comando pertinente. Este comando es propio del sistema operativo </p> <p> </p> <p>Para recuperarlas veremos en la parte de carving otra herramienta. </p> <p>\u00bfLas herramientas de borrado seguro c\u00f3mo funcionan? Estas herramientas pueden eliminar: </p> <ul> <li>El registro de MFT completo del fichero asociado </li> <li>Logfile </li> <li>Shadows copies </li> </ul> <p>A parte de realizar las operaciones anteriores, los clusters que son utilizados para contener el propio fichero, se sobrescriben a ceros o siguiendo un est\u00e1ndar de borrado que va en funci\u00f3n del n\u00famero de pasadas. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-datos-mediante-el-propio-sistema-de-archivos","title":"Recuperaci\u00f3n de datos mediante el propio sistema de archivos","text":"<p>\u00bfC\u00f3mo funcionan los programas de recuperaci\u00f3n de ficheros que analizan el MFT? </p> <ol> <li>Buscan en el registro $MFT del fichero en cuesti\u00f3n. </li> <li>Analizan su atributo $DATA del registro. </li> <li>S\u00ed el atributo $DATA es residente, el contenido como tal est\u00e1 en el propio registro. </li> <li>S\u00ed el atributo $DATA es no residente, el contenido del fichero est\u00e1 en un cl\u00faster externo. A continuaci\u00f3n, se parsea el RunList. (Runlist contiene los clusters asociados al fichero) </li> <li>Verificar si los clusters del Runlist est\u00e1n allocated o no. Si todos los cl\u00faster est\u00e1n allocated La recuperaci\u00f3n de datos es posible. </li> <li>Si algunos clusters tienen de estado de allocated a 1, se puede realizar una recuperaci\u00f3n de datos parcial. Los que est\u00e1n allocate cambian a 0. </li> <li>Si todos los clusters estuviesen a 1, significa que ya hay un fichero que utiliza todos los cl\u00faster </li> </ol> <p>Este tipo de t\u00e9cnicas si permite recuperar el nombre del fichero, ya que se obtiene del atributo $FILE_NAME. </p> <p>Otras t\u00e9cnicas de recuperaci\u00f3n de archivos utilizando artefactos del sistema de archivos, ser\u00edan: </p> <ul> <li>Carving de registros MFT en el espacio libre </li> <li>B\u00fasqueda de registros MFT en el propio registro $MFT, en el slack space. </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-datos-mediante-carving","title":"Recuperaci\u00f3n de datos mediante carving","text":"<p>La recuperaci\u00f3n de datos mediante carving, se basa en ir analizando cl\u00faster a cl\u00faster del dispositivo de almacenamiento en busca de cabeceras o formas conocidas. Esta t\u00e9cnica NO permite recuperar el nombre del fichero. No depende del sistema de archivos, sino de conocer previamente como esta formado el fichero que queremos recuperar. </p> <p> </p> <p>Tres tipos de t\u00e9cnicas: </p> <ul> <li>Basadas en cabeceras y cierre del fichero: Header-Footer con tama\u00f1o m\u00e1ximo del fichero </li> <li>Basadas en c\u00f3mo est\u00e1 el fichero construido : File structure based carving </li> <li>Content based Carving -&gt; basadas en el contenido en s\u00ed </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#tecnica-header-footer","title":"T\u00e9cnica Header - Footer","text":"<p>Se utiliza un header conocido y un footer: </p> <ul> <li>Fichero JPEG Header: OxFF,OxD8 -&gt; FFD8 </li> <li>Fichero JPEG Footer: OxFF,OxD9 -&gt; FFD9 </li> </ul> <p>Un listado de todas las cabeceras o firmas lo podemos encontrar en la siguiente URL: https://www.garykessler.net/library/file_sigs.html </p> <p>\u00bfQu\u00e9 herramienta podemos utilizar para aplicar esta t\u00e9cnica? Photorec </p> <p>\u00bfSirve con los programas de borrado seguro? No, ya que no podemos identificar headers/footers conocidos al haber sido sobrescritos por ciertos patrones grupos de ceros. </p> <p>Photorec no funciona con formato de imagen Encase, solo en im\u00e1genes en RAW o sobre el dispositivo f\u00edsico. </p> <p>Dispone de much\u00edsimas cabeceras y tipos de ficheros: https://www.cgsecurity.org/wiki/File_Formats_Recovered_By_PhotoRec </p> <p> </p> <p>**Ver video: 03-Photorec </p> <p>La t\u00e9cnica de carving no es v\u00e1lida para ficheros que est\u00e9n desfragmentados ya que los clusters que ocupan el fichero no est\u00e1n contiguos. </p> <p>\u00bfQu\u00e9 podr\u00edamos recuperar mediante t\u00e9cnicas de carving? </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>Shadows Copies </li> <li>$I30 </li> </ul> <p>Las shadows se pueden recuperar gracias a la siguiente herramienta: https://github.com/mnrkbys/vss_carver </p> <p>En el github aparece como y qu\u00e9 comandos son necesarios para poder utilizarla: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#stream-carving-vs-file-carving","title":"Stream Carving vs File Carving","text":"<p>El data Stream Carving se basa en extraer fragmentos de las siguientes fuentes de </p> <p>informaci\u00f3n: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre </li> <li>Ficheros de bases de datos Ejemplos: </li> <li>URLs (navegaci\u00f3n privada) </li> <li>Sesiones de Chat </li> <li>E-mails </li> <li>Claves de Cifrado </li> </ul> <p>El data stream carving est\u00e1 basado en la localizaci\u00f3n de peque\u00f1os fragmentos y no en la b\u00fasqueda del fichero entero. Los peque\u00f1os fragmentos pueden tener un gran significado, pero normalmente son parte de un fichero. Por ejemplo, las bases de datos como el fichero index.dat puede contener cientos de URL que han sido visitadas cuando se borraron. Si no eres capaz de recuperar el fichero completo se podr\u00edan extraer fragmentos. </p> <p>El file Carving o carving a secas, puede extraer ficheros de: </p> <ul> <li>Memoria / PageFile </li> <li>Espacio libre Ejemplos: </li> <li>Word (.doc/.docx) </li> <li>Im\u00e1genes (.jpg,.png,.gif) </li> <li>Archivos (.zip /.rar) </li> </ul> <p>Una herramienta que permite hacer ambos tipos de recuperaci\u00f3n es Bulk Extractor, soporta im\u00e1genes forenses en formato E01: </p> <p> </p> <p>Tambi\u00e9n permite realizar carving de: </p> <ul> <li>Registros MFT </li> <li>$Logfile </li> <li>$Usnjrnl </li> <li>$I30 </li> </ul> <p>** Ver video: 04-Bulk Extractor </p> <p>Una vez seleccionemos con Bulk Extractor la imagen a procesar, podemos ver el estado de c\u00f3mo va avanzado: </p> <p> </p> <p>Todos los resultados los guardar\u00e1 sobre la carpeta que hemos indicado. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#timeline","title":"Timeline","text":"<p>El timeline o l\u00ednea del tiempo nos permite obtener acotar en tiempo la investigaci\u00f3n de una evidencia, por ejemplo: nos indican que la investigaci\u00f3n est\u00e1 focalizada a ra\u00edz de la comunicaci\u00f3n a un trabajador que va ser despedido. La compa\u00f1\u00eda a ra\u00edz de esta comunicaci\u00f3n ha visto un comportamiento sospechoso. </p> <ul> <li>Fecha de comunicaci\u00f3n de despido: m\u00ednima fecha a investigar </li> <li>Fecha de salida de la compa\u00f1\u00eda: m\u00e1xima fecha a investigar </li> </ul> <p>Nuestro timeline estar\u00e1 basado \u00fanicamente en los timestamps del sistema de archivos, es decir, en las fechas de: </p> <ul> <li>Creaci\u00f3n de fichero -&gt; C </li> <li>Modificaci\u00f3n de fichero -&gt; M </li> <li>Cambio de registro MFT -&gt;B </li> <li>Acceso -&gt; A </li> </ul> <p>Estas fechas se le denomina MACB timestamp, para crear el Timeline podemos utilizar la herramienta Autopsy: </p> <p> </p> <p>** Ver video: 05-Autopsy</p> <p>Otra manera de generar un Timeline, ser\u00eda con la herramienta MFT2CSV, pero seleccionando el formato de salida log2timeline. Una vez se haya generado el CSV, deberemos de abrirlo con la herramienta TimeLine Explorer. </p> <p> </p> <p>** Ver Video: 06-Timeline </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#metadatos-de-ficheros","title":"Metadatos de ficheros","text":"<p>Los metadatos est\u00e1n definidos como estructura interna del propio fichero en s\u00ed. No tiene nada que ver con los metadatos que hemos visto del sistema de archivos. \u00bfQu\u00e9 tipos de ficheros pueden contener metadatos? </p> <ul> <li>Im\u00e1genes </li> <li>Documentos ofim\u00e1ticos </li> <li>Documentos de Audio </li> <li>Documentos de video </li> <li>Ejecutables </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en un fichero ofim\u00e1tico? </p> <ul> <li>T\u00edtulo </li> <li>Versi\u00f3n de MS Office Utilizada </li> <li>\u00daltimo Autor </li> <li>Creaci\u00f3n del documento /hora </li> <li>\u00daltima fecha de guardado </li> <li>\u00daltima fecha de impresi\u00f3n </li> </ul> <p>\u00bfQu\u00e9 metadatos podemos encontrar en una imagen? </p> <ul> <li>EXIF Data </li> <li>Marca C\u00e1mara / Modelo </li> <li>Hora de creaci\u00f3n </li> <li>Hora de modificaci\u00f3n </li> <li>Informaci\u00f3n de la imagen </li> <li>Coordenadas GPS </li> </ul> <p>Nota: Estos metadatos son muy f\u00e1ciles de manipular. Para realizar una investigaci\u00f3n correcta, se deben utilizar m\u00e1s artefactos y verificar dicha informaci\u00f3n. </p> <p> </p> <p>** Ver Video: 07-Exif tool </p> <p>Exiftool tambi\u00e9n permite analizar de manera recursiva un directorio: https://owl.phy.queensu.ca/~phil/exiftool/examples.html </p> <p>Las fechas que aparecen como metadatos en el documento ofim\u00e1tico son introducidas por la herramienta ofim\u00e1tica. No confundir con las fechas del sistema de archivos. </p> <p>Un documento como tal nunca contendr\u00e1 fechas a no ser que disponga de alg\u00fan metadato dentro \u00e9l. </p> <p>Otra herramienta muy buena para metadatos es Metadiver: https://www.easymetadata.com/metadiver-2/ </p> <p> </p> <p>Caracter\u00edsticas: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#registro-de-windows","title":"Registro de Windows","text":"<p>El registro de Windows, es uno de los artefactos m\u00e1s importante para un investigador, ya que dispone de mucha informaci\u00f3n acerca del sistema y de la actividad del usuario. Veremos cuatro secciones relacionadas con el registro de Windows: </p> <ul> <li>Registro de Windows : veremos todo lo necesario para leer el registro </li> <li>Usuario / Grupo: analizaremos la informaci\u00f3n relacionada permitiendo obtener el \u00faltimo login y los usuarios que tienen acceso al sistema. En el SAM. </li> <li>Configuraci\u00f3n del sistema: obtener la \u00faltima direcci\u00f3n IP, identificar los puntos de acceso a los que se ha conectado. SYSTEM o SOFTWARE </li> <li>Actividad del usuario: la parte m\u00e1s \u00fatil en cuanto al registro. Monitorizar la actividad gracias a los documentos abiertos, aplicaciones ejecutadas, etc. NTUSER.DAT </li> </ul> <p>Donde se encuentranlos ficheros de registro en un sistema Windows: en %Windir%\\System32\\Config: </p> <ul> <li>SAM -&gt; HKEY_LOCAL_MACHINE </li> <li>SECURITY -&gt; HKEY_LOCAL_MACHINE </li> <li>SYSTEM -&gt; HKEY_LOCAL_MACHINE </li> <li>SOFTWARE -&gt; HKEY_LOCAL_MACHINE </li> <li>DEFAULT -&gt; HKEY_LOCAL_MACHINE </li> </ul> <p>Existe tambi\u00e9n otro registro, relacionado con el usuario en \\%UserProfile%{user}\\: </p> <ul> <li>NTUSER.DAT -&gt; HKEY_CURRENT_USER </li> </ul> <p>Si abrimos nuestro Sistema y ejecutamos regedit.exe, veremos que la ra\u00edz del registro es la siguiente: </p> <p> </p> <p>Los sistemas Windows disponen de un backup del registro localizado en %Windir%\\System32\\Config\\RegBack:</p> <ul> <li>SAM -&gt; HKEY_LOCAL_MACHINE </li> <li>SECURITY -&gt; HKEY_LOCAL_MACHINE </li> <li>SYSTEM -&gt; HKEY_LOCAL_MACHINE </li> <li>SOFTWARE -&gt; HKEY_LOCAL_MACHINE </li> <li>DEFAULT -&gt; HKEY_LOCAL_MACHINE </li> </ul> <p>Esta copia de seguridad solo est\u00e1 disponible de Windows Vista en adelante y de Windows 2008 Server en adelante. Otro lugar donde pod\u00edamos encontrar una copia del registro ser\u00eda en las Shadow Copies. </p> <p>\u00bfQu\u00e9 registros hay asociados al usuario? </p> <ol> <li>NTUSER.DAT </li> <li>C:\\Users{username}\\NTUSER.DAT -&gt; WinVista-Win10 </li> <li>C:\\Documents and Settings{username}\\NTUSER.dat -&gt; XP </li> </ol> <p> </p> <ol> <li>USRCLASS.DAT </li> <li>C:\\Users{username}\\AppData\\Local\\Microsoft\\Windows\\USRCLASS.DAT -&gt; Solo disponible a partir de Win7/Win8/Win10 </li> </ol> <p>USRCLASS.DAT es muy importante porque contiene informaci\u00f3n en cuanto la ejecuci\u00f3n de programas indicando que directorios y han sido abiertos o cerrados. </p> <ul> <li>El prop\u00f3sito principal del UsrClass.DAT es ayudar a la UAC. </li> </ul> <p>Estos registros de usuario son \u00fanicos para el usuario del sistema, por lo que siempre habr\u00e1 uno para cada usuario. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-claves-valor","title":"Recuperaci\u00f3n de Claves-Valor","text":"<p>\u00bfQu\u00e9 hay dentro del registro de Windows? La informaci\u00f3n est\u00e1 organizada: </p> <p> </p> <p>Key : similar a los directorios (keys) y subdirectorios (subkeys) </p> <ul> <li>Produce una jerarqu\u00eda de directorios </li> </ul> <p>Values: informaci\u00f3n almacenada dentro de una key </p> <ul> <li>Contiene informaci\u00f3n en forma de: strings, integers, lists. </li> </ul> <p>Los Hives del registro de Windows tiene espacio libre similar al sistema de archivos, por lo que se podr\u00e1n recuperar keys borradas. Una clave borrada es marcada, pero no es deslocalizada, por lo que permite la recuperaci\u00f3n de: </p> <ul> <li>Keys, Values y TimeStamps </li> </ul> <p>A d\u00eda de hoy no hay herramientas anti forenses que limpien completamente el espacio libre del registro. </p> <p> </p> <p>En la imagen anterior vemos la herramienta Registry Explorer donde aparece en rojo las claves-valor que han sido borradas. M\u00e1s adelante veremos c\u00f3mo funciona esta herramienta. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#last-write-time","title":"Last Write Time","text":"<p>Dentro del registro tambi\u00e9n hay timestamps y se le llama \u201cLast Write Time\u201d. Como bien dice su nombre, es la \u00faltima vez que se modifica la key-value del registro. Para poder interpretar este campo como una fecha real, es necesario realizar pruebas con la aplicaci\u00f3n que escriba en el registro y poder contextualizar la informaci\u00f3n. </p> <p>Otro elemento que indica un orden temporal es el MRU, que es el acr\u00f3nimo de Most Recenty Used. </p> <ul> <li>Existen varios MRU que son responsables del drop-down sobre un men\u00fa que aparece o cuando tecleas algo en Internet Explorer. </li> <li>En el registro, los MRULists son una Key-Value que son responsables de mantener registrado las adiciones al registro. Por lo tanto, se puede determinar en qu\u00e9 orden se a\u00f1adi\u00f3. </li> <li>La MRUList puede variar en funci\u00f3n del sistema operativo. </li> <li>El Last write de la key ser\u00e1 la fecha del primer MRULIst que ocurri\u00f3 </li> </ul> <p>Herramientas para analizar el registro de manera online: </p> <p> </p> <p>Herramientas para Analizar el Registro de manera offline: Registry Explorer </p> <p> </p> <p>Registry Explorer dispone de: </p> <ol> <li>Bookmarks: en funci\u00f3n del registry hive cargado (NTUSER.DAT,SYSTEM,etc), carga unos bookmarks u otros. Son claves del registro que se conocen y contienen informaci\u00f3n \u00fatil. </li> </ol> <p> </p> <ol> <li>Find: permite buscar por el string o regex, filtrando por tiempo, valores m\u00ednimos. </li> </ol> <p> </p> <p>** Ver video: 08-Registry Explorer </p> <p>RegRipper es otra herramienta escrita en Perl que se encarga de analizar los hives del registro. El an\u00e1lisis no es tan user friendly como lo que presenta Registry Explorer, pero tambi\u00e9n dispone de unos bookmarks o plugins de localizaciones de key-value del Registro con informaci\u00f3n relevante: </p> <p>https://github.com/keydet89/RegRipper2.8/tree/master/plugins </p> <p>A diferencia de Registry Explorer, en RegRipper se le debe indicar mediante el campo de Profile cual es el tipo de hive que va analizar. De esta manera cargar\u00e1 los plugins acordemente. </p> <p> </p> <p>El reporte de RegRipper es un fichero de texto que puede ser abierto con Notepad++. ** Ver video: 002-RegRipper </p> <p>Windows Registry Recovery es otro software que permite analizar el registro de Windows, de manera visual. Es muy \u00fatil para obtener qu\u00e9 aplicaciones han sido instaladas, como podemos apreciar en la imagen inferior. </p> <p>En funci\u00f3n del Hive seleccionado, las opciones de la izquierda dispondr\u00e1n de informaci\u00f3n. </p> <p> </p> <p>** Ver Video:09-WRR </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#sam","title":"SAM","text":"<p>El fichero SAM o hive SAM, contiene todos los usuarios y grupos que hay a nivel local en el sistema Windows. Tambi\u00e9n dispone de los hashes pertinentes que son validados cuando un usuario hace logon. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#identificando-usuarios-y-grupos","title":"Identificando Usuarios y Grupos","text":"<p>Del fichero SAM podemos obtener a qu\u00e9 grupo est\u00e1 asignado el usuario, como por ejemplo: </p> <ul> <li>Administradores </li> <li>Usuarios </li> <li>Usuarios del escritorio Remoto </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener del registro SAM del usuario? </p> <p>La informaci\u00f3n se encuentra en SAM\\Domains\\Account\\Users y contiene: </p> <ul> <li>El usuario y el RID asociado a \u00e9l. </li> <li>Variedad de informaci\u00f3n asociado al usuario </li> <li>\u00daltimo login (vac\u00edo si se utiliza una cuenta Microsoft para hacer login) </li> <li>\u00daltimo login fallido </li> <li>Contador de login </li> <li>Pol\u00edtica de passwords </li> <li>Cuando se cre\u00f3 la cuenta. </li> </ul> <p> </p> <p>En la imagen anterior se ve el detalle que el usuario \u201cismis\u201d utiliza una cuenta Microsoft para hacer login, debido a que el campo \u201cLast Logon Time\u201d est\u00e1 vac\u00edo. </p> <p>Con la herramienta WRR se puede identificar correctamente: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#passwords-en-blanco","title":"Passwords en blanco","text":"<p>Windows 10 implementa un cifrado de hashes, que puede inducir a error, si no es analizado correctamente. Si la herramienta no es capaz de interpretar este nuevo cifrado aparecer\u00e1 que el NTLM-HASH es un blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p> <p>Para poder ver los hashes es necesario tener el SAM y el SYSTEM del sistema. Gracias a la herramienta Windows Password Recovery de Passcape podr\u00edamos verificar su hash: </p> <p> </p> <p>Windows Password Recovery si puede leer el nuevo cifrado AES 128 de Windows, mimikatz tambi\u00e9n. </p> <p> </p> <p>Si no lo leyese bien, aparecer\u00eda un hash blanco: 31d6cfe0d16ae931b73c59d7e0c089c0 </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#principales-artefactos-del-registro-de-windows","title":"Principales Artefactos del registro de Windows","text":"<p>A continuaci\u00f3n, vamos a identificar las principales claves-valor del registro que pueden ser susceptibles de ser usadas en caso de realizar una investigaci\u00f3n. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#identificar-la-version-del-sistema","title":"Identificar la versi\u00f3n del sistema","text":"<p>Este artefacto forense, como bien el t\u00edtulo, nos va permitir identificar en el registro la versi\u00f3n del sistema. </p> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion determina: </p> <ul> <li>La versi\u00f3n de Windows </li> <li>Service Pack instalador </li> <li>Fecha de instalaci\u00f3n en formato Epoch Time (n\u00famero de segundos desde el 1/1/1970) </li> <li>En Windows tiene el campo Install Time que sigue el formato de Windows 64 bit, respecto al tiempo </li> </ul> <p> </p> <p>En el registro encontraremos la fecha (Install Time) en decimal, la convertimos a hexadecimal y la pasamos por la herramienta Dcode. </p> <p> </p> <p>DCode: https://www.digital-detective.net/dcode/ </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#nombre-de-la-maquina","title":"Nombre de la m\u00e1quina","text":"<p>Es \u00fatil ya que el nombre de la m\u00e1quina aparece en otras localizaciones pero generalmente se usa para asegurar que estamos trabajando con el equipo correcto. </p> <p>Ruta: System\\ControlSet001\\Control\\ComputerName\\ComputerName </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#zona-horaria","title":"Zona horaria","text":"<p>Es \u00fatil para correlacionar correctamente la actividad en la evidencia: Logs internos del sistema y timestamps estar\u00e1n basadas en esta informaci\u00f3n Antes hab\u00edamos visto los timestamps del registro est\u00e1n en UTC. </p> <p>FAT est\u00e1 asociado a la hora local del sistema y por lo tanto a este par\u00e1metro. NTFS est\u00e1 en UTC. </p> <p>Ruta: System\\ControlSet001\\Control\\TimeZoneInformation </p> <p> </p> <p>Romance Standard Time = Central European TIME: </p> <p>https://en.wikipedia.org/wiki/Central_European_Time** </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#fecha-de-ultimo-acceso","title":"Fecha de \u00faltimo acceso","text":"<p>Por defecto Windows no actualiza la fecha de \u00faltimo acceso. Es una propiedad que se encuentra en el registro: </p> <p>Ruta: System\\ControlSet001\\Control \\Filesystem </p> <ul> <li>Hay que verificar si est\u00e1 activado buscando NtfsDisableLastAccessUpdate = 0 </li> <li>Por defecto viene activada esta opci\u00f3n lo que impide saber cu\u00e1ndo se accedi\u00f3 (Win7-Win10) </li> </ul> <p> </p> <p>Comando para activarlo: fsutil behavior set disablelastaccess 0 </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#interfaces-de-red","title":"Interfaces de Red","text":"<p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Determinar los interfaces de red de la m\u00e1quina </li> <li>Determinar si el sistema tuvo una IP Est\u00e1tica o por DHCP Obtener GUID del interface para hacer correlaciones </li> </ul> <p>Ruta: System\\ControlSet001\\Services\\Tcpip\\Parameters\\Interfaces{GUID_INTERFACE} </p> <p> </p> <p>Esta informaci\u00f3n aparece mucho mejor representada en el WRR: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#historico-de-redes","title":"Hist\u00f3rico de Redes","text":"<p>\u00bfQu\u00e9 podemos encontrar? </p> <ul> <li>Identificar redes a la que el equipo se conect\u00f3 </li> <li>Identificar si las redes eran cableadas o inal\u00e1mbricas </li> <li>Identificar el nombre dominio </li> <li>Identificar el SSID </li> <li>Identificar la MAC Address del gateway </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Unmanaged </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Managed </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Nla\\Cache </li> </ul> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Primera y \u00faltima vez que se produjo la conexi\u00f3n a la red </li> <li>Listar conexiones que han sido conectadas a trav\u00e9s de VPN </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#cuando-se-conecto-a-una-red","title":"Cuando se conect\u00f3 a una Red","text":"<p>Prop\u00f3sito: </p> <ul> <li>Identificar el tipo de red a la que se conect\u00f3 </li> <li>Identificar el SSID de la red inal\u00e1mbrica </li> <li>El timestamp de este artefacto est\u00e1 en local time. </li> </ul> <p>Ruta: </p> <ul> <li>Software\\Microsoft\\WZCSVC\\Parameters\\Interfaces{GUID} -&gt; XP </li> <li>Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles -&gt; Win7-Win10 </li> </ul> <p>Si la maquina es Win7-Win10 el tipo de red (NameType) viene definido de la siguiente manera: </p> <ul> <li>0x47 -&gt; Wireless </li> <li>0x06 -&gt; Cableada </li> <li>0x17 -&gt; 3G </li> </ul> <p>Categor\u00eda: </p> <ul> <li>Public -&gt; 0 </li> <li>Private / Home -&gt; 1 </li> <li>Domain /Work 2 </li> </ul> <p> </p> <p>Podemos identificar tambi\u00e9n DateCreated y DateLastConnected. Usando Windows 128 bit time y est\u00e1 almacenado en local time. </p> <p> </p> <p>Con el ProfileGUID {54ADAF4F-0492-458F-96EA-652ED5ABD35C} podemos mapear informaci\u00f3n hist\u00f3rica. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#carpetas-compartidas","title":"Carpetas Compartidas","text":"<p>\u00bfQu\u00e9 podemos identificar? </p> <ul> <li>Carpetas compartidas a nivel local </li> <li>Configuraci\u00f3n de dichas carpetas compartidas </li> </ul> <p>Ruta: *System\\ControlSet001\\Services\\lanmanserver\\Shares* Flags: </p> <ul> <li>CSCFlags: Caching Setting </li> <li>MaxUses: Usuarios m\u00e1ximos </li> <li>Permissions: Permisos de la carpeta </li> <li>Remark: Comentarios del usuario a\u00f1adidos </li> <li>Type: Tipo de compartici\u00f3n </li> </ul> <p> </p> <p>Client Side Caching </p> <p>Esta opci\u00f3n aparece dentro del CSCFLAGS: Si se comparte la carpeta con el Client Side Caching, si el cliente est\u00e1 desconectado de la red, dispondr\u00e1 de una copia del fichero en su sistema. </p> <p> </p> <p>La copia de estos ficheros se guardan tanto en el cliente como en el servidor en la ruta C:\\Windows\\CSC: </p> <ul> <li>CSCFlag=0 -&gt; Opci\u00f3n por defecto, donde el usuario debe indicar que ficheros quiere cachear </li> <li>CSCFlag=16 -&gt; Cacheo de documentos autom\u00e1ticos. \u201cAll files and programs that users open from the shared folder are automatically available offline\u201d with the \u201coptimize for perforance. </li> <li>CSCFlag=32 Igual que la opci\u00f3n anterior pero con la opci\u00f3n de \u201cOptimizado para rendimiento\u201d </li> <li>CSCFlag=48 Cach\u00e9 deshabilitada. </li> <li>CSCFlag=2048: Opci\u00f3n por defecto en Win7-Win10 hasta que el usuario deshabilita \u201cSimple File Sharing\u201d o utiliza las opciones avanzadas de compartici\u00f3n. Por defecto tambi\u00e9n el \u201cHomegroup\u201d </li> </ul> <p>Maxuses: n\u00famero total de conexiones a una compartici\u00f3n simple. Es un dato para limitar las conexiones. Por defecto 4294967295 para 32 bits. </p> <p>Path: directorio local. </p> <p>Permissions: aparentemente, este valor puede ayudar a determinar c\u00f3mo se comparti\u00f3 una carpeta. 0 es para cuando el valor ha sido creado mediante GUI o Powershell. </p> <ul> <li>Para Windows 7-Windows10, el valor es 9 si fue creado con el advanced file sharing y 63 si fue mediante l\u00ednea de comandos. </li> </ul> <p>Type: tipo de dispositivo o recurso accedido </p> <ul> <li>0 = Disk Drive/ Folder </li> <li>1 = Impresora </li> <li>3 = IPC </li> <li>2147483 = Admin (Disk,Printer, Device o IPC) </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#autostart-programs","title":"AutoStart Programs","text":"<p>\u00bfQu\u00e9 obtenemos? </p> <ul> <li>Determinar qu\u00e9 programas se ejecutan autom\u00e1ticamente </li> <li>\u00datil para localizar malware </li> <li>Determinar la \u00faltima fecha de cu\u00e1ndo se actualiz\u00f3 (generalmente \u00faltimo arranque del sistema) </li> </ul> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Runonce </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run </li> <li>Software\\Microsoft\\Windows\\CurrentVersion\\Run </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#informacion-de-apagado","title":"Informaci\u00f3n de Apagado","text":"<p>Ruta: </p> <ul> <li>System\\ControlSet001\\Control\\Windows (Hora de apagado) </li> <li>System\\ControlSet001\\Control\\Watchdog\\Display (Shutdown count) \u2013 solo XP </li> </ul> <p>Las fechas est\u00e1n en HEX en formato Windows 64 Little Endian </p> <p> </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#busqueda-en-win7","title":"B\u00fasqueda en Win7","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordwheelQuery </p> <p>Aunque Windows vista no tiene almacenados los valores de b\u00fasqueda en el registro, Windows 7/8/10 s\u00ed. </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#busqueda-en-win-8-10","title":"B\u00fasqueda en Win 8 /10","text":"<p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\WordWheelQuery </p> <ul> <li>Como Windows 8/10 pierde el bot\u00f3n de Inicio, las b\u00fasquedas quedan limitadas a la barra de b\u00fasqueda del Explorer. </li> <li>Las b\u00fasquedas son almacenadas en orden temporal. </li> <li>MRU = 0 es la \u00faltima b\u00fasqueda </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#typed-paths-windows-10","title":"Typed Paths Windows 10","text":"<p>Muestra como se ha escrito una ruta en el men\u00fa de inicio o en la barra del Explorer. Es \u00fatil para demostrar que el usuario conoc\u00eda con antelaci\u00f3n la ruta exacta. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recent-docs","title":"Recent Docs","text":"<p>Documentos recientes que han sido abiertos por el usuario desde Windows XP a </p> <p>Win10. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RecentDocs </p> <p> </p> <p>MRU = 0 ser\u00eda el m\u00e1s actual </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#office-recent-docs","title":"Office Recent Docs","text":"<p>Este artefacto forense muestra los documentos ofim\u00e1ticos recientes, abiertos por el usuario: Ruta: NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\FileMRU </p> <ul> <li>14.0 Office 2010 </li> <li>12.0 Office 2007 </li> </ul> <p>NTUSER.DAT\\Software\\Microsoft\\Office{Version}{Excel|Word}\\ UserMRU\\LiveID_###\\FileMRU -&gt; Office 365 </p> <ul> <li>15.0 office 2013 </li> <li>16.0 Office 2016 </li> </ul> <p>La clave FileMRU tendr\u00e1 una lista de los ficheros m\u00e1s recientes de office ordenados del 1-50. </p> <p> </p> <p>Dentro de este artefacto lo interesante es que viene la ruta completa si es comparada con el directorio \u201cRecent Docs\u201d que veremos m\u00e1s adelante. </p> <p>En la misma localizaci\u00f3n dentro de los Office 365 aparece una key llamada PlaceMRU, el cual muestra la localizaci\u00f3n del path previamente abierto en ese directorio. </p> <p>Los 8 bytes que hay a continuaci\u00f3n de la letra T es un timestamp en formato Windows 64 Big Endian. </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#auroguardado-de-ficheros-office","title":"Auroguardado de Ficheros Office","text":"<p>Los ficheros de autoguardado est\u00e1n en la carpeta: </p> <p>Ruta: *C:\\Usuarios\\\\AppData\\Roaming\\Microsoft{Excel|Word|Powerpoint}* <ul> <li>Ficheros con extensi\u00f3n .asd </li> </ul> <p> </p> <p>El fichero se renombra y ya podr\u00eda ser abierto. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#lastvisited-mru-vs-opensavemru","title":"LastVisited MRU vs OpenSaveMRU","text":"<p>Windows tiene cajas de di\u00e1logo que todos los programas usan. </p> <ul> <li>Tenemos dos tipos: </li> <li>LastVisitedMRU </li> <li>OpenSaveMRU </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#lastvisitedmru","title":"LastVisitedMRU","text":"<p>Este artefacto monitoriza qu\u00e9 aplicaci\u00f3n abre o guarda el fichero que hemos visto en el OpenSaveMRU. Te indica la ruta donde abri\u00f3 el fichero y el ejecutable </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU -&gt; WinXP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Last VisitedMRU LasVisitedPidlMRU -&gt; ( Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#opensavemru","title":"OpenSaveMRU","text":"<p>Este artefacto monitoriza los ficheros que han sido abiertos o guardados dentro de una ventana de Windows. Esto no solamente ocurre con los navegadores sino con la mayor\u00eda de las aplicaciones. </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 \\Op enSaveMRU -&gt; Win XP </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ComDlg32 Op enSavePidlMRU -&gt; (Win7-Win10) </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#ultimos-comandos-ejecutados","title":"\u00daltimos Comandos Ejecutados","text":"<p>Este artefacto, muestra los \u00faltimos comandos ejecutados desde el men\u00fa de ejecutar (RunBox): </p> <p> </p> <p>Ruta: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Policies\\RunRU </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#user-assistkey","title":"User AssistKey","text":"<p>Todos los programas con interfaz gr\u00e1fico que son ejecutados desde el escritorio son monitorizados por el launcher de Windows. </p> <p>Ruta: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist{GUID}\\Co unt </p> <p>El GUID es el identificador de la aplicaci\u00f3n que se utiliza. Datos que podemos obtener: </p> <ul> <li>Last Run Time (UTC) </li> <li>Run Count: n\u00famero de veces que se ha ejecutado </li> <li>Nombre de la aplicaci\u00f3n GUI </li> <li>Focus Time: tiempo total que la aplicaci\u00f3n ha tenido el foco. </li> <li>Focus Count: n\u00famero total de veces que la aplicaci\u00f3n sali\u00f3 y entr\u00f3 del foco. </li> </ul> <p>El valor del nombre tambi\u00e9n tiene un significado en los User Assist Keys. El nombre de la clave siempre empezar\u00e1 por UEME_ e ir\u00e1 seguido por: </p> <ul> <li>RUNPATH: path absoluto del ejecutable. Un usuario normalmente ha clicado a trav\u00e9s de la interfaz de Windows Explorer. </li> <li>RUNCPL: para lanzar el panel de control. </li> <li>RUNPIDL: puntero al fichero actual como un fichero LNK. </li> <li>UIQCUT: cuenta las veces que ha sido lanzado a trav\u00e9s del QUICKLaunch </li> <li>UISCUT: cuenta las veces que ha sido lanzado a trav\u00e9s de un acceso directo en el escritorio. </li> <li>UITOOLBAT: informaci\u00f3n sobre los clicks de Windows Explorer ToolBar </li> </ul> <p> </p> <p>Registry Explorer interpreta directamente los valores en la columna Program Name. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#shell-items","title":"Shell Items","text":"<p>\u00bfQu\u00e9 es un shell item? Informaci\u00f3n o fichero que tiene informaci\u00f3n para acceder a </p> <p>otro fichero. </p> <p>Atributos: </p> <ul> <li>Tipo del target donde est\u00e1 el fichero: fijo, extra\u00edble, red </li> <li>Path del fichero target: unidad, etiqueta del volumen </li> <li>Metadatos: MAC timestamps, tama\u00f1o, registro MFT, N\u00famero de secuencia </li> </ul> <p>Tipos: </p> <ul> <li>Accesos directos (LNK) </li> <li>Jumplists </li> <li>Shellbags </li> </ul> <p> </p> <p>Header de LNK </p> <p>Al tener un firma espec\u00edfica se podr\u00eda realizar carving para recuperar los que se hayan borrado. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recent-documents-lnk","title":"Recent Documents (LNK)","text":"<p>Windows crea este shortcut cuando un usuario abre o utiliza un fichero. </p> <p>Ruta: </p> <ul> <li>Win7-Win10: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent  <li>Office: C:\\Users\\\\AppData\\Roaming\\Microsoft\\Office\\Recent  <li>M\u00e1ximo 149 ficheros y directorios </li> <p>Tipos: </p> <ul> <li>1- Fichero Target </li> <li>2- Directorio padre del fichero target </li> </ul> <p>Informaci\u00f3n: </p> <ul> <li>MAC Times del target File </li> <li>Informaci\u00f3n del volumen donde est\u00e1 el target file </li> <li>Directorio del target file </li> </ul> <p>Los archivos podr\u00edan haber sido borrados o eliminados, almacenados en un recurso compartido de red o USB, por lo que, aunque el archivo podr\u00eda ya no estar all\u00ed, seguir\u00e1 existiendo los archivos LNK asociados con el archivo original. Las fechas del sistema de archivos indican: </p> <ul> <li>Fecha de creaci\u00f3n-&gt; la primera vez que se abri\u00f3 </li> <li>Fecha de modificaci\u00f3n -&gt; La \u00faltima vez que se abri\u00f3. </li> </ul> <p> </p> <p>Nuevo funcionamiento de Recent Documents en Windows 10 </p> <ul> <li>Cuando un fichero es creado, tambi\u00e9n se crea su LNK en el RECENT (anteriormente solo cuando se abr\u00eda). Se mantiene las fechas del sistema de archivo. </li> <li>Cuando una carpeta es creada en un directorio, la carpeta, la carpeta padre y la carpeta abuelo son creados como LNK en el RECENT. </li> <li>El mayor cambio es que ahora en los ficheros LNK se incluye la extensi\u00f3n y antes no. </li> </ul> <p>Nuevos tipos de LNK con URLs en Windows 8/10 </p> <p> </p> <p>\u00bfC\u00f3mo se gener\u00f3 este tipo de LNK? </p> <ol> <li>Run Dialog </li> <li>Windows Search Charm </li> <li>A trav\u00e9s de un fichero LNK </li> <li>A trav\u00e9s de un link de una aplicaci\u00f3n </li> </ol> <p>Herramienta para analizar ficheros LNK: LINKPARSER </p> <p> </p> <p>Campos: </p> <ul> <li>Link: son las fechas del destino UTC, es decir, las fechas del sistema de archivos del fichero en s\u00ed. </li> <li>File: son las fechas propias del LNK del UTC </li> <li>El hash MD5 es el del propio LNK, nunca del fichero en s\u00ed. </li> <li>MAC Address del equipo donde est\u00e1 el fichero original. </li> <li>Volume Label: Etiqueta del volumen </li> <li>DriveType: tipo de medio -&gt; muy \u00fatil para dispositivos USB </li> </ul> <p>** Ver Video:10-LinkParser </p> <p>LeCMD: otra herramienta para analizar LNK </p> <p> </p> <p>** Ver Video: 11-LECMD </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#jumplists","title":"Jumplists","text":"<p>Los usuarios pueden \u201csaltar\u201d a los archivos recientemente abiertos. Para las investigaciones forenses proporciona otra ubicaci\u00f3n donde verificar la creaci\u00f3n de ficheros no ejecutables. </p> <p>Esto debe coincidir con el registro de RecentDocs, Recent Docs *ext, Office Recent Docs y los ficheros LNK en el Recent Folder. </p> <p> </p> <p>Hay dos tipos de Jumplists: </p> <ul> <li>autom\u00e1ticos que son creados por cada aplicaci\u00f3n de Windows </li> <li>custom que son creados con el desarrollo espec\u00edfico de la aplicaci\u00f3n. </li> </ul> <p>Los dos se pueden encontrar en el Recent Folder. </p> <p>Dentro de cada fichero JUMPLIST puede haber fechas propias: creaci\u00f3n de la entrada, modificaci\u00f3n de la entrada y \u00faltimo acceso a la entrada. En la imagen superior, para el fichero documento_prueba.docx podr\u00eda tener estas fechas. </p> <p>Automatic destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\AutomaticDes tinations. <p>Contiene una lista de aplicaciones ordenadas por AppID. Los nombres est\u00e1n en el formato XXXXXXXX.autmaticDestinations-ms </p> <ul> <li>Creation Time: Primera fecha de ejecuci\u00f3n (a nivel el sistema de archivos) </li> <li>Modificaci\u00f3n time: \u00faltima fecha de ejecuci\u00f3n de la aplicaci\u00f3n (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>La informaci\u00f3n almacenada en el directorio de Automatic Destinations tiene que tener un \u00fanico archivo con el AppID. </p> <p>Custom Destinations est\u00e1 en el siguiente directorio: </p> <ul> <li>C:\\Users\\\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\CustomDestin ation <p>Son creados por cada aplicaci\u00f3n y por lo tanto \u201ccustom\u201d </p> <p>Un Jumplist customizado est\u00e1 destinado a presentar el contenido que la aplicaci\u00f3n ha establecido como importante basado en el uso previo o a trav\u00e9s de una acci\u00f3n que ha sido indicada por el usuario como importante, tal como a\u00f1adir el \u00edtem a favoritos o anclar la aplicaci\u00f3n a la barra de inicio. Tambi\u00e9n tienen una APPID. </p> <ul> <li>Creation Time (a nivel el sistema de archivos): primera vez de ejecuci\u00f3n. </li> <li>Modificaci\u00f3n time: \u00faltima vez que la aplicaci\u00f3n fue a\u00f1adida al fichero en concreto (a nivel el sistema de archivos) </li> </ul> <p> </p> <p>Los Jumplist evidencian que una aplicaci\u00f3n espec\u00edfica existi\u00f3 y se ejecut\u00f3. </p> <p>Cada Jumplist, sea autom\u00e1tico o custom, tiene su AppID. Este tipo de identificador est\u00e1 asociado a un programa en concreto como vemos en la imagen siguiente: </p> <p> </p> <p>https://www.forensicswiki.org/wiki/Jump_Lists </p> <p>Herramienta para analizar Jumplist: JumpList Explorer </p> <p> </p> <p>** Ver Video: 12-JumplistExplorer </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#shellbags","title":"Shellbags","text":"<p>Los sistemas Windows almacenan las opciones de visualizaci\u00f3n de Windows Explorer mediante entradas de registro y son conocidas como ShellBags. </p> <ul> <li>Esto nos permite saber qu\u00e9 directorio han sido accedidos a nivel local, de red o dispositivos extra\u00edbles. </li> <li>Evidencia la existencia de directorios previos. </li> <li>Localizaci\u00f3n de las Shellbags: </li> </ul> <p>Explorer Access: </p> <ul> <li>USRCLASS.DAT\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\Bags </li> <li>USRCLASS.DAT\\LocalSettings\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> </ul> <p>Desktop Access: </p> <ul> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\BagMRU </li> <li>NTUSER.DAT\\Software\\Microsoft\\Windows\\Shell\\Bags </li> </ul> <p>Los documentos de Microsoft tienen Shellbags adicionales y est\u00e1n presentes en los sistemas Win7-Win10 </p> <p>La existencia de dicha entrada en el registro prueba que usuario especific\u00f3 visit\u00f3 al menos una vez ese directorio. </p> <p>Para analizar los shellbags, vamos a utilizar Shelbag Explorer: </p> <p> </p> <p>Respecto a los timestamps: </p> <ul> <li>En azul corresponde con los MAC times del sistema de archivos de la carpeta PPT </li> <li>En rojo es la informaci\u00f3n propia de shellbag, donde indica la \u00faltima interacci\u00f3n con la carpeta PPT y cu\u00e1l fue la primera. </li> <li>Tambi\u00e9n indica el sistema de archivos sobre el que estaba la carpeta. </li> </ul> <p>** Ver Video:13-ShellbagExplorer </p> <p>Hasta ahora hemos dicho: </p> <ul> <li>Evidenciar que se ha ejecutado mediante el an\u00e1lisis del UserAssist </li> <li>Evidenciar que se ha \u201ctocado\u201d realizando un timeline del sistema de archivos o del registro. </li> <li>Evidenciar que directorios has abierto mediante el an\u00e1lisis de Shellbags. </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#dispositivos-usb","title":"Dispositivos USB","text":"<p>Los dispositivos de almacenamiento USB son muchas veces objetos de investigaci\u00f3n, debido a que son utilizados para copiar ficheros/carpetas. \u00bfQu\u00e9 informaci\u00f3n podemos obtener siempre de un dispositivo USB? </p> <ul> <li>Vendor/Make/Versi\u00f3n </li> <li>N\u00famero de serie \u00fanico </li> </ul> <p>\u00bfQu\u00e9 informaci\u00f3n podemos obtener relacionada con un dispositivo de almacenamiento USB? </p> <ul> <li>Determinar la unidad asignada y el nombre del volumen </li> <li>Encontrar el usuario que utiliz\u00f3 ese dispositivo USB </li> <li>Descubrir la primera vez que el dispositivo USB fue conectado </li> <li>Determinar la \u00faltima vez que el dispositivo USB fue conectado </li> <li>Determinar cuando el dispositivo fue quitado del sistema </li> </ul> <p>\u00bfCu\u00e1les son los artefactos forenses que podemos utilizar para identificar la copia de un fichero a un dispositivo de almacenamiento USB? </p> <ol> <li>Windows Registry Hives: </li> <li>System </li> <li>Software </li> <li>Ntuser.dat </li> <li>Setupapi.dev.log </li> <li>Shell Items </li> <li>Jumplists </li> <li>LNK Files </li> <li>ShellBags </li> </ol>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#mass-storage-device","title":"Mass Storage Device","text":"<p>Tambi\u00e9n conocidos como dispositivos de almacenamiento (USB Mass Storage). En Windows son montados autom\u00e1ticamente siempre que el sistema de archivos sea compatible con Windows. </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#picture-transfer-protocol","title":"Picture Transfer Protocol","text":"<p>Desarrollado por el International Imaging Industry Association. Un dispositivo PTP en </p> <p>Windows: </p> <ul> <li>No tiene acceso al sistema de archivos </li> <li>Solo tiene acceso a im\u00e1genes y archivos de video </li> <li>Dispone Exploraci\u00f3n limitada y l\u00f3gica del contenido </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#media-transfer-protocol","title":"Media Transfer Protocol","text":"<p>\u00bfQu\u00e9 caracter\u00edsticas tiene el MTP? </p> <ul> <li>Mejora y extensi\u00f3n del PTP. </li> <li>No tiene acceso al sistema de archivos. </li> <li>Acceso a la tarjeta interna y SD. </li> <li>Dentro de Windows es montado como un dispositivo portable </li> </ul> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#identificar-evidencias-de-uso-dispositivos-usb","title":"Identificar evidencias de uso dispositivos USB","text":"<p>MSC USB </p> <p>Creaci\u00f3n de ficheros LNK para todos los ficheros que hayan sido abiertos </p> <ul> <li>Windows Recent Folder </li> <li>Microsoft Office Recent Folder </li> <li>Jumplist: Automatic Destinations </li> </ul> <p>MTP USB </p> <p>Windows puede o no puede crear ficheros LNK. Depende de la aplicaci\u00f3n y del tipo de archivo. Algunos MTP LNK no apuntan a la fuente MTP pero apunta al WPDNSE folder: C:\\users\\\\Appdata\\Local\\Temp\\WPDNSE{GUID} <p> </p> <p>Los ficheros DOC no apuntan a la fuente original sino a un directorio temporal. Solo ocurre con los documentos office. </p> <ul> <li>Los ficheros JPG si dejan un LNK verdadero a la fuente original. </li> <li>Los ficheros PDF, TXT y XLS no producen ning\u00fan fichero LNK. </li> </ul> <p>\u00bfQu\u00e9 contiene el directorio temporal WPDNSE? </p> <ul> <li>Mantiene una copia del fichero </li> <li>El directorio es temporal y no sobrevive a un reinicio </li> <li>El GUID se saca de una Shellbag</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#usbstor","title":"USBStor","text":"<p>El registro USBstor, se encarga de monitorizar cualquier dispositivo USB que haya sido conectado a la m\u00e1quina: </p> <p>Ruta: SYSTEM\\ControlSet001\\Enum\\USBSTOR </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <ul> <li>Se puede identificar al fabricante, el producto y la versi\u00f3n de un dispositivo MSC que est\u00e1 conectado a la m\u00e1quina. </li> <li>Identificar un \u00fanico dispositivo USB que ha sido conectado a la m\u00e1quina. </li> <li>Determinar el tiempo por el cual el dispositivo estaba conectado a la m\u00e1quina </li> <li>Identificar el n\u00famero de serie f\u00edsico del dispositivo USB. </li> </ul> <p> </p> <p>En rojo el n\u00famero de serie del dispositivo. En azul el Device Class ID. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#identificacion-de-vidpid","title":"Identificaci\u00f3n de VID/PID","text":"<p>Para localizar estos valores debemos de recurrir a SYSTEM\\ ControlSet001\\Enum\\USB: </p> <ul> <li>VID: Vendor ID </li> <li>PID: Product ID </li> </ul> <p> </p> <p>VID:0930 y PID:6544 </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#obtener-el-nombre-del-volumen","title":"Obtener el nombre del volumen","text":"<p>Ruta: SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices Aplica para MSC, </p> <p>MTP y PTP. </p> <ul> <li>Se relaciona el dispositivo USB F\u00edsico, que dispone de un n\u00famero de serie con un nombre de Volumen. </li> <li>El nombre del volumen puede ser mapeado a una unidad mediante los ficheros LNK </li> </ul> <p> </p> <p> </p> <p>Para las capturas de imagen anteriores, el nombre del volumen es DATA. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#obtener-la-ultima-unidad-asignada","title":"Obtener la \u00faltima unidad asignada","text":"<p>Solo MSC que sean discos de almacenamiento externos aplica la siguiente casu\u00edstica para la ruta del registro: System\\MoutedDevices. </p> <p>Los dispositivos particionados con MBR dejan una firma de 4 bytes, en el registro, la clave MoutedDevices. Para el particionado en GPT deja el GUID del tipo de partici\u00f3n. 89 </p> <p>La firma del MBR se encuentra el primer sector en el offset 0X1B8 o 440 del disco </p> <p> </p> <p> </p> <p>Tambi\u00e9n podemos obtener la \u00faltima unidad asignada analizando la clave de registro System\\MoutedDevices: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#localizar-el-usuario-que-ha-utilizado-el-usb","title":"Localizar el usuario que ha utilizado el USB","text":"<ol> <li>El primer paso es localizar el GUID del Volumen en SYSTEM\\mountedDevices. Localizando el n\u00famero de serie dentro del mismo. </li> </ol> <p>\\??\\Volume{2e1ce865-c747-11e8-add4-34238779763e} </p> <ol> <li>Y luego este GUID asociarlo al NTUSER.DAT del usuario: NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Mountpoin </li> </ol> <p>ts2 </p> <p> </p> <p>Ha sido encontrado dentro del NTUSER.DAT del usuario ismis. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#volume-serial-number","title":"Volume Serial Number","text":"<p>El volumen serial number, es el n\u00famero de serie del volumen l\u00f3gico del sistema de archivos: </p> <ul> <li>No confundir con el n\u00famero de serie f\u00edsico del dispositivo. </li> <li>Solo dispositivos MSC </li> </ul> <p>Ruta: Software\\Microsoft\\Windows NT\\CurrentVersion\\EMDMgmt </p> <p> </p> <p>\u00bfPor qu\u00e9 es \u00fatil? </p> <p>Sabiendo el nombre del volumen y el serial number del volumen pueden correlacionar la informaci\u00f3n con los ficheros LNK y la clave de registro RecentDocs </p> <p>Este artefacto depender\u00e1 de si el servicio ReadyBoost est\u00e1 habilitado o no. \u00bfQu\u00e9 informaci\u00f3n hay en EMDMgmt Key? </p> <ul> <li>Fabricante, ID y Serial number </li> <li>Volume Name del sistema de archivos, muy \u00fatil para relacionar con los LNK. </li> </ul> <p>\u00bfQu\u00e9 pasar\u00eda si el dispositivo USB es reformateado? Un formateo solo escribe los datos necesarios para tener de nuevo un sistema de archivos \u201climpio\u201d. No realiza ning\u00fan borrado. </p> <ul> <li>Tendr\u00edamos un nombre de volumen nuevo </li> <li>Tendr\u00edamos un nuevo volumen serial number </li> <li>Pero se mantiene el serial number f\u00edsico del dispositivo. </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#timestamps","title":"Timestamps","text":"<p>Primera y \u00faltima vez que se conect\u00f3 al dispositivo Ruta: </p> <p>*System\\ControlSet001\\Enum\\USBSTOR{VEN_PROD_VERSION}{USB serial}\\Properties{83da6326-97\u00aa6-4088-9453-a1923f573b29}* </p> <ul> <li>Win7 y Win8 -&gt; Primera conexi\u00f3n -&gt; 0064 </li> <li>Win8 en adelante -&gt; Ultima conexi\u00f3n -&gt; 0066 </li> <li>Win8 en adelante -&gt; Fecha de desconexi\u00f3n con independencia de si es quitado con seguridad o sin ella. -&gt; 0067 </li> </ul> <p> </p> <p>Timestamps 64 bits Hex Windows Time Little Endian pero Registry Explorer los interpreta: </p> <ul> <li>0064: 10/3/2018 8:06:48 PM +00:00 </li> <li>0066: 10/3/2018 8:24:46 PM +00:00 </li> <li>0067: 10/3/2015 9:17:12 PM +00:00 </li> </ul> <p>Tambi\u00e9n podemos analizar el fichero SetupApi.dev.log para obtener timestamps de cuando se produjo la conexi\u00f3n USB: </p> <p>Ruta: </p> <ul> <li>XP -&gt; C:\\Windows\\setupapi.log </li> <li>Win7-Win10 -&gt; C:\\Windows\\inf\\setupapi.dev.log </li> </ul> <p>Los timestamps est\u00e1n local time. </p> <p> </p> <p>Tambi\u00e9n podemos utilizar los eventos del sistema para localizar los timestamps, a partir de Windows 7 / 8 / 10. Lo veremos m\u00e1s adelante. </p> <p>Herramientas para realizar todos estos pasos de manera autom\u00e1tica: USB Detective </p> <p> </p> <p>** Ver Video:14-USB Detective </p> <p>Los datos concuerdan con lo que hemos analizado anteriormente. Incluso el VSN o volumen serial number no ha sido capaz de encontrarlo como nosotros.</p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#email-forensics","title":"Email Forensics","text":"<p>\u00bfQu\u00e9 informaci\u00f3n podemos encontrar analizando un email? </p> <ul> <li>\u00bfQui\u00e9n envi\u00f3 el email? -&gt; direcci\u00f3n de correo, direcci\u00f3n IP, pruebas de contexto </li> <li>\u00bfCu\u00e1ndo fue enviado? -&gt; Timestamp en la cabecera, timestamp de los servidores </li> <li>\u00bfDesde donde fue enviado? Direcci\u00f3n IP / ISP, Geolocalizaci\u00f3n, Mail server domain, Message ID </li> <li>\u00bfEs el contenido relevante?. Message Body, Adjuntos, libreta de direcciones, Entradas de calendario</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#cabecera-de-correo-electronico","title":"Cabecera de correo electr\u00f3nico","text":"<p>Podemos encontrar en la cabecera la fecha de cuando se envi\u00f3 el correo electr\u00f3nico, el message ID, el destinatario, el remitente. </p> <p>---&gt; Header  </p> <p>---&gt; Cuerpo </p> <p>---&gt; Adjunto </p> <p>Tambi\u00e9n podemos saber cu\u00e1ndo fue recibido el correo electr\u00f3nico por el servidor SMTP mediante el campo: \u201cReceived\u201d </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#message-id","title":"Message ID","text":"<p>El message ID lo proporciona el servidor que env\u00eda el email y consiste en un \u00fanico identificador a\u00f1adido al nombre del servidor con la @. </p> <p>Este campo puede ser utilizado para identificar mensajes relacionados gracias al tag References y In-Reply-To: </p> <p> </p> <p> </p> <p> </p> <p>En la conversaci\u00f3n anterior, se puede ver el hist\u00f3rico de Message ID que hay. Esto indica que debe haber tambi\u00e9n cuatro mensajes. Uno por cada Message ID. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#mapi-headers","title":"Mapi Headers","text":"<p>Si est\u00e1s realizando una investigaci\u00f3n donde hay un servidor Exchange o clientes tales como Microsoft Outlook, debes ser consciente que las propiedades MAPI (Microsoft Messaging Application Programing Interface) estar\u00e1n presentes. Son unas cabeceras adicionales que nos van a permitir extraer m\u00e1s informaci\u00f3n de un simple correo electr\u00f3nico: </p> <ul> <li>Mapi-Client-Submit-Time: la fecha del sistema local cuando el email fue enviado por el cliente. </li> <li>Mapi-Conversation-Index: indica cu\u00e1ntos mensajes hijos fueron parte de la cadena de emails y registra los timestamps para cada mensaje en la cadena. </li> <li>Mapi-Entry-ID: un identificador de mensaje dentro del almacenamiento como PST. Puede ayudar a identificar si un usuario dispon\u00eda de varios ficheros PSTs. </li> <li>Mapi-Message-Flags y Pr_last_Verb_Executed: proporciona informaci\u00f3n detallada de las acciones que ocurrieron en un Cliente MAPI: Le\u00eddo, sin leer, respondidos, reenviados, fuera de la oficina </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#outlook-pst","title":"Outlook PST","text":"<p>El cliente de correo por excelencia de sistemas Windows, es Microsoft Outlook. Todos los mensajes enviados, recibidos, contactos y calendario se almacenan en un fichero PST. </p> <p>Fichero almacenado por defecto: </p> <ul> <li>%USERPROFILE%\\LocalSettings\\ApplicationData\\Microsoft\\Outlook (WinXP y anteriores) </li> <li>%USERPROFILE%\\AppData\\Local\\Microsoft\\Outlook -&gt; Win7 / Win8 y en adelante </li> </ul> <p>La clave de registro nos puede indicar qu\u00e9 archivos est\u00e1n siendo utilizados. </p> <ul> <li>HKEY_CURRENT_USER\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Windo ws Messagin Subsystem\\Profiles\\Outlook </li> <li>El Archivo tiene un tama\u00f1o m\u00e1ximo de 50 GB </li> </ul> <p>Si no lo encontr\u00e1semos, deber\u00edamos buscar por extensi\u00f3n o realizar t\u00e9cnica de recuperaci\u00f3n de datos, ya que el fichero PST dispone de cabecera conocida. Se podr\u00eda realizar mediante Photorec. </p> <p>Herramienta para ver ficheros PST: Kernel PST Viewer </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#outlook-ost","title":"Outlook OST","text":"<p>Microsoft Outlook genera un fichero OST cuando la cuenta ha sido configurada mediante IMAP o mediante Exchage. Al igual que en PST, almacena mensajes enviados, recibidos, contactos, calendario. El buz\u00f3n local (fichero OST) de mensajes est\u00e1 sincronizado con el servidor. </p> <ul> <li>\u00daltimos 12 meses de email por defecto </li> <li>Fichero m\u00e1ximo de 50gb </li> <li>La ruta es la misma que el fichero PST </li> <li>Se puede realizar t\u00e9cnicas de carving para recuperarlo </li> </ul> <p>Herramienta: Kernel OST Viewer </p> <p> </p> <p>** Ver video: 15 - Kernel OST Viewer </p> <p>Hay que tener en cuenta que se puede recuperar un fichero OST/PST del sistema de archivos porque se haya borrado, o recuperar emails borrados de dentro del fichero OST/PST. En el caso de ficheros OST, existe una herramienta de pago: https://www.kerneldatarecovery.com/ost-recovery.html </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-adjuntos","title":"Recuperaci\u00f3n de Adjuntos","text":"<p>Microsoft Outlook utiliza un Directorio temporal seguro para abrir los adjuntos de los mensajes de correo electr\u00f3nico: </p> <ul> <li>%APPDATA%\\Local\\Microsoft\\Windows\\TemporaryInternetFiles\\Content.Outlook -&gt; IE10 </li> <li>%APPDATA%\\Local\\Microsoft\\InetCache\\Content.Outlook -&gt; IE11+ </li> </ul> <p>Antes de la versi\u00f3n de Outlook 2007, los mensajes quedan guardados siempre. </p> <p>Despu\u00e9s de la versi\u00f3n de Outlook 2007 en adelante, los adjuntos est\u00e1n, mientras que el correo electr\u00f3nico est\u00e9 abierto o quedar\u00eda en esa carpeta si Outlook es cerrado correctamente. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#thunderbird-mbox","title":"Thunderbird MBOX","text":"<p>El cliente de correo Thunderbird almacena la informaci\u00f3n en ficheros MBOX. Estos ficheros pueden ser encontrados en la siguiente ruta: </p> <p>\\Users\\%USERNAME%\\AppData\\Roaming\\Thunderbird\\Profiles </p> <p>Para poder leer este fichero MBOX sin la necesidad de Thunderbird podemos recurrir a Autopsy. Creamos un nuevo caso como hemos visto anteriormente, pero esta vez, en vez de a\u00f1adir una imagen forense vamos a\u00f1adir un fichero, en este caso el fichero MBOX. </p> <p> </p> <p>Despu\u00e9s seleccionamos el \u201cEmail Parser\u201d para que pueda extraer los emails contenidos en el fichero MBOX </p> <p> </p> <p>Este M\u00f3dulo, es capaz tambi\u00e9n de leer ficheros PST y OST. Una vez que haya terminado de analizar el fichero MBOX podremos acceder a los correos en la siguiente secci\u00f3n: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#thumbnails","title":"Thumbnails","text":"<p>Cuando un usuario previsualiza una carpeta de tal manera que la organiza mediante thumbnails, se crea un fichero oculto \u201cthumbs.db\u201d que almacena la preview de im\u00e1genes en hay en la carpeta, incluso si las im\u00e1genes fueron borradas. </p> <p>Thumbs.db </p> <ul> <li>WinXP/Win8-8,1 -&gt; Creado autom\u00e1ticamente </li> <li>*Win7/Win10 -&gt; Autom\u00e1tica creado si es accedido v\u00eda UNC Path -&gt; \\ruta\\ruta* </li> </ul> <p>\u00bfQu\u00e9 hay en el Thumbs.db? </p> <ul> <li>Imagen peque\u00f1a de la imagen original incluso si es borrada </li> <li>\u00daltima fecha de modificaci\u00f3n -&gt; Windows XP </li> <li>Nombre original -&gt; Windows XP </li> </ul> <p>Herramienta que analiza el fichero Thumbs.db: Thumbsviewer </p> <p> </p> <p>thumbsviewer.github.io </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#thumbcache","title":"Thumbcache","text":"<p>El Thumcache, es la evoluci\u00f3n del thums.db. Su funcionamiento es el mismo. </p> <p> </p> <p>Ruta: C:\\Users\\\\AppData\\Local\\Microsoft\\Windows\\Explorer <ul> <li>Solo Thumbnails </li> <li>Localizaci\u00f3n de donde estuvo ese thumbnail </li> <li>Solo para Windows 7 / 8 / 10 </li> </ul> <p>En la carpeta anterior, se encuentran los preview de las im\u00e1genes en funci\u00f3n del tama\u00f1o. De esta manera se adapta a los requisitos del usuario. </p> <ul> <li>Thumbcache_32.db -&gt; small </li> <li>Thumbcache_96.db -&gt; medium </li> <li>Thumbcache_256.db -&gt; large </li> <li>Thumbcache_1024.db -&gt; extra large </li> </ul> <p>Herramienta ThumbCache Viewer</p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#papelera-de-reciclaje","title":"Papelera de Reciclaje","text":"<p>Carpeta oculta del sistema que contiene un subdirectorio con el SID del usuario. EL SID del usuario lo podemos obtener el fichero SAM. </p> <p>RECYCLER -&gt; 2000/NT/XP/2003 </p> <ul> <li>Archivo oculto llamado INFO2 </li> <li>Contiene la fecha de borrado y el nombre del archivo original </li> </ul> <p>$Recycle.bin -&gt; Vista/Win7/Win8/Win10 </p> <ul> <li>El archivo es ASCII y UNICODE </li> <li>La fecha del borrado y el nombre del fichero original borrado est\u00e1n en ficheros distintos </li> <li>$I -&gt; Informaci\u00f3n del fichero (fecha de borrado) </li> <li>$R -&gt; el contenido del fichero </li> </ul> <p>Solo los ficheros que son borrados desde el Explorer de Windows, van a esta localizacion. No es un borrado como tal, ya que los ficheros se encuentran disponibles. </p> <p>Si el usuario realiza SHIFT + borrado el fichero no pasa por la papelera de reciclaje. </p> <p>A nivel del sistema de archivos, el fichero original es movido a la papelera de reciclaje y renombrado con $R{nombre} y se crea un fichero con $I{nombre} que contiene la fecha del \u201cborrado\u201d. El borrado real, se proceder\u00e1 de verdad cuando la papelera se haya vaciado. </p> <p>Herramienta para procesar la papelera: Rifiuti. </p> <p> </p> <p>Dos versiones de la herramienta en funci\u00f3n del sistema operativo: </p> <p> </p> <p>** Ver Video:16-Rifitui </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#ejecucion-de-programas","title":"Ejecuci\u00f3n de programas","text":"<p>En esta secci\u00f3n vamos a ver todos los artefactos forenses que indiquen la ejecuci\u00f3n de un programa. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#windows-prefetch","title":"Windows Prefetch","text":"<p>La misi\u00f3n de Windows Prefetch es incrementar el rendimiento del sistema con una precarga del ejecutable. El cache manager monitoriza todos los ficheros y directorios y los mapea contra el fichero .pf (el fichero .pf ser\u00e1 el artefacto forense que analizaremos) </p> <ul> <li>Deshabilitado en sistemas con disco SSD </li> <li>Muestra c\u00f3mo y cu\u00e1ndo un binario se ejecut\u00f3 </li> </ul> <p>Ruta: C:\\Windows\\Prefetch </p> <ul> <li>Limitado a 128 ficheros en XP/VISTA/WIN7 </li> <li>Limitado a 1024 ficheros en Win8/Win10 </li> <li>{Nombre_ejecutable}-{hash}.pf </li> <li>Windows 10 los prefetch vienen comprimidos </li> <li>El hash est\u00e1 basado en el path del ejectuable y los argumentos que reciben </li> </ul> <p>Ruta: C:\\Windows\\Prefetch\\Layout.ini </p> <ul> <li>El fichero layout.ini contiene los nombres de los directorios de los ficheros que est\u00e1n en el Prefetch </li> <li>El desfragmentador de disco utiliza el layout.ini para realojar todos los directorios y ficheros en un \u00e1rea contigua del disco. </li> </ul> <p>\u00bfQu\u00e9 indica este artefacto forense? </p> <ul> <li>N\u00famero de ejecuciones (hasta 8 veces puede registrar) </li> <li>Fechas de las ejecuciones (UTC) </li> <li>El propio fichero, ya indica la ejecuci\u00f3n del programa </li> <li>Ficheros abiertos por el programa </li> </ul> <p>Herramienta para analizar los Prefetch: PeCMD </p> <p> </p> <p>Resultado de ejecutar PeCMD </p> <p> </p> <p>** Ver V\u00eddeo Prefetch - 011 </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#superfetch","title":"SuperFetch","text":"<p>Superfetch consiste en una serie de bases de datos localizados en la carpeta C:\\Windows\\Prefetch\\Ag*.db, que tienen como misi\u00f3n optimizar el uso de memoria. No reemplaza al servicio Prefetch </p> <p> </p> <p>\u00bfQu\u00e9 podemos obtener? </p> <ul> <li>Nombre de la aplicaci\u00f3n </li> <li>N\u00famero de ejecuciones </li> <li>Ficheros necesarios que son utilizados por el binario. </li> <li>Volumen accedido </li> <li>Path completo </li> <li>TimeFrames </li> <li>Timestamp </li> </ul> <p>Herramienta para analizar el Superfetch: CrowdResponse </p> <p> </p> <p>https://www.crowdstrike.com/resources/community-tools/crowdresponse/ </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#srum","title":"SRUM","text":"<p>System Resource Usage Monitor (SRUM) es un artefacto forense que est\u00e1 destinado a monitorizar los recursos que consume un proceso. </p> <p>Ruta: C:\\Windows\\System32\\sru\\SRUDB.dat </p> <ul> <li>A partir de Windows 8 </li> <li>Es una Base de datos en formato ESE </li> </ul> <p>Se ha llegado a identificar hasta 60 d\u00edas de monitorizaci\u00f3n y nos puede indicar: </p> <ul> <li>AppID y Path  </li> <li>Usuario que ejecuta </li> <li>Bytes enviados </li> <li>Bytes recibidos </li> <li>Interfaz de red </li> <li>Tiempo de conexi\u00f3n </li> <li>Tiempo de duraci\u00f3n </li> </ul> <p>El Prefetch indica el arranque de un proceso, pero no la duraci\u00f3n: </p> <p> </p> <p>Ejemplo del proceso: Explorer.exe </p> <p>La actividad es actualizada cada 60 min en la base de datos o durante un apagado correcto </p> <p> </p> <p>Si realizamos un apagado incorrecto hay que reparar la base de datos ESE mediante el comando: esentul /mh SRUDB.dat </p> <p>Herramienta que nos permite analizar el fichero SRUDB.dat: SRUM DUMP </p> <p> </p> <p>** Ver Video:17-SRUM </p> <p>Lo resultados de ejecutar la herramienta SRUM DUMP, donde se identifica el proceso junto con su timestams y los bytes que ha enviado y recibido: </p> <p> </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#appcompatcache-shimcache","title":"AppCompatCache (ShimCache)","text":"<p>Se encarga de chequear la compatibilidad de la aplicaci\u00f3n dentro del sistema operativo. Verifica si la aplicaci\u00f3n necesita aplicarse ciertas propiedades en el actual sistema operativo o funcionar viejos sistemas operativos. </p> <p>Appcompatcache monitorizar\u00e1 del ejecutable: </p> <ul> <li>Fecha de \u00faltima modificaci\u00f3n: $STANDARD_INFORMATION </li> <li>Path donde se encuentra </li> <li>Y si fue ejecutado </li> </ul> <p>Si la aplicaci\u00f3n sufre una modificaci\u00f3n o actualizaci\u00f3n, ser\u00e1 nuevamente actualizada Ruta: </p> <ul> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\Appcompatibility\\Appco mpat Cache -&gt; XP -&gt; 96 entradas </li> <li>SYSTEM\\CurrentControlSet\\Control\\SessionManager\\AppcompatCache\\AppCo mp atCache -&gt; Server 2003 (512 entradas) y 2008/2012/2016 \u2013 Win7/Win8/Win10 (1024 entradas) </li> </ul> <p>Cuando se modifican las propiedades de una aplicaci\u00f3n, se crean entradas en el registro. Todo programa (.exe, .bat,.dll) es chequeado con la base de datos para buscar una compatibilidad. Este es el artefacto forense que encontramos.</p> <p>Solo se actualiza cuando el sistema es apagado y no antes. </p> <ul> <li>Eventos m\u00e1s recientes est\u00e1n al principio </li> <li>Nuevos eventos se escriben al ser apagado. </li> </ul> <p>\u00bfQu\u00e9 podemos evidenciar? </p> <p> </p> <p>Herramienta que permite analizar el AppCompatCache: AppCompatCache (ShimCache) Parser </p> <p> </p> <p>** Ver video:18- Shimcache </p> <p>Resultado de ejecutar AppCompatCache y llevarlo a TimelineExplorer: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#amcachehve","title":"Amcache.hve","text":"<p>Artfacto forense, que es un registro en s\u00ed mismo con la siguiente ruta: C:\\Windows\\AppCompat\\Programas\\Amcache.hve (Windows 7/8/8.1/10 y 2012/2016) </p> <ul> <li>Keys: Amcache.hve\\Root\\File{Volume GUID}###### -&gt; Para el Formato Antiguo </li> <li>Hay una entrada por cada ejecuci\u00f3n, informaci\u00f3n del directorio, fecha \u00faltima modificaci\u00f3n $StandarInfo y el volumen desde el que ejecut\u00f3 (GUID de volumen) </li> <li>La primera vez que se ejecut\u00f3: \u00faltima modificaci\u00f3n de la clave de registro </li> <li>El SHA1 del ejecutable tambi\u00e9n est\u00e1 en el registro </li> </ul> <p>Lo analizamos con la Herramienta AmcacheParser: </p> <p> </p> <p>** Ver Video: 19-Amcache </p> <p>Resultado de la ejecuci\u00f3n AmCacheParser: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recentfilecache","title":"RecentFileCache","text":"<p>Este artefacto solo se encuentra en Windows 7 y en la siguiente ruta: C:\\Windows\\AppCompat\\Programs\\RecentFileCache.bcf </p> <p>Contiene la ejecuci\u00f3n de binarios m\u00e1s reciente en el sistema Windows 7. Para ver de manera m\u00e1s detallada c\u00f3mo se crea este artefacto forense: </p> <p>http://journeyintoir.blogspot.com/2013/12/revealing-recentfilecachebcf-file.html Para analizar este artefacto utilizaremos la herramienta RecentFileCacheParser: </p> <p> </p> <p>Como siempre, deberemos extraer previamente el artefacto forense mediante Access Data FTK de la ruta anteriormente indicada para que esta herramienta sea capaz de interpretar y analizar. Abrimos un CMD para ejecutar la herramienta e indicarle donde se encuentra el artefacto extra\u00eddo: </p> <p> </p> <p>Finalmente abrimos el fichero CSV generado. Hay que tener cuidado que la extensi\u00f3n es un TSV, es decir un fichero generado por tabulaciones. </p> <p> </p> <p>Lo abrimos con OpenOffice, cambi\u00e1ndole la extensi\u00f3n a \u201cCSV\u201d. </p> <p> </p> <p>Finalmente disponemos una tabla con la ejecuci\u00f3n de los binarios.</p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#tareas-programadas","title":"Tareas Programadas","text":"<p>Un malware o backdoor puede utilizar las tareas programadas como mecanismo de </p> <p>persistencia </p> <p>Ruta: C:\\Windows\\Tasks o C:\\Windows\\System32\\Tasks </p> <p> </p> <p>Podemos extraerlas con Arsenal Image Mounter las tareas para analizarlas. Aunque no tengan extensi\u00f3n, una vez extra\u00eddas se puede abrir con el Notepad y verlas como un fichero XML: </p> <p> </p> <p>La fecha de cuando se a\u00f1adi\u00f3, la podemos sacar de las propiedades del sistemas de archivos, gracias a FTK Imager: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#servicios","title":"Servicios","text":"<p>Los servicios del sistema operativo, los podemos encontrar en la siguiente clave de registro: Ruta: SYSTEM\\ControlSet001\\Services </p> <p>Lo analizamos con Registry Explorer </p> <p> </p> <p>Campos por destacar: </p> <ul> <li>Display Name: nombre del servicio </li> <li>Start mode: el tipo de arranque </li> <li>Image Path: ejecutable con los argumentos que recibe </li> <li>Name Key Last Write: \u00faltima vez que se actualizo la clave del registro </li> <li>Parameters Key Last Write: \u00faltima vez que se cambiaron los par\u00e1metros </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-de-windows","title":"Eventos de Windows","text":"<p>El registro de eventos de Windows proporciona una gran cantidad de informaci\u00f3n la cual puede ayudar a un investigador a juntar las piezas relevantes sobre las acciones ocurridas en el sistema. </p> <p>Los eventos son recolectados y almacenados por el Servicio de Registro de Eventos. De manera similar a otros artefactos forenses, es provechoso realizar el ejercicio mental de determinar cu\u00e1les preguntas pueden responder los datos del registro de eventos. </p> <p> </p> <p>\u00bfQu\u00e9 podemos obtener de los eventos de Windows? </p> <ol> <li>\u00bfQu\u00e9 ocurri\u00f3? (Identificador del Evento, Categor\u00edas del Evento, Descripci\u00f3n) </li> </ol> <p>Los registros de eventos pueden ser complicados para un usuario normal, pero est\u00e1n dise\u00f1ados para proporcionar informaci\u00f3n muy espec\u00edfica sobre las actividades ocurridas en el sistema. </p> <ol> <li>\u00bfCu\u00e1l fue el d\u00eda y la hora? (Marcas de Tiempo) </li> </ol> <p>Las marcas de tiempo son una parte clave de los registros de eventos, pues proporcionan un contexto temporal para los eventos. Con sistemas registrando miles de eventos, las marcas de tiempo pueden tambi\u00e9n ayudar al investigador a acercar su enfoque. </p> <ol> <li>\u00bfQui\u00e9nes son los usuarios involucrados? (Cuenta de Usuario, Descripci\u00f3n) </li> </ol> <p>Cualquier cosa hecha dentro de Windows es realizada dentro del contexto de una cuenta. Se puede identificar referencias hacia usuarios espec\u00edficos, como tambi\u00e9n a informaci\u00f3n sobre las actividades del sistema operativo Windows realizadas mediante una cuenta especial como System o NetworkService. </p> <ol> <li>\u00bfCu\u00e1les son los sistemas involucrados? (Nombre del Host, Direcci\u00f3n IP) </li> </ol> <p>En un entorno de red, es muy com\u00fan encontrar referencias hacia otros sistemas aparte del host, como recursos siendo accedidos remotamente. Originalmente s\u00f3lo el nombre Netbios era registrado, haciendo el rastreo y la atribuci\u00f3n mucho m\u00e1s dif\u00edcil. En sistemas m\u00e1s recientes, la direcci\u00f3n IP es registrada dentro del registro de eventos (Cuando aplica). </p> <ol> <li>\u00bfCu\u00e1les recursos se accedieron? (Archivos, Carpetas, Impresoras, Servicios) </li> </ol> <p>El Servicio de Registro de Eventos puede ser configurado para almacenar informaci\u00f3n muy granular relacionada a la utilizaci\u00f3n de varios objetos del sistema. Con casi todos los recursos considerados como un objeto, esto proporciona una muy poderosa auditor\u00eda. Como un ejemplo; puede ayudar a identificar intentos de acceso no autorizado hacia los archivos del sistema. </p> <p>Los eventos de Windows, centralizan el registro logs del sistema e informaci\u00f3n sobre: </p> <ul> <li>Software </li> <li>Hardware </li> <li>Funciones del sistema operativo </li> <li>Seguridad </li> </ul> <p>A nivel del sistema de archivos, los podemos encontrar en las siguientes rutas. </p> <p> </p> <p>Como podemos observar tenemos dos tipos de eventos: Event log en formato Binario (antes de Windows Vista) </p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extensi\u00f3n en (.evt) </li> </ul> <p>Event log en formato XML (de Windows Vista en adelante) </p> <ul> <li>Sistema </li> <li>Aplicaci\u00f3n </li> <li>Seguridad </li> <li>Extension (.evtx) </li> <li>200 tipos de ficheros m\u00e1s que el formato antiguo </li> <li>Ahora incluyen direcciones IP </li> </ul> <p>Las localizaciones de los ficheros de eventos las podemos localizar en el registro SYSTEM en la siguiente ruta: </p> <p>HKLM\\SYSTEM\\CurrentControlSet\\Services\\EventLog{Application|System|Security} </p> <p> </p> <p>Existen tambi\u00e9n otros tipos de eventos que no son del sistema operativo Windows, como aplicaciones de terceros, Exchange, Sysmon, SQL Server. </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-de-seguridad","title":"Eventos de Seguridad","text":"<p>Los eventos de seguridad son solo actualizados por el proceso LSASS (Local Security Authority Subsystem Service). Se encuentran en C:\\Windows\\System32\\winevt\\Security.evtx </p> <p>Solo con permisos de administrador se pueden ver, exportar o eliminar. Tienen un tama\u00f1o m\u00e1ximo, pero es configurable como vemos a continuaci\u00f3n: </p> <p> </p> <p>Normalmente, el escenario es que veremos, es que, una vez alcanzado el tama\u00f1o asignado, se sobrescribir\u00e1 los eventos m\u00e1s viejos, es decir un fichero circular. </p> <p>\u00bfQu\u00e9 podemos identificar en los eventos de seguridad? </p> <ul> <li>Login logoff </li> <li>Conducta del usuario y acciones </li> <li>Acceso a Archivos, Directorios y recursos compartidos </li> <li>Modificaciones de la configuraci\u00f3n de seguridad </li> </ul> <p>Los eventos est\u00e1n identificados por ID, y en funci\u00f3n de ese identificador podremos identificar que ha ocurrido. En la siguiente web podemos encontrar una descripci\u00f3n exhaustiva de todos los identificadores: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#eventos-relacionados-con-la-autenticacion-del-usuario","title":"Eventos relacionados con la autenticaci\u00f3n del usuario","text":"<p>Eventos de relacionados con la autenticaci\u00f3n del usuario del sistema Windows: </p> EventID Descripci\u00f3n 4624 Evento de autenticaci\u00f3n satisfactorio 4625 Evento de fallido de autenticaci\u00f3n 4634/4647 Log off 4672 Logon con permisos de administrador Ejemplo de evento 4625 <p> </p> <p>Ejemplo de evento 4634 Log OFF </p> <p> </p> <p>Ejemplo de evento 4672 logon especial\u00e7 </p> <p> </p> <p>Dentro del Evento 4624/4625 encontramos los siguientes subtipos: </p> <ul> <li>2 -&gt; Interactive: este tipo de autenticaci\u00f3n involucra la utilizaci\u00f3n del teclado y pantalla del sistema, o la utilizaci\u00f3n de terceras herramientas remotas como VNC o PSexec -U- </li> <li>3 -&gt; Network: conexi\u00f3n a una carpeta compartida del propio equipo . </li> <li>4 -&gt; Batch: tambi\u00e9n v\u00e1lido para las tareas programadas, donde los procesos son ejecutados en nombre de otro. </li> <li>5 -&gt; Service: servicios arrancados por el Service Control Manager </li> <li>7 -&gt; Desbloqueo de pantalla con password </li> <li>8 -&gt; Network Cleartext: el usuario se ha autenticado en la m\u00e1quina desde la red pero sus credenciales no han sido hasheadas. Este tipo de evento suele provenir de la autenticaci\u00f3n realizada mediante Internet Information Services (IIS), servidor Web de Microsoft. </li> <li>9 -&gt; NewCredentials: es generado cuando se ejecuta un comando con RunAs desde la CMD o se conecta con una unidad de red, con credenciales distintas a las de la propia sesion. </li> <li>10 -&gt; Remote Interactive: este tipo de autenticaci\u00f3n se produce cuando una autenticaci\u00f3n se realiza mediante Terminales Services o Remote Desktop Protocol. </li> <li>11 -&gt; CachedInteractive: se autentica con las credenciales \u00faltimas cacheadas ya que no ha sido posible contactar con el controlador de dominio. </li> </ul> <p>Ejemplo de evento 4624 tipo 2: </p> <p> </p> <p>Dentro del evento 4625 se puede indicar el tipo de error al autenticarse mediante los estados y subestados: </p> <p> </p> <p>Ejemplo de evento 4625 con subestados: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#recuperacion-de-eventos-de-windows","title":"Recuperaci\u00f3n de eventos de Windows","text":"<p>Los eventos del sistema los podemos visualizar desde la propia gesti\u00f3n de eventos o Event Viewer de Windows (eventvwr.msc) o podemos utilizar una herramienta que nos permita trabajar tanto de manera live como de manera post-mortem. </p> <p>Event-Log Explorer </p> <p> </p> <p>** Ver Video: 20-Eventos del Sistema </p> <p>Se podr\u00eda utilizar t\u00e9cnicas de carving para poder recuperar este tipo de ficheros, pero siempre es muy importante desde que se produce el incidente que la m\u00e1quina sea apagada/tirada del cable para que la probabilidad de recuperaci\u00f3n de este tipo de ficheros aumente tal y como se demuestra en el siguiente enlace. </p> <p>https://rawsec.lu/blog/posts/2017/Jun/23/carving-evtx/ </p> <p>La herramienta que nos va permitir realizar carving de este tipo de ficheros es Bulk_extractor. Tal y como vimos su funcionamiento en la parte de carving, bastar\u00eda con proporcionarle una imagen f\u00edsica o l\u00f3gica y marcar el esc\u00e1ner como se muestra en la imagen de a continuaci\u00f3n: </p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.3.Principales_artefactos_en_sistemas_windows/#analisis-de-casuisticas-mas-comunes-en-cuanto-a-seguridad","title":"An\u00e1lisis de casu\u00edsticas m\u00e1s comunes en cuanto a seguridad.","text":"<p>A continuaci\u00f3n veremos las situaciones m\u00e1s comunes que podremos identificar mediante eventos del sistema. </p> <ol> <li>BruteForce Attack </li> </ol> <p>Un ataque de fuerza bruta se podr\u00e1 realizar mediante el intento de autenticaci\u00f3n del usuario hasta que consiga acceso al sistema. Veremos muchos eventos 4625 y a continuaci\u00f3n un 4624 </p> <p> </p> <ol> <li>Remote Desktop Protocol </li> </ol> <p>El remote Desktop Protocol, es el protocol de Windows para poder conectarse a otra m\u00e1quina, mediante credenciales, es decir, un escritorio remoto. </p> <p>En el Security Event Log: </p> <ul> <li>Sesi\u00f3n conectada: Event ID 4778 (incluye direcci\u00f3n IP y Hostname) </li> <li>Sesi\u00f3n desconectada: Event ID 4779 (incluye direcci\u00f3n IP y Hostname) </li> <li>Autenticaci\u00f3n Satisfactoria Event ID 4624 Tipo ( 10 y 7 para reconexi\u00f3n) </li> </ul> <p>Logs auxiliares: </p> <ul> <li>Remote Desktop Services \u2013 RDPCoreTS (Event ID 131) </li> <li>TerminalServices-RemoteConnectionManager%40Operational) (Event ID 1149) </li> <li>Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx (Event ID 21 y 22) </li> </ul> <p>Conexi\u00f3n Satisfactoria </p> <p>Conexi\u00f3n satisfactoria mediante escritorio remoto </p> <p> </p> <p>Ejemplo de evento 1149 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 4624 tipo 7: </p> <p> </p> <p>Ejemplo de evento 21 con IP Origen: </p> <p> </p> <p>Ejemplo de evento 22 con IP Origen: </p> <p> </p> <p>Conexi\u00f3n no satisfactoria </p> <p>La autenticaci\u00f3n no satisfactoria mediante RDP </p> <p> </p> <p>Evento 4625 tipo 2: </p> <p> </p> <p>Conexi\u00f3n LogOFF </p> <p>Desconexi\u00f3n de la consola de escritorio remoto mediante log off solicitado por el usuario. </p> <p> </p> <p>Reconexi\u00f3n </p> <p>Conexi\u00f3n de nuevo con la consola de escritorio remoto </p> <p> </p> <p>Sesi\u00f3n desconectada </p> <p>Sesi\u00f3n desconectada, cerrando la ventana de escritorio remoto </p> <p> </p> <ol> <li>Cambio de Hora </li> </ol> <p>El cambio de hora de un sistema, es una de las peores situaciones que se puede dar para un investigador ya que todos los timestamps quedan modificados: </p> <p>Al hacer un cambio de hora se produce el Evento 4616 dentro de Security.evtx </p> <p> </p> <ol> <li>Dispositivos USB </li> </ol> <p>A parte de todos los artefactos que hemos visto anteriormente para la identificaci\u00f3n de USBs, tambi\u00e9n podemos utilizar los eventos de System: </p> <ul> <li>20001 /20003 contiene cuando se insert\u00f3 por primera vez. </li> <li>10000 contiene cuando se insert\u00f3 por primera vez </li> <li>10100 contiene el log de cuando se actualiz\u00f3 el driver. </li> </ul> <p>Ejemplo de evento 20001 </p> <p> </p> <p>Tambi\u00e9n se puede localizar el n\u00famero de serie en la anterior captura junto con la marca y modelo, en el evento 20003 </p> <p> </p> <p>Eventos de Microsoft-Windows-DeviceSetupManager%4Admin.evtx </p> <ul> <li>Event ID 112: contiene el timestamp de cada dispositivo USB insertado en el sistema. Para correlar, es necesario conocer el ContainderID del USBSTOR key del registro que vimos previamente. </li> </ul> <p> </p> <p>El Container ID concuerda con lo que se vio en la parte de Registro: </p> <p> </p> <ol> <li>Apagado/arranque del Sistema </li> </ol> <p>Identificaci\u00f3n del arranque del Sistema mediante el arranque del servicio \u201cEvent Log\u201d en el evento 6005 </p> <p> </p> <p>Identificaci\u00f3n del apagado del sistema mediante la parada del servicio \u201cEvent Log\u201d mediante el evento 6006 </p> <p> </p> <p>Identificaci\u00f3n de un apagado inesperado mediante el evento 6008: </p> <p> </p> <p>Identificaci\u00f3n del tiempo que lleva encendido del sistema: </p> <p> </p> <p>Apagado del servicio \u201cEvent Log\u201d mediante el evento id 1100 en Security </p> <p> </p> <ol> <li>Vaciado de Logs </li> </ol> <p>Vaciado del fichero Security.evtx, identificado mediante el evento id 1102 </p> <p> </p> <p>Para m\u00e1s informaci\u00f3n de eventos de Windows se puede utilizar la siguiente p\u00e1gina: https://www.ultimatewindowssecurity.com </p>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/","title":"Principales artefactos en sistemas Linux","text":""},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-son-los-logs-de-linux","title":"\u00bfQu\u00e9 son los logs de Linux?","text":"<p>Los registros del sistema o logs son archivos de texto que registran cronol\u00f3gicamente la totalidad de actividades e incidencias importantes que ocurren en el sistema operativo, incluidos el kernel, los servicios y las aplicaciones que se ejecutan. Los sistemas operativos GNU Linux registran absolutamente todo lo que pasa en el sistema operativo mediante los logs. La totalidad de logs de nuestro equipo los registran y gestionan los demonios journald y/o rsyslogd.</p>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#journald-vs-rsyslogd-similitudes-y-diferencias","title":"Journald vs rsyslogd: Similitudes y diferencias","text":"<ul> <li>Journald.</li> <li>Rsyslogd.</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-registran-los-logs-de-linux","title":"\u00bfQue registran los logs de Linux?","text":"<p>Algunos ejemplos de la informaci\u00f3n que contienen los logs en Linux son los siguientes:</p> <ul> <li>Los paquetes que se instalan y desinstalan en el sistema operativo.</li> <li>Informaci\u00f3n sobre los accesos remotos a nuestro equipo.</li> <li>Los intentos fallidos de autenticaci\u00f3n de los usuarios al equipo.</li> <li>Registro de errores que se dan en los programas o servicios que usamos.</li> <li>Los accesos o salidas bloqueadas por nuestro firewall.</li> </ul> <p>Como vemos, los logs en Linux son una fuente b\u00e1sica para saber qu\u00e9 est\u00e1 pasando en nuestro equipo. Por lo tanto, todo administrador de sistemas deber\u00eda saber c\u00f3mo consultar los logs para de este modo:</p> <ul> <li>Detectar la causas de los problemas que puede tener un equipo o servidor.</li> <li>Registrar y detectar ataques inform\u00e1ticos por parte de un hacker.</li> <li>Detectar comportamientos an\u00f3malos de programas o servicios.</li> <li>Ver el rendimiento de un ordenador o servidor.</li> <li>Averiguar qu\u00e9 ocurri\u00f3 en una determinada actualizaci\u00f3n de un equipo.</li> </ul> <p>Los logs son igualmente esenciales a la hora de gestionar un incidente de ciberseguridad, nos aportar\u00e1n informaci\u00f3n muy importante tanto para resolver un incidente, como para prevenirlo anticipando los problemas que se avecinan gracias a una monitorizaci\u00f3n de los mismos.</p>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#como-se-clasifican-los-logs-de-linux","title":"\u00bfC\u00f3mo se clasifican los Logs de Linux?","text":"<p>Simplificando al m\u00e1ximo los logs en Linux se pueden clasificar del siguiente modo:</p> <ul> <li>Logs de sistema: Generalmente generados por el demonio Rsyslogd. Registran informaci\u00f3n relacionada con el funcionamiento del sistema operativo. Algunos ejemplos de logs de sistema son los que registran informaci\u00f3n sobre los servicios, los que registran los accesos al equipo, los mensajes del sistema, etc.   Englobamos en esta categor\u00eda, eventos de sistema, servicios y eventos.</li> <li>Logs de aplicaciones: Son aquellos que registran cronol\u00f3gicamente los eventos m\u00e1s importantes mientras estamos usando una aplicaci\u00f3n o programa. En este caso, los logs pueden ser generados por la propia aplicaci\u00f3n o por Rsyslogd.</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#localizacion-de-los-logs","title":"Localizaci\u00f3n de los logs","text":"<p>Pr\u00e1cticamente la totalidad de logs se almacenan en las siguientes ubicaciones:</p> <ul> <li>En el directorio /var/log.</li> <li>En los subdirectorios de /var/log.   No obstante, es posible que algunas aplicaciones guarden los logs en otras ubicaciones del sistema operativo.</li> </ul> <pre><code>rv3@slimbook:/$ ls -a /var/log\n.                       boot.log.5      firebird                syslog.7.gz\n..                      boot.log.6      fontconfig.log          teamviewer15\nalternatives.log        boot.log.7      gdm3                    tor\nalternatives.log.1      bootstrap.log   gpu-manager.log         ubuntu-advantage.log\nalternatives.log.10.gz  btmp            gpu-manager-switch.log  ubuntu-advantage.log.1\nalternatives.log.11.gz  btmp.1          guymager.log            ubuntu-advantage-timer.log\nalternatives.log.12.gz  cups            hp                      ubuntu-advantage-timer.log.1\nalternatives.log.2.gz   dist-upgrade    installer               ubuntu-advantage-timer.log.2.gz\nalternatives.log.3.gz   dmesg           journal                 ubuntu-advantage-timer.log.3.gz\nalternatives.log.4.gz   dmesg.0         kern.log                ubuntu-advantage-timer.log.4.gz\nalternatives.log.5.gz   dmesg.1.gz      kern.log.1              ubuntu-advantage-timer.log.5.gz\nalternatives.log.6.gz   dmesg.2.gz      kern.log.2.gz           ubuntu-advantage-timer.log.6.gz\nalternatives.log.7.gz   dmesg.3.gz      kern.log.3.gz           unattended-upgrades\nalternatives.log.8.gz   dmesg.4.gz      kern.log.4.gz           vbox-setup.log\nalternatives.log.9.gz   dpkg.log        lastlog                 vbox-setup.log.1\nanydesk.trace           dpkg.log.1      mysql                   vbox-setup.log.2\napache2                 dpkg.log.10.gz  nordvpn                 vbox-setup.log.3\napt                     dpkg.log.11.gz  openvpn                 vbox-setup.log.4\nauth.log                dpkg.log.12.gz  private                 vmware\nauth.log.1              dpkg.log.2.gz   slimbookbattery.log     vmware-installer\nauth.log.2.gz           dpkg.log.3.gz   speech-dispatcher       vnetlib\nauth.log.3.gz           dpkg.log.4.gz   syslog                  wtmp\nauth.log.4.gz           dpkg.log.5.gz   syslog.1                Xorg.0.log\nboot.log                dpkg.log.6.gz   syslog.2.gz             Xorg.0.log.old\nboot.log.1              dpkg.log.7.gz   syslog.3.gz             Xorg.1.log\nboot.log.2              dpkg.log.8.gz   syslog.4.gz             Xorg.1.log.old\nboot.log.3              dpkg.log.9.gz   syslog.5.gz\nboot.log.4              faillog         syslog.6.gz\n\n</code></pre>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-contienen-los-logs-del-sistema-y-como-podemos-consultarlos","title":"\u00bfQu\u00e9 contienen los logs del sistema y c\u00f3mo podemos consultarlos?","text":"Ubicaci\u00f3n del log Datos registrados en el log y funcionalidad Comando para consultar el log /var/log/auth.log Proporciona un registro de todas las actividades que implican un proceso de autenticaci\u00f3n. Por ejemplo registra los usuarios logueados al sistema operativo. Registra el d\u00eda, hora, usuario y \u00f3rdenes que se han ejecutado con el comando sudo, los cronjobs que se han ejecutado, los intentos fallidos de autenticaci\u00f3n, etc. sudo less /var/log/auth.log /var/log/debug Para registrar datos de los programas que est\u00e1n actuando en modo depuraci\u00f3n. De esta forma los programadores pueden obtener informaci\u00f3n si sus programas est\u00e1n funcionando adecuadamente. sudo less /var/log/debug /var/log/syslog Contiene la totalidad de logs capturados por rsyslogd. Por lo tanto en este fichero encontraremos multitud de logs y ser\u00e1 dif\u00edcil de consultar y filtrar. Por este motivo, los logs se distribuyen en otros ficheros siguiendo la configuraci\u00f3n del fichero /etc/rsyslog.conf. sudo less /var/log/syslog /var/log/kern.log: Proporciona informaci\u00f3n detallada de mensajes del kernel. Por ejemplo si hab\u00e9is compilado un kernel y ten\u00e9is problemas podr\u00e9is ver los mensajes de error y advertencias en kern.log. Tambi\u00e9n puede ser \u00fatil para intentar detectar y solucionar problemas con la detecci\u00f3n de hardware. sudo less /var/log/kern.log /var/log/dmesg Dentro del fichero encontraremos informaci\u00f3n relacionada con el hardware de nuestro equipo. Por lo tanto podremos obtener informaci\u00f3n para concluir si nuestro hardware funciona de forma adecuada. Si nuestra distribuci\u00f3n no contase con este registro, podr\u00edamos hacer uso del comando \u201cdmesg\u201d que nos mostrar\u00e1 en su salida la misma informaci\u00f3n. dmesg | less /var/log/messages Contiene mensajes informativos y no cr\u00edticos de la actividad del sistema operativo. Acostumbra a contener los errores que se registran en el arranque del sistema que no est\u00e9n relacionados con el Kernel. Por lo tanto, si no se inicia un servicio, como por ejemplo el servidor de sonido, podemos buscar informaci\u00f3n dentro de este archivo. sudo less /var/log/messages /var/log/faillog Registra los intentos fallidos de autenticaci\u00f3n de cada usuario. Dentro del archivo se almacena una lista de usuarios, los fallos totales de cada usuario, el n\u00famero de fallo m\u00e1ximos que permitimos y la fecha y hora del \u00faltimo fallo. Si un usuario supera el n\u00famero de fallos m\u00e1ximos establecidos se deshabilitar\u00e1 el usuario por el tiempo que nosotros fijemos. faillog /var/log/btmp Almacena los intentos fallidos de logins en un equipo. Si alguien realizar\u00e1 un ataque de fuerza bruta a un servidor ssh, el fichero registrar\u00eda la IP del atacante, el d\u00eda y hora en que ha fallado el login, el nombre de usuario con que se ha intentado loguear, etc. sudo utmpdump /var/log/btmp sudo last -f /var/log/btmp | more /var/log/lastlog Ayuda a ver la fecha y la hora en que cada usuario se ha conectado por \u00faltima vez. lastlog | less /var/log/wtmp En todo momento contiene los usuarios que est\u00e1n logueados al sistema operativo. who /var/log/boot.log Informaci\u00f3n relacionada con el arranque del sistema. Podemos consultarlo para analizar si se levantan los servicios del sistema, si se levanta la red, si se montan las unidades de almacenamiento, para averiguar un problema que hace que nuestro equipo no inicie, etc. sudo /var/log/boot.log /var/log/cron Registra la totalidad de informaci\u00f3n de las tareas realizadas por cron. Si tienen problemas con la ejecuci\u00f3n de tareas tienen que consultar este log para ver si el trabajo se ha ejecutado o da errores. Debian no dispone de este log, pero encontrar\u00e1n la misma informaci\u00f3n en /var/log/syslog. En Debian pueden configurar el fichero de configuraci\u00f3n /etc/rsyslog.conf para generar un log espec\u00edfico para cron. sudo less /var/log/cron.log /var/log/daemon.log Registra la actividad de los demonios o programas que corren en segundo plano. Para ver si un demonio se levant\u00f3 o est\u00e1 dando errores podemos consultar este log. Dentro de daemon.log encontraremos informaci\u00f3n sobre el demonio que inicia el gestor de inicio, el demonio que inicia la base de datos de MySQL, etc. sudo less /var/log/daemon.log /var/log/dpkg.log Contiene informaci\u00f3n sobre la totalidad de paquetes instalados y desinstalados mediante el comando dpkg. sudo less /var/log/dpkg.log /var/log/apt/history.log Detalle de los paquetes instalados, desinstalados o actualizados mediante el gestor de paquetes apt-get. sudo less /var/log/apt/history.log"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#que-contienen-los-logs-de-aplicaciones-y-como-podemos-consultarlos","title":"\u00bfQu\u00e9 contienen los logs de aplicaciones y c\u00f3mo podemos consultarlos?","text":"<p>Del mismo modo que en el apartado anterior, a continuaci\u00f3n veremos:</p> <ul> <li>Los logs de las aplicaciones o programas m\u00e1s importantes.</li> <li>La informaci\u00f3n que almacenan cada uno de los logs y para qu\u00e9 puede sernos \u00fatil.</li> <li>Los comandos que tenemos que usar para consultar cada uno de los logs.</li> </ul> Ubicaci\u00f3n de log Datos registrados en el log y funcionalidad Comando para consultar el log /var/log/rkhunter.log Registra la totalidad de resultados obtenidos por rkhunter. rkhunter es una utilidad que analiza el sistema en busca de puertas traseras, rootkits, etc. Dentro del log de este programa encontraremos informaci\u00f3n sobre lo que ha detectado rkhunter en su an\u00e1lisis. sudo less /var/log/rkhunter.log /var/log/samba/. Dentro de la ubicaci\u00f3n /var/log/samba encontrar\u00e1n distintos logs que registran los eventos que han ocurrido en nuestro servidor samba. Algunos de los registros que encontrar\u00e1n son sobre creaciones de directorios, renombrado de archivos, ficheros creados y borrados, registros de conexiones y desconexiones al servidor, etc. sudo less /var/log/samba/samba.log (Los logs de Samba requieren ser configurados. La ubicaci\u00f3n de los logs depende del sistema operativo que usemos) /var/log/cups/. error_log, page_log y access_log contienen informaci\u00f3n acerca las horas en que una IP se ha conectado al servidor, el usuario que se ha conectado al servidor, los errores y advertencias del servidor, la fecha en que se ha imprimido un determinado documento, el n\u00famero de copias, etc. Para m\u00e1s informaci\u00f3n sobre el contenido de los logs de cups pueden consultar el siguiente enlace. sudo less /var/log/cups/error_log sudo less /var/log/cups/access_log sudo less /var/log/cups/page_log /var/log/lighttpd/. access.log y error.log contienen informaci\u00f3n sobre las visitas y errores que se generan cuando un usuario visita una p\u00e1gina web montada sobre un servidor lighttpd. sudo less /var/log/lighttpd/access.log sudo less /var/log/lighttpd/error.log /var/log/apache2/access.log /var/log/httpd/access_log Contiene informaci\u00f3n de los usuarios que han accedido al servidor web Apache. En este fichero encontraremos datos como las p\u00e1ginas que ha visitado una determinada IP, la hora en que una IP nos ha visitado, etc. sudo less /var/log/apache2/access.log sudo less /var/log/httpd/access_log /var/log/apache2/error.log /var/log/httpd/error_log Es el encargado de registrar la totalidad de errores cuando se procesan las solicitudes de los visitantes al servidor web Apache. sudo less /var/log/apache2/error.log sudo less /var/log/httpd/error_log /var/log/prelink/ Contiene informaci\u00f3n sobre las modificaciones que la utilidad prelink realiza a los binarios y librer\u00edas compartidas. sudo less /var/log/prelink/ /var/log/mysql/mysql.log Registro de la totalidad de sentencias que los clientes env\u00edan al servidor sudo less /var/log/mysql/mysql.log /var/log/mysql/error.log Registra los errores o problemas detectados al iniciar, ejecutar o parar el servicio. Por lo tanto en el caso que MySQL o MariaDB no se inicien deberemos acceder a este fichero para obtener informaci\u00f3n del problema. sudo less /var/log/mysql/error.log /var/log/mysql/mysql-slow.log Encontraremos informaci\u00f3n acerca de las sentencias que han tardado m\u00e1s segundos que los especificados en la variable del sistema long_query_time. De esta forma podremos conocer las sentencias SQL que se ejecutan de forma lenta. sudo less /var/log/mysql/mysql-slow.log /var/log/fail2ban.log Registra el d\u00eda y la hora en que una determinada IP ha sido bloqueada y desbloqueada al intentar acceder a un determinado servicio. sudo less /var/log/fail2ban.log /var/log/openvpn.log La hora en la que una determinada IP se ha conectado al servidor OpenVPN. Si quieren registrar los intentos fallidos de autenticaci\u00f3n tambi\u00e9n pueden usar fail2ban. sudo less /var/log/openvpn.log /var/log/openvpn-status.log Contiene informaci\u00f3n de los usuarios conectados al servidor OpenVPN. Ejemplos de la informaci\u00f3n que contiene es la IP de cada uno de los usuarios, La cuenta de usuario con que se ha conectado una determinada IP, la hora en que cada usuario ha iniciado la conexi\u00f3n, etc. sudo less /var/log/openvpn-status.log /var/log/letsencrypt/letsencrypt.log Contiene todo tipo de informaci\u00f3n acerca de los certificados de let\u2019s Encrypt. Por ejemplo si se han producido errores en la renovaci\u00f3n de los certificados ser\u00e1 \u00fatil consultar este log. sudo less /var/log/letsencrypt/letsencrypt.log"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#otros-directorios-de-interes","title":"Otros directorios de inter\u00e9s","text":"<ul> <li>/var/log/lighttpd/</li> <li>/var/log/mail/</li> <li>/var/log/mysqld.log</li> <li>/etc/rsyslog.d/ - /etc/rsyslog.conf</li> <li>/var/log/audit/</li> <li>/var/lib/dhcp/dhcpd.lease =&gt; DHCP usa \u00e9ste fichero para almacenar la base de datos lease del cliente. Este fichero, nos va a ayudar a completar la topolog\u00eda de la red.</li> <li>/home/username/.bash_history =&gt; Guarda los comandos ejecutados en bash por un usuario en particular.   .mysql_history =&gt; El cliente mysql guarda en este fichero un hist\u00f3rico de todas las sentencias ejecutadas.</li> <li>/home/user/.ssh/authorized_keys =&gt; Especifica las claves SSH que se pueden usar para iniciar sesi\u00f3n en la cuenta de usuario para la que est\u00e1 configurado el archivo.</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#como-consultar-el-contenido-de-los-logs","title":"\u00bfC\u00f3mo consultar el contenido de los logs?","text":"<p>En apartados anteriores existen tablas en que se detallan los comandos a usar para consultar cada uno de los logs de nuestro sistema operativo. Si las consultan ver\u00e1n que podremos consultar la gran mayor\u00eda de logs mediante las siguientes utilidades:</p> <ul> <li>locate: Nos permite localizar la ubicaci\u00f3n de un archivo en el sistema.</li> <li>cat: Muestra por pantalla el contenido del fichero.</li> <li>less: Utilidad que permite leer ficheros de texto en Linux.</li> <li>zless: Comando que permite visualizar ficheros comprimidos por el sistema de rotaci\u00f3n de logs.</li> <li>tail: Utilidad que sirve para mostrar las 10 \u00faltimas l\u00edneas de un log o fichero de texto.</li> <li>head: Programa para visualizar las 10 primeras l\u00edneas de un log o fichero de texto.</li> <li>grep: Nos permite filtrar el contenido de un fichero buscando una secuencia de caracteres dada.   Etc.</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.4.Principales_artefactos_en_sistemas_Linux/#referencias","title":"Referencias","text":"<ul> <li>Qu\u00e9 son, c\u00f3mo funcionan y qu\u00e9 utilidad tienen los logs en Linux</li> <li>12 Critical Linux Log Files You Must be Monitoring</li> <li>Create your own Log Analysis Environment\u2014 (Forensic)</li> <li>Performing Linux Forensic Analysis and Why You Should Care!</li> <li>Linux Forensics Tricks</li> <li>Practical Linux Forensics</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/","title":"An\u00e1lisis de memoria","text":"<p>El an\u00e1lisis forense de la memoria es el proceso de capturar la memoria en ejecuci\u00f3n de un dispositivo y luego analizar la salida capturada en busca de evidencias que nos ayuden a resolver nuestro caso. A diferencia del an\u00e1lisis forense de disco, en el que se clona el sistema de archivos de un dispositivo y todos los archivos del disco se pueden recuperar y analizar, el an\u00e1lisis forense de la memoria se centra en que se estaba ejecutando en un dispositivo cuando se captur\u00f3 el volcado de memoria.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#que-son-los-datos-volatiles","title":"\u00bfQu\u00e9 son los datos vol\u00e1tiles?","text":"<p>Los datos vol\u00e1tiles son todos los datos que se almacenan temporalmente y se perder\u00edan si se desconectara la energ\u00eda del dispositivo que los contiene.</p> <p>Los datos vol\u00e1tiles son de gran importancia en la inform\u00e1tica forense, sobre todo en la respuesta a incidentes. Cuando tratamos con de un dispositivo comprometido, una de las primeras reacciones puede ser apagar el dispositivo para contener la amenaza. El problema con este enfoque es que si por ejemplo tenemos un malware en ejecuci\u00f3n en el dispositivo se ejecutar\u00e1 en la memoria.</p> <p>Por lo tanto, al apagar el dispositivo se perder\u00e1n todas las conexiones de red y los procesos en ejecuci\u00f3n. Estos datos vol\u00e1tiles no se escriben en el disco y cambian constantemente en la memoria, por lo que apagar el dispositivo significa que se ha destruido evidencia valiosa.</p> <p>La contenci\u00f3n de la red (aislar el dispositivo del resto de la red) es la opci\u00f3n preferida cuando se a\u00edsla un dispositivo comprometido. De esa forma contendremos el incidente, conservaramos una evidencia valiosa y no destruiremos los datos vol\u00e1tiles que tenemos en memoria.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#que-es-un-volcado-de-memoria","title":"\u00bfQu\u00e9 es un volcado de memoria?","text":"<p>Un volcado de memoria o volcado de RAM es una \"instant\u00e1nea\" de la memoria.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#que-podemos-encontrar-en-los-datos-volatiles","title":"\u00bfQue podemos encontrar en los datos vol\u00e1tiles?","text":"<p>Los datos vol\u00e1tiles pueden contener informaci\u00f3n muy valiosa para nuestra investigaci\u00f3n.</p> <p>Por ejemplo, podr\u00edamos encontrar actividad en el sistema o en internet que nos ayude a demostrar que se han realizado actividades ilegaes o, por ejemplo, si se accedi\u00f3 a archivos o a un dispositivo externo en esa fecha, lo que puede ayudar a proporcionar evidencia en casos relacionados con el robo de datos.</p> <p>Tambi\u00e9n poddemos econtrar evidencias interesantes relacionadas con una cuenta online de correo electr\u00f3nico, por ejemplo, cuentas de Hotmail o Gmail o de la actividad de las redes sociales, como la mensajer\u00eda de Facebook, que normalmente tambi\u00e9n se almacena en datos vol\u00e1tiles.</p> <p>Otros ejemplos de informaci\u00f3n que podemos encontrar en la memoria volatil:</p> <ul> <li>Procesos en ejecuci\u00f3n</li> <li>Conexiones de red activas y cerradas.</li> <li>El historial de navegaci\u00f3n.</li> <li>Archivos en el sistema.</li> <li>Documentos.</li> <li>Lista de comendos en el CMD de windows o terminal de Linux.</li> <li>El contenido del portapapeles.</li> <li>hash de contrase\u00f1as.</li> <li>Claves y certificados SSL.</li> </ul>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#herramientas-para-analisis-de-memoria","title":"Herramientas para an\u00e1lisis de memoria","text":"<p>En los \u00faltimos a\u00f1os han surgido varias herramientas gratuitas para realizar an\u00e1lisis de la memoria, y a d\u00eda de hoy siguen surgiendo, lamentablemente muchas de ellas han sido abandonadas, como es el caso de Rekall.</p> <p>Es por ello que en esta secci\u00f3n nos vamos a centrar en una herramienta, Volatility.</p> <p> </p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility","title":"Volatility","text":"<p>Volatility es una herramienta forense de memoria gratuita desarrollada y mantenida por Volatility Foundation, considerada como el est\u00e1ndar de facto para el an\u00e1lisis forense de memoria volatil.</p> <p>Volatility se puede expandir enormemente a trav\u00e9s de un sistema de complementos o plugings desarrollados tanto por la fundaci\u00f3n como por la propia comunidad. Es una herramienta invaluable para cualquier Blue Teamer.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility-2-vs-volatility-3","title":"Volatility 2 vs Volatility 3","text":"<p>Actualmente estamos a medio camino entre las dos versiones estables que existen de la herramienta, volatility 2 y volatility 3, el uso de cada una de ellas tiene sus pros y sus contras.</p> <p>La versi\u00f3n nueva de volatility ha sido completamente reescrita y redise\u00f1ada en Python 3, e introduce muchas novedades:</p> <ul> <li>Integraci\u00f3n mucho m\u00e1s sencilla en otras bibliotecas e interfaces de usuario</li> <li>Soporta de forma nativa multiprocesamiento y cach\u00e9s de memoria</li> <li>Detecci\u00f3n autom\u00e1tica de perfiles para todos los sistemas operativos soportados.</li> <li>Soporte nativo de aplicaciones de 32 bits en kernels de 64 bits</li> <li>Evaluaci\u00f3n automatizada del c\u00f3digo en memoria</li> <li>Los plugins est\u00e1n versionados y pueden llamar directamente a otros plugins</li> <li>Soporte automatizado de sistemas operativos y aplicaciones y an\u00e1lisis autom\u00e1tico de m\u00faltiples muestras a la vez</li> </ul> <p>Richard Davis, en su canal de YouTube 13Cubed, public\u00f3 un v\u00eddeo muy interesante sobre Volatility 3 y sus nuevas caracter\u00edsticas.</p> <p>Los inconvenientes del uso de volatility3 vienen fundamentalmente por los plugins, la gran mayor\u00eda de los plugins existentes para volatility2 no han sido a\u00fan migrados a volatility3.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility-installation","title":"Volatility Installation","text":"<p>Por lo que se ha comentado anteriormente, se propone la instalaci\u00f3n de las dos versiones.</p> <ul> <li>Script para instalar volatility 2 en Debian, Ubuntu, or Kali Linux</li> <li>Script para instalar volatility 3 en Debian, Ubuntu, or Kali Linux</li> </ul> <p>Nota. Ten en cuenta que volatility2 se ejecuta bajo python2 y volatility3 bajo python3.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility-plugins","title":"Volatility Plugins","text":"<p>En la wiki de la herramienta podemos encontrar una gu\u00eda de referencia de los principales plugins, as\u00ed como otros desarrollados por la propia comunidad.</p> <p>Si queremos ver una lista de los plugins que trae cargados por defecto, podemos usar propia la ayuda de la herramienta:</p> <pre><code>$ python vol.py --info\n</code></pre>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#formatos-que-admite-volatility","title":"Formatos que admite volatility","text":"<p>Volatility admite volcados de memoria en varios formatos diferentes, para garantizar la m\u00e1xima compatibilidad con diferentes herramientas de adquisici\u00f3n.</p> <p>Puede analizar archivos de hibernaci\u00f3n, volcados de memoria, volcados de n\u00facleo de virtualbox, volcado de memoria sin procesar, etc.. Volatility detectar\u00e1 el formato de archivo subyacente y aplicar\u00e1 el espacio de direcciones adecuado.</p> <p>Listado de formatos de archivo que acepta:</p> <ul> <li>Raw linear sample (dd)</li> <li>Hibernation file (from Windows 7 and earlier)</li> <li>Crash dump file</li> <li>VirtualBox ELF64 core dump</li> <li>VMware saved state and snapshot files</li> <li>EWF format (E01)</li> <li>LiME format</li> <li>Mach-O file format</li> <li>QEMU virtual machine dumps</li> <li>Firewire</li> <li>HPAK (FDPro)</li> </ul> <p>\u00c9chale un ojo a como convertir entre formatos de archivo.</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#perfiles-de-memoria","title":"Perfiles de memoria","text":"<p>Volatility necesita saber de qu\u00e9 tipo de sistema proviene el volcado de memoria, para saber qu\u00e9 estructuras de datos, algoritmos y s\u00edmbolos usar. Por lo tanto antes de comenzar a analizar nuestra captura de memoria debemos indicarle a volatility que perfil de memoria es. Si no sabemos de qu\u00e9 tipo de sistema es el volcado de memoria, podemos usar los complementos imageinfo o kdbgscan para obtener sugerencias.</p> <p>Si queremos ver una lista de nombres de perfil que trae cargados por defecto, podemos usar la propia ayuda de la herramienta:</p> <pre><code>$ python vol.py --info\n</code></pre>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility-no-encuentra-el-perfil-ahora-que-hago","title":"Volatility no encuentra el p\u00e9rfil, \u00bfahora que hago?","text":"<p>Se nos puede dar el caso de que la herramienta no traiga cargado el perfil de memoria que necesitamos, en ese caso tenemos dos opciones:</p> <ol> <li> <p>Podemos acudir al repositorio de la herramienta, descargar los perfiles actualizados y cargarlos en el directorio que los almacen (/volatility/plugins/overlays/sistema_operativo_del_perfil).</p> </li> <li> <p>En caso de que el descarguemos el perfil y siga sin detectarlo, no nos quedar\u00e1 mas remedio que crearlo nosotros y a\u00f1adirlo a la carpeta anteriormente indicada. Un par de art\u00edculos sobre como crear perfiles:</p> </li> </ol> <p>How to generate a Volatility profile for a Linux system</p> <p>Building a Linux profile for Volatility 2 and 3</p>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#como-analizar-una-captura-de-memoria-con-volatility","title":"C\u00f3mo analizar una captura de memoria con volatility","text":"<p>\u00c9sta serie de art\u00edculos hace una revisi\u00f3n muy \u00fatil e interesante del uso de Volatility mostrando algunas de sus capacidades de an\u00e1lisis:</p> <ul> <li> <p>Image Identification</p> </li> <li> <p>Processes and DLLs</p> </li> <li> <p>Process Memory</p> </li> <li> <p>Kernel Memory and Objects</p> </li> <li> <p>Networking</p> </li> <li> <p>Windows Registry</p> </li> <li> <p>Analyze and convert crash dumps and hibernation files</p> </li> <li> <p>Filesystem</p> </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#volatility-cheatsheets","title":"Volatility Cheatsheets","text":"<p>Volatility es una herramienta que abarca muchos aspectos de una investigaci\u00f3n forense. Para dar respuesta a todos esas necesidades tiene, como dijimos anteriormente, una cantidad importante de plugins. Por dicho motivo es muy importante que tengamos a manos una buena gu\u00eda de referencia de los comandos mas importantes. Anteriormente hemos mencionado la wiki de la propia herramienta, os dejo tambien un par de cheatsheets que pueden ser utilidad:</p> <ul> <li>Volaility CheatSheet (Volatility Foundation)</li> <li> <p>Volatility Cheat Sheet (SANS)</p> </li> <li> <p>HAckTricks Cheat Sheet</p> </li> </ul>"},{"location":"ud2%20%28copia%29/ud2.5.Analisis_Memoria_RAM/#otros-recursos","title":"Otros recursos","text":"<p>No soy muy amante los recursos en papel, pero en este apartado no podemos pasar por alto un libro que deber\u00eda estar en la estanter\u00eda de cualquier apasionado del an\u00e1lisis forense.</p> <p>Eso si el libro tiene 858 p\u00e1ginas, asi que si te lo compras, no lo tengas en la estater\u00eda que pesa un quintal... \u00a1mant\u00e9nlo en tu escritorio y \u00e1brelo!</p> <ul> <li>The Art of Memory Forensics: Detecting Malware and Threats in Windows, Linux, and Mac Memory</li> </ul>"},{"location":"ud2%20%28copia%29/ud2/","title":"UD2 - Evidence Analysis","text":""},{"location":"ud2%20%28copia%29/ud2/#introduccion","title":"Introducci\u00f3n","text":"<p>En esta fase llevaremos a cabo un estudio pormenorizado de los hallazgos de la etapa  anterior. Es  durante el an\u00e1lisis que el responsable del caso identificar\u00e1 aquellos comportamientos, conexiones, ficheros y dem\u00e1s aspectos que puedan ser susceptibles de un uso malintencionado. </p> <p>Para esto, el analista puede hacer uso de las herramientas que crea conveniente, as\u00ed como de referencias externas, siempre y cuando no se altere el estado inicial de las pruebas. </p> <p>Toda la informaci\u00f3n relevante debe ser recogida y categorizada de tal forma que se pueda a\u00f1adir posteriormente al informe de manera comprensible y clara. </p>"},{"location":"ud2%20%28copia%29/ud2/#objetivos","title":"Objetivos","text":"<ul> <li> <p>Analizar las evidencias de manera manual y autom\u00e1tica. </p> </li> <li> <p>Identificar los principales artefactos de los sistemas operativos. </p> </li> <li> <p>Documentar el proceso realizado. </p> </li> <li> <p>Establecer la l\u00ednea temporal. </p> </li> <li> <p>Mantener la cadena de custodia. </p> </li> </ul>"}]}